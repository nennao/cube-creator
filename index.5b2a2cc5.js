function t(t,e,n,o){Object.defineProperty(t,e,{get:n,set:o,enumerable:!0,configurable:!0})}function e(t){return t&&t.__esModule?t.default:t}var n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},o={},r={},i=n.parcelRequire44b6;null==i&&((i=function(t){if(t in o)return o[t].exports;if(t in r){var e=r[t];delete r[t];var n={id:t,exports:{}};return o[t]=n,e.call(n.exports,n,n.exports),n.exports}var i=new Error("Cannot find module '"+t+"'");throw i.code="MODULE_NOT_FOUND",i}).register=function(t,e){r[t]=e},n.parcelRequire44b6=i),i.register("27Lyk",(function(e,n){var o,r;t(e.exports,"register",(()=>o),(t=>o=t)),t(e.exports,"resolve",(()=>r),(t=>r=t));var i={};o=function(t){for(var e=Object.keys(t),n=0;n<e.length;n++)i[e[n]]=t[e[n]]},r=function(t){var e=i[t];if(null==e)throw new Error("Could not resolve bundle with id "+t);return e}})),i("27Lyk").register(JSON.parse('{"avsrH":"index.5b2a2cc5.js","gTDnR":"MetalSpotty.d34b70f1.jpg","gnyTy":"ScratchedNormal.bea72ab7.png","dvABv":"metal_0026.790c16f8.png","7lL8B":"Colorful_Studio.255f92d9.hdr"}'));class a{gl=null;canvas=null;constructor(t){const e=document.getElementById(t);null!=e&&e instanceof HTMLCanvasElement&&(this.canvas=e,this.gl=function(t){const e=t.getContext("webgl2",{alpha:!1,antialias:!0});return null==e?(alert("Unable to initialize WebGL2. Your browser or machine may not support it."),null):(e.enable(e.CULL_FACE),e)}(this.canvas),this.onWindowResize())}getGL(){return this.gl}getCanvas(){return this.canvas}onWindowResize(){if(this.canvas&&this.gl){const t=window.innerWidth,e=window.innerHeight,n=this.gl,o=this.canvas;o.width=t*window.devicePixelRatio,o.height=e*window.devicePixelRatio,o.style.width=t+"px",o.style.height=e+"px",n.viewport(0,0,o.width,o.height)}}}var s={};t(s,"create",(()=>h)),t(s,"clone",(()=>f)),t(s,"copy",(()=>v)),t(s,"fromValues",(()=>m)),t(s,"set",(()=>d)),t(s,"identity",(()=>p)),t(s,"transpose",(()=>g)),t(s,"invert",(()=>b)),t(s,"adjoint",(()=>x)),t(s,"determinant",(()=>M)),t(s,"multiply",(()=>y)),t(s,"translate",(()=>_)),t(s,"scale",(()=>R)),t(s,"rotate",(()=>T)),t(s,"rotateX",(()=>C)),t(s,"rotateY",(()=>k)),t(s,"rotateZ",(()=>E)),t(s,"fromTranslation",(()=>w)),t(s,"fromScaling",(()=>P)),t(s,"fromRotation",(()=>S)),t(s,"fromXRotation",(()=>A)),t(s,"fromYRotation",(()=>L)),t(s,"fromZRotation",(()=>I)),t(s,"fromRotationTranslation",(()=>D)),t(s,"fromQuat2",(()=>z)),t(s,"getTranslation",(()=>U)),t(s,"getScaling",(()=>B)),t(s,"getRotation",(()=>F)),t(s,"fromRotationTranslationScale",(()=>N)),t(s,"fromRotationTranslationScaleOrigin",(()=>O)),t(s,"fromQuat",(()=>G)),t(s,"frustum",(()=>V)),t(s,"perspectiveNO",(()=>X)),t(s,"perspective",(()=>H)),t(s,"perspectiveZO",(()=>W)),t(s,"perspectiveFromFieldOfView",(()=>q)),t(s,"orthoNO",(()=>j)),t(s,"ortho",(()=>Y)),t(s,"orthoZO",(()=>$)),t(s,"lookAt",(()=>Q)),t(s,"targetTo",(()=>Z)),t(s,"str",(()=>K)),t(s,"frob",(()=>J)),t(s,"add",(()=>tt)),t(s,"subtract",(()=>et)),t(s,"multiplyScalar",(()=>nt)),t(s,"multiplyScalarAndAdd",(()=>ot)),t(s,"exactEquals",(()=>rt)),t(s,"equals",(()=>it)),t(s,"mul",(()=>at)),t(s,"sub",(()=>st));var c=1e-6,l="undefined"!=typeof Float32Array?Float32Array:Array,u=Math.random;Math.PI;function h(){var t=new l(16);return l!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function f(t){var e=new l(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function v(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function m(t,e,n,o,r,i,a,s,c,u,h,f,v,m,d,p){var g=new l(16);return g[0]=t,g[1]=e,g[2]=n,g[3]=o,g[4]=r,g[5]=i,g[6]=a,g[7]=s,g[8]=c,g[9]=u,g[10]=h,g[11]=f,g[12]=v,g[13]=m,g[14]=d,g[15]=p,g}function d(t,e,n,o,r,i,a,s,c,l,u,h,f,v,m,d,p){return t[0]=e,t[1]=n,t[2]=o,t[3]=r,t[4]=i,t[5]=a,t[6]=s,t[7]=c,t[8]=l,t[9]=u,t[10]=h,t[11]=f,t[12]=v,t[13]=m,t[14]=d,t[15]=p,t}function p(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function g(t,e){if(t===e){var n=e[1],o=e[2],r=e[3],i=e[6],a=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=o,t[9]=i,t[11]=e[14],t[12]=r,t[13]=a,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function b(t,e){var n=e[0],o=e[1],r=e[2],i=e[3],a=e[4],s=e[5],c=e[6],l=e[7],u=e[8],h=e[9],f=e[10],v=e[11],m=e[12],d=e[13],p=e[14],g=e[15],b=n*s-o*a,x=n*c-r*a,M=n*l-i*a,y=o*c-r*s,_=o*l-i*s,R=r*l-i*c,T=u*d-h*m,C=u*p-f*m,k=u*g-v*m,E=h*p-f*d,w=h*g-v*d,P=f*g-v*p,S=b*P-x*w+M*E+y*k-_*C+R*T;return S?(S=1/S,t[0]=(s*P-c*w+l*E)*S,t[1]=(r*w-o*P-i*E)*S,t[2]=(d*R-p*_+g*y)*S,t[3]=(f*_-h*R-v*y)*S,t[4]=(c*k-a*P-l*C)*S,t[5]=(n*P-r*k+i*C)*S,t[6]=(p*M-m*R-g*x)*S,t[7]=(u*R-f*M+v*x)*S,t[8]=(a*w-s*k+l*T)*S,t[9]=(o*k-n*w-i*T)*S,t[10]=(m*_-d*M+g*b)*S,t[11]=(h*M-u*_-v*b)*S,t[12]=(s*C-a*E-c*T)*S,t[13]=(n*E-o*C+r*T)*S,t[14]=(d*x-m*y-p*b)*S,t[15]=(u*y-h*x+f*b)*S,t):null}function x(t,e){var n=e[0],o=e[1],r=e[2],i=e[3],a=e[4],s=e[5],c=e[6],l=e[7],u=e[8],h=e[9],f=e[10],v=e[11],m=e[12],d=e[13],p=e[14],g=e[15];return t[0]=s*(f*g-v*p)-h*(c*g-l*p)+d*(c*v-l*f),t[1]=-(o*(f*g-v*p)-h*(r*g-i*p)+d*(r*v-i*f)),t[2]=o*(c*g-l*p)-s*(r*g-i*p)+d*(r*l-i*c),t[3]=-(o*(c*v-l*f)-s*(r*v-i*f)+h*(r*l-i*c)),t[4]=-(a*(f*g-v*p)-u*(c*g-l*p)+m*(c*v-l*f)),t[5]=n*(f*g-v*p)-u*(r*g-i*p)+m*(r*v-i*f),t[6]=-(n*(c*g-l*p)-a*(r*g-i*p)+m*(r*l-i*c)),t[7]=n*(c*v-l*f)-a*(r*v-i*f)+u*(r*l-i*c),t[8]=a*(h*g-v*d)-u*(s*g-l*d)+m*(s*v-l*h),t[9]=-(n*(h*g-v*d)-u*(o*g-i*d)+m*(o*v-i*h)),t[10]=n*(s*g-l*d)-a*(o*g-i*d)+m*(o*l-i*s),t[11]=-(n*(s*v-l*h)-a*(o*v-i*h)+u*(o*l-i*s)),t[12]=-(a*(h*p-f*d)-u*(s*p-c*d)+m*(s*f-c*h)),t[13]=n*(h*p-f*d)-u*(o*p-r*d)+m*(o*f-r*h),t[14]=-(n*(s*p-c*d)-a*(o*p-r*d)+m*(o*c-r*s)),t[15]=n*(s*f-c*h)-a*(o*f-r*h)+u*(o*c-r*s),t}function M(t){var e=t[0],n=t[1],o=t[2],r=t[3],i=t[4],a=t[5],s=t[6],c=t[7],l=t[8],u=t[9],h=t[10],f=t[11],v=t[12],m=t[13],d=t[14],p=t[15];return(e*a-n*i)*(h*p-f*d)-(e*s-o*i)*(u*p-f*m)+(e*c-r*i)*(u*d-h*m)+(n*s-o*a)*(l*p-f*v)-(n*c-r*a)*(l*d-h*v)+(o*c-r*s)*(l*m-u*v)}function y(t,e,n){var o=e[0],r=e[1],i=e[2],a=e[3],s=e[4],c=e[5],l=e[6],u=e[7],h=e[8],f=e[9],v=e[10],m=e[11],d=e[12],p=e[13],g=e[14],b=e[15],x=n[0],M=n[1],y=n[2],_=n[3];return t[0]=x*o+M*s+y*h+_*d,t[1]=x*r+M*c+y*f+_*p,t[2]=x*i+M*l+y*v+_*g,t[3]=x*a+M*u+y*m+_*b,x=n[4],M=n[5],y=n[6],_=n[7],t[4]=x*o+M*s+y*h+_*d,t[5]=x*r+M*c+y*f+_*p,t[6]=x*i+M*l+y*v+_*g,t[7]=x*a+M*u+y*m+_*b,x=n[8],M=n[9],y=n[10],_=n[11],t[8]=x*o+M*s+y*h+_*d,t[9]=x*r+M*c+y*f+_*p,t[10]=x*i+M*l+y*v+_*g,t[11]=x*a+M*u+y*m+_*b,x=n[12],M=n[13],y=n[14],_=n[15],t[12]=x*o+M*s+y*h+_*d,t[13]=x*r+M*c+y*f+_*p,t[14]=x*i+M*l+y*v+_*g,t[15]=x*a+M*u+y*m+_*b,t}function _(t,e,n){var o,r,i,a,s,c,l,u,h,f,v,m,d=n[0],p=n[1],g=n[2];return e===t?(t[12]=e[0]*d+e[4]*p+e[8]*g+e[12],t[13]=e[1]*d+e[5]*p+e[9]*g+e[13],t[14]=e[2]*d+e[6]*p+e[10]*g+e[14],t[15]=e[3]*d+e[7]*p+e[11]*g+e[15]):(o=e[0],r=e[1],i=e[2],a=e[3],s=e[4],c=e[5],l=e[6],u=e[7],h=e[8],f=e[9],v=e[10],m=e[11],t[0]=o,t[1]=r,t[2]=i,t[3]=a,t[4]=s,t[5]=c,t[6]=l,t[7]=u,t[8]=h,t[9]=f,t[10]=v,t[11]=m,t[12]=o*d+s*p+h*g+e[12],t[13]=r*d+c*p+f*g+e[13],t[14]=i*d+l*p+v*g+e[14],t[15]=a*d+u*p+m*g+e[15]),t}function R(t,e,n){var o=n[0],r=n[1],i=n[2];return t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t[3]=e[3]*o,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function T(t,e,n,o){var r,i,a,s,l,u,h,f,v,m,d,p,g,b,x,M,y,_,R,T,C,k,E,w,P=o[0],S=o[1],A=o[2],L=Math.hypot(P,S,A);return L<c?null:(P*=L=1/L,S*=L,A*=L,r=Math.sin(n),a=1-(i=Math.cos(n)),s=e[0],l=e[1],u=e[2],h=e[3],f=e[4],v=e[5],m=e[6],d=e[7],p=e[8],g=e[9],b=e[10],x=e[11],M=P*P*a+i,y=S*P*a+A*r,_=A*P*a-S*r,R=P*S*a-A*r,T=S*S*a+i,C=A*S*a+P*r,k=P*A*a+S*r,E=S*A*a-P*r,w=A*A*a+i,t[0]=s*M+f*y+p*_,t[1]=l*M+v*y+g*_,t[2]=u*M+m*y+b*_,t[3]=h*M+d*y+x*_,t[4]=s*R+f*T+p*C,t[5]=l*R+v*T+g*C,t[6]=u*R+m*T+b*C,t[7]=h*R+d*T+x*C,t[8]=s*k+f*E+p*w,t[9]=l*k+v*E+g*w,t[10]=u*k+m*E+b*w,t[11]=h*k+d*E+x*w,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function C(t,e,n){var o=Math.sin(n),r=Math.cos(n),i=e[4],a=e[5],s=e[6],c=e[7],l=e[8],u=e[9],h=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=i*r+l*o,t[5]=a*r+u*o,t[6]=s*r+h*o,t[7]=c*r+f*o,t[8]=l*r-i*o,t[9]=u*r-a*o,t[10]=h*r-s*o,t[11]=f*r-c*o,t}function k(t,e,n){var o=Math.sin(n),r=Math.cos(n),i=e[0],a=e[1],s=e[2],c=e[3],l=e[8],u=e[9],h=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=i*r-l*o,t[1]=a*r-u*o,t[2]=s*r-h*o,t[3]=c*r-f*o,t[8]=i*o+l*r,t[9]=a*o+u*r,t[10]=s*o+h*r,t[11]=c*o+f*r,t}function E(t,e,n){var o=Math.sin(n),r=Math.cos(n),i=e[0],a=e[1],s=e[2],c=e[3],l=e[4],u=e[5],h=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=i*r+l*o,t[1]=a*r+u*o,t[2]=s*r+h*o,t[3]=c*r+f*o,t[4]=l*r-i*o,t[5]=u*r-a*o,t[6]=h*r-s*o,t[7]=f*r-c*o,t}function w(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function P(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function S(t,e,n){var o,r,i,a=n[0],s=n[1],l=n[2],u=Math.hypot(a,s,l);return u<c?null:(a*=u=1/u,s*=u,l*=u,o=Math.sin(e),i=1-(r=Math.cos(e)),t[0]=a*a*i+r,t[1]=s*a*i+l*o,t[2]=l*a*i-s*o,t[3]=0,t[4]=a*s*i-l*o,t[5]=s*s*i+r,t[6]=l*s*i+a*o,t[7]=0,t[8]=a*l*i+s*o,t[9]=s*l*i-a*o,t[10]=l*l*i+r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function A(t,e){var n=Math.sin(e),o=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function L(t,e){var n=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function I(t,e){var n=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function D(t,e,n){var o=e[0],r=e[1],i=e[2],a=e[3],s=o+o,c=r+r,l=i+i,u=o*s,h=o*c,f=o*l,v=r*c,m=r*l,d=i*l,p=a*s,g=a*c,b=a*l;return t[0]=1-(v+d),t[1]=h+b,t[2]=f-g,t[3]=0,t[4]=h-b,t[5]=1-(u+d),t[6]=m+p,t[7]=0,t[8]=f+g,t[9]=m-p,t[10]=1-(u+v),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function z(t,e){var n=new l(3),o=-e[0],r=-e[1],i=-e[2],a=e[3],s=e[4],c=e[5],u=e[6],h=e[7],f=o*o+r*r+i*i+a*a;return f>0?(n[0]=2*(s*a+h*o+c*i-u*r)/f,n[1]=2*(c*a+h*r+u*o-s*i)/f,n[2]=2*(u*a+h*i+s*r-c*o)/f):(n[0]=2*(s*a+h*o+c*i-u*r),n[1]=2*(c*a+h*r+u*o-s*i),n[2]=2*(u*a+h*i+s*r-c*o)),D(t,e,n),t}function U(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function B(t,e){var n=e[0],o=e[1],r=e[2],i=e[4],a=e[5],s=e[6],c=e[8],l=e[9],u=e[10];return t[0]=Math.hypot(n,o,r),t[1]=Math.hypot(i,a,s),t[2]=Math.hypot(c,l,u),t}function F(t,e){var n=new l(3);B(n,e);var o=1/n[0],r=1/n[1],i=1/n[2],a=e[0]*o,s=e[1]*r,c=e[2]*i,u=e[4]*o,h=e[5]*r,f=e[6]*i,v=e[8]*o,m=e[9]*r,d=e[10]*i,p=a+h+d,g=0;return p>0?(g=2*Math.sqrt(p+1),t[3]=.25*g,t[0]=(f-m)/g,t[1]=(v-c)/g,t[2]=(s-u)/g):a>h&&a>d?(g=2*Math.sqrt(1+a-h-d),t[3]=(f-m)/g,t[0]=.25*g,t[1]=(s+u)/g,t[2]=(v+c)/g):h>d?(g=2*Math.sqrt(1+h-a-d),t[3]=(v-c)/g,t[0]=(s+u)/g,t[1]=.25*g,t[2]=(f+m)/g):(g=2*Math.sqrt(1+d-a-h),t[3]=(s-u)/g,t[0]=(v+c)/g,t[1]=(f+m)/g,t[2]=.25*g),t}function N(t,e,n,o){var r=e[0],i=e[1],a=e[2],s=e[3],c=r+r,l=i+i,u=a+a,h=r*c,f=r*l,v=r*u,m=i*l,d=i*u,p=a*u,g=s*c,b=s*l,x=s*u,M=o[0],y=o[1],_=o[2];return t[0]=(1-(m+p))*M,t[1]=(f+x)*M,t[2]=(v-b)*M,t[3]=0,t[4]=(f-x)*y,t[5]=(1-(h+p))*y,t[6]=(d+g)*y,t[7]=0,t[8]=(v+b)*_,t[9]=(d-g)*_,t[10]=(1-(h+m))*_,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function O(t,e,n,o,r){var i=e[0],a=e[1],s=e[2],c=e[3],l=i+i,u=a+a,h=s+s,f=i*l,v=i*u,m=i*h,d=a*u,p=a*h,g=s*h,b=c*l,x=c*u,M=c*h,y=o[0],_=o[1],R=o[2],T=r[0],C=r[1],k=r[2],E=(1-(d+g))*y,w=(v+M)*y,P=(m-x)*y,S=(v-M)*_,A=(1-(f+g))*_,L=(p+b)*_,I=(m+x)*R,D=(p-b)*R,z=(1-(f+d))*R;return t[0]=E,t[1]=w,t[2]=P,t[3]=0,t[4]=S,t[5]=A,t[6]=L,t[7]=0,t[8]=I,t[9]=D,t[10]=z,t[11]=0,t[12]=n[0]+T-(E*T+S*C+I*k),t[13]=n[1]+C-(w*T+A*C+D*k),t[14]=n[2]+k-(P*T+L*C+z*k),t[15]=1,t}function G(t,e){var n=e[0],o=e[1],r=e[2],i=e[3],a=n+n,s=o+o,c=r+r,l=n*a,u=o*a,h=o*s,f=r*a,v=r*s,m=r*c,d=i*a,p=i*s,g=i*c;return t[0]=1-h-m,t[1]=u+g,t[2]=f-p,t[3]=0,t[4]=u-g,t[5]=1-l-m,t[6]=v+d,t[7]=0,t[8]=f+p,t[9]=v-d,t[10]=1-l-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function V(t,e,n,o,r,i,a){var s=1/(n-e),c=1/(r-o),l=1/(i-a);return t[0]=2*i*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*i*c,t[6]=0,t[7]=0,t[8]=(n+e)*s,t[9]=(r+o)*c,t[10]=(a+i)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*i*2*l,t[15]=0,t}function X(t,e,n,o,r){var i,a=1/Math.tan(e/2);return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=r&&r!==1/0?(i=1/(o-r),t[10]=(r+o)*i,t[14]=2*r*o*i):(t[10]=-1,t[14]=-2*o),t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var H=X;function W(t,e,n,o,r){var i,a=1/Math.tan(e/2);return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=r&&r!==1/0?(i=1/(o-r),t[10]=r*i,t[14]=r*o*i):(t[10]=-1,t[14]=-o),t}function q(t,e,n,o){var r=Math.tan(e.upDegrees*Math.PI/180),i=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),c=2/(a+s),l=2/(r+i);return t[0]=c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=-(a-s)*c*.5,t[9]=(r-i)*l*.5,t[10]=o/(n-o),t[11]=-1,t[12]=0,t[13]=0,t[14]=o*n/(n-o),t[15]=0,t}function j(t,e,n,o,r,i,a){var s=1/(e-n),c=1/(o-r),l=1/(i-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+n)*s,t[13]=(r+o)*c,t[14]=(a+i)*l,t[15]=1,t}var Y=j;function $(t,e,n,o,r,i,a){var s=1/(e-n),c=1/(o-r),l=1/(i-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=l,t[11]=0,t[12]=(e+n)*s,t[13]=(r+o)*c,t[14]=i*l,t[15]=1,t}function Q(t,e,n,o){var r,i,a,s,l,u,h,f,v,m,d=e[0],g=e[1],b=e[2],x=o[0],M=o[1],y=o[2],_=n[0],R=n[1],T=n[2];return Math.abs(d-_)<c&&Math.abs(g-R)<c&&Math.abs(b-T)<c?p(t):(h=d-_,f=g-R,v=b-T,r=M*(v*=m=1/Math.hypot(h,f,v))-y*(f*=m),i=y*(h*=m)-x*v,a=x*f-M*h,(m=Math.hypot(r,i,a))?(r*=m=1/m,i*=m,a*=m):(r=0,i=0,a=0),s=f*a-v*i,l=v*r-h*a,u=h*i-f*r,(m=Math.hypot(s,l,u))?(s*=m=1/m,l*=m,u*=m):(s=0,l=0,u=0),t[0]=r,t[1]=s,t[2]=h,t[3]=0,t[4]=i,t[5]=l,t[6]=f,t[7]=0,t[8]=a,t[9]=u,t[10]=v,t[11]=0,t[12]=-(r*d+i*g+a*b),t[13]=-(s*d+l*g+u*b),t[14]=-(h*d+f*g+v*b),t[15]=1,t)}function Z(t,e,n,o){var r=e[0],i=e[1],a=e[2],s=o[0],c=o[1],l=o[2],u=r-n[0],h=i-n[1],f=a-n[2],v=u*u+h*h+f*f;v>0&&(u*=v=1/Math.sqrt(v),h*=v,f*=v);var m=c*f-l*h,d=l*u-s*f,p=s*h-c*u;return(v=m*m+d*d+p*p)>0&&(m*=v=1/Math.sqrt(v),d*=v,p*=v),t[0]=m,t[1]=d,t[2]=p,t[3]=0,t[4]=h*p-f*d,t[5]=f*m-u*p,t[6]=u*d-h*m,t[7]=0,t[8]=u,t[9]=h,t[10]=f,t[11]=0,t[12]=r,t[13]=i,t[14]=a,t[15]=1,t}function K(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function J(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function tt(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t}function et(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}function nt(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t}function ot(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t[2]=e[2]+n[2]*o,t[3]=e[3]+n[3]*o,t[4]=e[4]+n[4]*o,t[5]=e[5]+n[5]*o,t[6]=e[6]+n[6]*o,t[7]=e[7]+n[7]*o,t[8]=e[8]+n[8]*o,t[9]=e[9]+n[9]*o,t[10]=e[10]+n[10]*o,t[11]=e[11]+n[11]*o,t[12]=e[12]+n[12]*o,t[13]=e[13]+n[13]*o,t[14]=e[14]+n[14]*o,t[15]=e[15]+n[15]*o,t}function rt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function it(t,e){var n=t[0],o=t[1],r=t[2],i=t[3],a=t[4],s=t[5],l=t[6],u=t[7],h=t[8],f=t[9],v=t[10],m=t[11],d=t[12],p=t[13],g=t[14],b=t[15],x=e[0],M=e[1],y=e[2],_=e[3],R=e[4],T=e[5],C=e[6],k=e[7],E=e[8],w=e[9],P=e[10],S=e[11],A=e[12],L=e[13],I=e[14],D=e[15];return Math.abs(n-x)<=c*Math.max(1,Math.abs(n),Math.abs(x))&&Math.abs(o-M)<=c*Math.max(1,Math.abs(o),Math.abs(M))&&Math.abs(r-y)<=c*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(i-_)<=c*Math.max(1,Math.abs(i),Math.abs(_))&&Math.abs(a-R)<=c*Math.max(1,Math.abs(a),Math.abs(R))&&Math.abs(s-T)<=c*Math.max(1,Math.abs(s),Math.abs(T))&&Math.abs(l-C)<=c*Math.max(1,Math.abs(l),Math.abs(C))&&Math.abs(u-k)<=c*Math.max(1,Math.abs(u),Math.abs(k))&&Math.abs(h-E)<=c*Math.max(1,Math.abs(h),Math.abs(E))&&Math.abs(f-w)<=c*Math.max(1,Math.abs(f),Math.abs(w))&&Math.abs(v-P)<=c*Math.max(1,Math.abs(v),Math.abs(P))&&Math.abs(m-S)<=c*Math.max(1,Math.abs(m),Math.abs(S))&&Math.abs(d-A)<=c*Math.max(1,Math.abs(d),Math.abs(A))&&Math.abs(p-L)<=c*Math.max(1,Math.abs(p),Math.abs(L))&&Math.abs(g-I)<=c*Math.max(1,Math.abs(g),Math.abs(I))&&Math.abs(b-D)<=c*Math.max(1,Math.abs(b),Math.abs(D))}var at=y,st=et,ct={};function lt(){var t=new l(3);return l!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function ut(t){var e=new l(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function ht(t){var e=t[0],n=t[1],o=t[2];return Math.hypot(e,n,o)}function ft(t,e,n){var o=new l(3);return o[0]=t,o[1]=e,o[2]=n,o}function vt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function mt(t,e,n,o){return t[0]=e,t[1]=n,t[2]=o,t}function dt(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function pt(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function gt(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function bt(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function xt(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function Mt(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function yt(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t}function _t(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t}function Rt(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function Tt(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function Ct(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t[2]=e[2]+n[2]*o,t}function kt(t,e){var n=e[0]-t[0],o=e[1]-t[1],r=e[2]-t[2];return Math.hypot(n,o,r)}function Et(t,e){var n=e[0]-t[0],o=e[1]-t[1],r=e[2]-t[2];return n*n+o*o+r*r}function wt(t){var e=t[0],n=t[1],o=t[2];return e*e+n*n+o*o}function Pt(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function St(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function At(t,e){var n=e[0],o=e[1],r=e[2],i=n*n+o*o+r*r;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function Lt(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function It(t,e,n){var o=e[0],r=e[1],i=e[2],a=n[0],s=n[1],c=n[2];return t[0]=r*c-i*s,t[1]=i*a-o*c,t[2]=o*s-r*a,t}function Dt(t,e,n,o){var r=e[0],i=e[1],a=e[2];return t[0]=r+o*(n[0]-r),t[1]=i+o*(n[1]-i),t[2]=a+o*(n[2]-a),t}function zt(t,e,n,o,r,i){var a=i*i,s=a*(2*i-3)+1,c=a*(i-2)+i,l=a*(i-1),u=a*(3-2*i);return t[0]=e[0]*s+n[0]*c+o[0]*l+r[0]*u,t[1]=e[1]*s+n[1]*c+o[1]*l+r[1]*u,t[2]=e[2]*s+n[2]*c+o[2]*l+r[2]*u,t}function Ut(t,e,n,o,r,i){var a=1-i,s=a*a,c=i*i,l=s*a,u=3*i*s,h=3*c*a,f=c*i;return t[0]=e[0]*l+n[0]*u+o[0]*h+r[0]*f,t[1]=e[1]*l+n[1]*u+o[1]*h+r[1]*f,t[2]=e[2]*l+n[2]*u+o[2]*h+r[2]*f,t}function Bt(t,e){e=e||1;var n=2*u()*Math.PI,o=2*u()-1,r=Math.sqrt(1-o*o)*e;return t[0]=Math.cos(n)*r,t[1]=Math.sin(n)*r,t[2]=o*e,t}function Ft(t,e,n){var o=e[0],r=e[1],i=e[2],a=n[3]*o+n[7]*r+n[11]*i+n[15];return a=a||1,t[0]=(n[0]*o+n[4]*r+n[8]*i+n[12])/a,t[1]=(n[1]*o+n[5]*r+n[9]*i+n[13])/a,t[2]=(n[2]*o+n[6]*r+n[10]*i+n[14])/a,t}function Nt(t,e,n){var o=e[0],r=e[1],i=e[2];return t[0]=o*n[0]+r*n[3]+i*n[6],t[1]=o*n[1]+r*n[4]+i*n[7],t[2]=o*n[2]+r*n[5]+i*n[8],t}function Ot(t,e,n){var o=n[0],r=n[1],i=n[2],a=n[3],s=e[0],c=e[1],l=e[2],u=r*l-i*c,h=i*s-o*l,f=o*c-r*s,v=r*f-i*h,m=i*u-o*f,d=o*h-r*u,p=2*a;return u*=p,h*=p,f*=p,v*=2,m*=2,d*=2,t[0]=s+u+v,t[1]=c+h+m,t[2]=l+f+d,t}function Gt(t,e,n,o){var r=[],i=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],i[0]=r[0],i[1]=r[1]*Math.cos(o)-r[2]*Math.sin(o),i[2]=r[1]*Math.sin(o)+r[2]*Math.cos(o),t[0]=i[0]+n[0],t[1]=i[1]+n[1],t[2]=i[2]+n[2],t}function Vt(t,e,n,o){var r=[],i=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],i[0]=r[2]*Math.sin(o)+r[0]*Math.cos(o),i[1]=r[1],i[2]=r[2]*Math.cos(o)-r[0]*Math.sin(o),t[0]=i[0]+n[0],t[1]=i[1]+n[1],t[2]=i[2]+n[2],t}function Xt(t,e,n,o){var r=[],i=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],i[0]=r[0]*Math.cos(o)-r[1]*Math.sin(o),i[1]=r[0]*Math.sin(o)+r[1]*Math.cos(o),i[2]=r[2],t[0]=i[0]+n[0],t[1]=i[1]+n[1],t[2]=i[2]+n[2],t}function Ht(t,e){var n=t[0],o=t[1],r=t[2],i=e[0],a=e[1],s=e[2],c=Math.sqrt(n*n+o*o+r*r)*Math.sqrt(i*i+a*a+s*s),l=c&&Lt(t,e)/c;return Math.acos(Math.min(Math.max(l,-1),1))}function Wt(t){return t[0]=0,t[1]=0,t[2]=0,t}function qt(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function jt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function Yt(t,e){var n=t[0],o=t[1],r=t[2],i=e[0],a=e[1],s=e[2];return Math.abs(n-i)<=c*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(o-a)<=c*Math.max(1,Math.abs(o),Math.abs(a))&&Math.abs(r-s)<=c*Math.max(1,Math.abs(r),Math.abs(s))}t(ct,"create",(()=>lt)),t(ct,"clone",(()=>ut)),t(ct,"length",(()=>ht)),t(ct,"fromValues",(()=>ft)),t(ct,"copy",(()=>vt)),t(ct,"set",(()=>mt)),t(ct,"add",(()=>dt)),t(ct,"subtract",(()=>pt)),t(ct,"multiply",(()=>gt)),t(ct,"divide",(()=>bt)),t(ct,"ceil",(()=>xt)),t(ct,"floor",(()=>Mt)),t(ct,"min",(()=>yt)),t(ct,"max",(()=>_t)),t(ct,"round",(()=>Rt)),t(ct,"scale",(()=>Tt)),t(ct,"scaleAndAdd",(()=>Ct)),t(ct,"distance",(()=>kt)),t(ct,"squaredDistance",(()=>Et)),t(ct,"squaredLength",(()=>wt)),t(ct,"negate",(()=>Pt)),t(ct,"inverse",(()=>St)),t(ct,"normalize",(()=>At)),t(ct,"dot",(()=>Lt)),t(ct,"cross",(()=>It)),t(ct,"lerp",(()=>Dt)),t(ct,"hermite",(()=>zt)),t(ct,"bezier",(()=>Ut)),t(ct,"random",(()=>Bt)),t(ct,"transformMat4",(()=>Ft)),t(ct,"transformMat3",(()=>Nt)),t(ct,"transformQuat",(()=>Ot)),t(ct,"rotateX",(()=>Gt)),t(ct,"rotateY",(()=>Vt)),t(ct,"rotateZ",(()=>Xt)),t(ct,"angle",(()=>Ht)),t(ct,"zero",(()=>Wt)),t(ct,"str",(()=>qt)),t(ct,"exactEquals",(()=>jt)),t(ct,"equals",(()=>Yt)),t(ct,"sub",(()=>Qt)),t(ct,"mul",(()=>Zt)),t(ct,"div",(()=>Kt)),t(ct,"dist",(()=>Jt)),t(ct,"sqrDist",(()=>te)),t(ct,"len",(()=>ee)),t(ct,"sqrLen",(()=>ne)),t(ct,"forEach",(()=>oe));var $t,Qt=pt,Zt=gt,Kt=bt,Jt=kt,te=Et,ee=ht,ne=wt,oe=($t=lt(),function(t,e,n,o,r,i){var a,s;for(e||(e=3),n||(n=0),s=o?Math.min(o*e+n,t.length):t.length,a=n;a<s;a+=e)$t[0]=t[a],$t[1]=t[a+1],$t[2]=t[a+2],r($t,$t,i),t[a]=$t[0],t[a+1]=$t[1],t[a+2]=$t[2];return t});function re(t,e=0){return Math.round((t+Number.EPSILON)*Math.pow(10,e))/Math.pow(10,e)}function ie(t){return t*Math.PI/180}function ae(t){return 180*t/Math.PI}function se(t){return Math.acos(ue(t,-1,1))}function ce(t){return Math.floor(Math.random()*t)}function le(t){const e=1/(1-Math.exp(-t));return Math.log(1-Math.random()/e)/-t}function ue(t,e,n){return Math.max(e,Math.min(n,t))}function he(t,e=((t,e)=>t-e),n=!1){return function(t,e,n=!1){return n||(t=[...t]),e?t.sort(e):t.sort(),t}(t,e,n)}function fe(t){return t.filter(((t,e,n)=>n.indexOf(t)==e))}function ve(t,e){return fe(t.filter((t=>e.includes(t))))}function me(t,e=0){return Array.from({length:t},((t,n)=>n+e))}function de(t,e){return t.map(((t,n)=>[t,e[n]]))}function pe(t){const e=document.getElementById(t);if(!e)throw`element "${t}" not found`;return e}function ge(t){const e=pe(t);if(e instanceof HTMLInputElement)return e;throw`input element "${t}" not found`}function be(t){return e=>{t(e.target)}}function xe(t,e,n,o){const r=document.getElementById(t);r instanceof HTMLInputElement?("boolean"==typeof e?r.checked=e:r.value=e,r[n]=o):console.warn(`cant find input with id ${t}`)}function Me(t,e,n){const o=document.getElementById(t);o instanceof HTMLButtonElement||o instanceof HTMLDivElement?o[e]=n:console.warn(`cant find button with id ${t}`)}function ye(t,e,n){document.querySelectorAll(`input[name=${t}]`).forEach((t=>{t instanceof HTMLInputElement&&(t.value==e&&(t.checked=!0),t.onclick=n)}))}function _e(t,e){const n=document.getElementById("fpsTxt");n&&(n.innerText=re(1/t,2).toString(),e?n.classList.remove("faded"):n.classList.add("faded"))}function Re(t){return[t[0],t[1],t[2]]}function Te(t,e){return Array.from(e).map((([e,n,o])=>[t[e],t[n],t[o]]))}function Ce(t,e){const n=t=>ct.transformMat4(ct.create(),t,e);return[n(t[0]),n(t[1]),n(t[2])]}function ke(t,e,n,o,r){const i=de(t,e),a=[],s=[],c=Array.isArray(n)?n:Array.from({length:n},((t,e)=>(e+1)/(n+1)));for(let t of c)a.push(i.map((([e,n])=>Re(ct.lerp(ct.create(),o[e],o[n],t))))),r&&s.push(i.map((([t,e])=>ve(r[t],r[e]))));return[a,Array.from(a,((t,e)=>me(t.length,o.length+e*t.length))),s]}function Ee(t,e,n=!1,o=(t=>!1)){return n&&(t=[...t,t[0]],e=[...e,e[0]]),Array.from({length:t.length-1},((n,r)=>o(r)?[[t[r],e[r],e[r+1]],[t[r],e[r+1],t[r+1]]]:[[t[r],e[r],t[r+1]],[t[r+1],e[r],e[r+1]]])).flat()}function we(t,e){return Ee(t,e,!0)}function Pe(t,e=!1){const n=t[0];return e&&(t=[...t,t[1]]),Array.from({length:t.length-2},((e,o)=>[n,t[o+1],t[o+2]]))}function Se(t,e,n,o){return function(t,e,n,o){const r=ct.subtract(ct.create(),t,n),i=ct.subtract(ct.create(),e,t),a=ct.dot(i,i),s=2*ct.dot(r,i);return s*s>=4*a*(ct.dot(r,r)-o*o)}(t,e,n,.5*o*Math.sqrt(3))}function Ae(t,e,n){const o=1e-7,[r,i,a]=n,s=ct.subtract(ct.create(),e,t);let c,l,u,h,f,v,m,d,p;if(c=ct.subtract(ct.create(),i,r),l=ct.subtract(ct.create(),a,r),u=ct.cross(ct.create(),s,l),v=ct.dot(c,u),v>-1e-7&&v<o)return null;if(m=1/v,h=ct.subtract(ct.create(),t,r),d=m*ct.dot(h,u),d<0||d>1)return null;if(f=ct.cross(ct.create(),h,c),p=m*ct.dot(s,f),p<0||d+p>1)return null;const g=m*ct.dot(l,f);return g>o?ct.add(ct.create(),t,ct.scale(ct.create(),s,g)):null}function Le(t,e,n,o){const r=ct.dot(e,o);return Math.abs(r)>1e-7?ct.dot(ct.subtract(ct.create(),n,t),o)/r:-1}function Ie(t,e,n,o){const r=ct.subtract(ct.create(),e,t);ct.normalize(r,r);const i=Le(t,r,n,o);return i>1e-7?ct.add(ct.create(),t,ct.scale(ct.create(),r,i)):null}function De(t,e,n,o){const r=1e-7,{normal1:i,normal2:a,a1:c,a2:l,rotAxis:u}=o,h=ct.subtract(ct.create(),e,t);ct.normalize(h,h);let f=Le(t,h,n,i),v=Le(t,h,n,a);if(!(f>r||v>r))return console.warn("no ray plane (shallow) intersection"),null;f=f>r?f:1/0,v=v>r?v:1/0;const[m,d,p]=f<v?[f,i,-1*c]:[v,a,-1*l],g=ct.cross(ct.create(),d,[0,0,1]);ct.cross(g,g,d),ct.normalize(g,g),ct.scale(g,g,.5);const b=ct.add(ct.create(),t,ct.scale(ct.create(),h,m));ct.add(b,b,g);const x=ct.subtract(ct.create(),b,n),M=ct.transformMat4(ct.create(),x,s.fromRotation(s.create(),ie(p),u));return ct.add(M,M,n),M}function ze(t,e=1,n=1,o=2){const r=(t/=e)**o;return n*r/(r+(1-t)**o)}function Ue(t,e,n){return function(t,e,n){return"#"+(16777216+(t<<16)+(e<<8)+n).toString(16).slice(1)}(re(255*t),re(255*e),re(255*n))}function Be(t){return function(t,e){const n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return n?[parseInt(n[1],16)/(e||1),parseInt(n[2],16)/(e||1),parseInt(n[3],16)/(e||1)]:(console.warn("couldnt parse hex string:",t),[0,0,0])}(t,255)}class Fe{up=[0,1,0];target=[0,0,0];aspect=1;fov=ie(45);zNear=1;zFar=50;projectionMatrix=s.create();viewMatrix=s.create();distance=15;angleX=0;angleY=0;position=[0,0,this.distance];constructor(t){this.gl=t,this.resize(),this.handleWheelZoom()}resize(){this.aspect=this.gl.canvas.clientWidth/this.gl.canvas.clientHeight}update(){this.position=[0,0,this.distance],this.angleY&&ct.rotateX(this.position,this.position,[0,0,0],ie(this.angleY)),this.angleX&&ct.rotateY(this.position,this.position,[0,0,0],ie(this.angleX)),s.perspective(this.projectionMatrix,this.fov,this.aspect,this.zNear,this.zFar),s.lookAt(this.viewMatrix,this.position,this.target,this.up)}mouseRotate(t,e){this.angleX+=t,this.angleX%=360,this.angleY+=e,this.angleY=ue(this.angleY,-90,90)}reset(){this.angleX=0,this.angleY=0}get watcher(){return[this.aspect,this.distance,this.angleX,this.angleY].join(",")}clipXY(t,e){const n=this.gl.canvas.clientWidth/2,o=this.gl.canvas.clientHeight/2;return[(t-n)/n,(o-e)/o]}getPickedVector(t,e){const n=[...this.clipXY(t,e),1],o=s.multiply(s.create(),this.projectionMatrix,this.viewMatrix),r=s.invert(s.create(),o);return ct.transformMat4(ct.create(),n,r)}handleZoom(t){this.distance=re(this.distance+t,3),this.distance>30&&(this.distance=30),this.distance<8&&(this.distance=8)}handleWheelZoom(){this.gl.canvas.addEventListener("wheel",(t=>{t.preventDefault(),this.handleZoom(.025*t.deltaY)}))}}class Ne{program=null;uniformLocations={};attribLocations={};constructor(t,e,n){this.gl=t;const o=this.createShader(t.VERTEX_SHADER,e),r=this.createShader(t.FRAGMENT_SHADER,n);o&&r&&(this.program=this.createProgram(o,r),this.storeUniformAndAttribLocations())}createShader(t,e){const n=this.gl;if(t!=n.VERTEX_SHADER&&t!=n.FRAGMENT_SHADER)return console.error(`${t} not acceptable for gl.createShader`),null;const o=this.gl.createShader(t);return null==o?(alert("An error occurred creating the shaders"),null):(n.shaderSource(o,e),n.compileShader(o),this.gl.getShaderParameter(o,n.COMPILE_STATUS)?o:(alert("An error occurred compiling the shaders: "+n.getShaderInfoLog(o)),n.deleteShader(o),null))}createProgram(t,e){const n=this.gl,o=n.createProgram();return null==o?(alert("An error occurred creating the program"),null):(n.attachShader(o,t),n.attachShader(o,e),n.linkProgram(o),n.getProgramParameter(o,n.LINK_STATUS)?o:(alert("Unable to initialize the shader program: "+n.getProgramInfoLog(o)),null))}storeUniformAndAttribLocations(){if(this.program){for(let t=0;t<this.gl.getProgramParameter(this.program,this.gl.ACTIVE_UNIFORMS);t++){const e=this.gl.getActiveUniform(this.program,t);e&&(this.uniformLocations[e.name]={type:e.type,loc:this.gl.getUniformLocation(this.program,e.name)})}for(let t=0;t<this.gl.getProgramParameter(this.program,this.gl.ACTIVE_ATTRIBUTES);t++){const e=this.gl.getActiveAttrib(this.program,t).name;this.attribLocations[e]=this.gl.getAttribLocation(this.program,e)}}}lookupAttribLocation(t){const e=this.attribLocations[t];return null!=e?e:null}lookupAttribLocationStrict(t){const e=this.lookupAttribLocation(t);if(null==e)throw new Error(`"${t}" attribute not found in shader attribLocations`);if(e<0)throw new Error(`"${t}" not found in shader program`);return e}lookupUniformLocation(t){const e=this.uniformLocations[t];return e?e.loc:null}bind(t){this.gl.useProgram(this.program);for(let t of Object.keys(this.attribLocations)){const e=this.attribLocations[t];e>-1&&this.gl.enableVertexAttribArray(e)}this.setUniforms(t)}setUniforms(t){console.warn("calling setUniforms on base shader class")}setUniform(t,e){const n=this.gl,o=this.uniformLocations[t];if(o)switch(o.type){case n.FLOAT:n.uniform1f(o.loc,e);break;case n.FLOAT_VEC3:n.uniform3fv(o.loc,e);break;case n.FLOAT_VEC4:n.uniform4fv(o.loc,e);break;case n.INT:n.uniform1i(o.loc,e);break;case n.FLOAT_MAT3:n.uniformMatrix3fv(o.loc,!1,e);break;case n.FLOAT_MAT4:n.uniformMatrix4fv(o.loc,!1,e);break;default:console.warn("couldn't set uniform:",t,o)}else console.warn("Unknown uniform: "+t)}}class Oe extends Ne{constructor(t){super(t,e("#version 300 es\n#define GLSLIFY 1\n\nuniform mat4 u_RubikMatrix;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_ViewMatrix;\nuniform mat4 u_ProjectionMatrix;\n\nin vec4 a_VertexPosition;\nin vec3 a_VertexColor;\nin vec3 a_VertexNormal;\n\nout vec3 v_Color;\nout vec3 v_Normal;\nout vec3 v_FragPosition;\n\nvoid main() {\n    vec4 position = u_RubikMatrix * u_ModelMatrix * a_VertexPosition;\n    gl_Position = u_ProjectionMatrix * u_ViewMatrix * position;\n\n    v_Color = a_VertexColor;\n    v_Normal = normalize(mat3(u_RubikMatrix * u_ModelMatrix) * a_VertexNormal);\n    v_FragPosition = position.xyz;\n}\n"),e("#version 300 es\n\nprecision highp float;\n#define GLSLIFY 1\n\n#define PI 3.1415926535897932384626433832795\n\nuniform float u_Opacity;\nuniform vec3 u_ViewPosition;\n\nuniform float u_BlockR;\nuniform float u_Spread;\nuniform float u_CurrAngle;\nuniform int u_Axis;\nuniform int u_Level;\n\nuniform int u_EnableBlocking;\nuniform int u_EnableBlockingAO;\n\nuniform vec3 u_BlockPosition;\nuniform mat4 u_RubikMatrix;\nuniform mat3 u_RubikMatrixInv;\n\nuniform samplerCube u_GGXEnvSampler;\n\nin vec3 v_Color;\nin vec3 v_Normal;\nin vec3 v_FragPosition;\n\nout vec4 fragColor;\n\nconst float BLOCK_R_1540259130 = 0.5;\n\nvec3 rotateX(vec3 v, float theta) {\n    return vec3(\n        v.x,\n        v.y * cos(theta) - v.z * sin(theta),\n        v.y * sin(theta) + v.z * cos(theta)\n    );\n}\n\nvec3 rotateY(vec3 v, float theta) {\n    return vec3(\n        v.z * sin(theta) + v.x * cos(theta),\n        v.y,\n        v.z * cos(theta) - v.x * sin(theta)\n    );\n}\n\nvec3 rotateZ(vec3 v, float theta) {\n    return vec3(\n        v.x * cos(theta) - v.y * sin(theta),\n        v.x * sin(theta) + v.y * cos(theta),\n        v.z\n    );\n}\n\nvec3 rotate(vec3 v, float theta, int axis) {\n    return axis == 0 ? rotateX(v, theta) : axis == 1 ? rotateY(v, theta) : rotateZ(v, theta);\n}\n\nbool raySphere(vec3 p0, vec3 v, vec3 center, float r) {\n    // p0 origin, v dir of the ray. center, r radius of sphere\n    vec3 p = p0 - center;\n\n    float a = dot(v, v);\n    float b = 2.0 * dot(p, v);\n    float c = dot(p, p) - r * r;\n\n    float sq = (b * b) - (4.0 * a * c);\n\n    if (sq < 0.0) {\n        return false;\n    }\n\n    float sqr = sqrt(sq);\n    return (-b + sqr) / (2.0 * a) > 0.0 || (-b - sqr) / (2.0 * a) > 0.0;\n}\n\nfloat raySphereCorner(vec3 ro, vec3 rd, vec3 size, float rad) {\n    vec3 oc = ro - size;\n    vec3 dd = rd*rd;\n    vec3 oo = oc*oc;\n    vec3 od = oc*rd;\n    float ra2 = rad*rad;\n\n    float b = od.x + od.y + od.z;\n    float c = oo.x + oo.y + oo.z - ra2;\n    float h = b*b - c;\n    if( h>0.0 ) {\n        return -b-sqrt(h);\n    }\n    return -1.0;\n}\n\nfloat checkOtherCorners(vec3 ro, vec3 rd, vec3 size, float rad) {\n    float t = raySphereCorner(ro*vec3(-1,1,1), rd*vec3(-1,1,1), size, rad);\n    if( t>0.0 ) return t;\n\n          t = raySphereCorner(ro*vec3(1,-1,1), rd*vec3(1,-1,1), size, rad);\n    if( t>0.0 ) return t;\n\n          t = raySphereCorner(ro*vec3(1,1,-1), rd*vec3(1,1,-1), size, rad);\n    if( t>0.0 ) return t;\n\n    return -1.0;\n}\n\nbool rayBox(vec3 rayOriginV, vec3 rayDirV, vec3 boxMinV, vec3 boxMaxV) {\n    vec3 rayInvDirV = 1.0/rayDirV;\n\n    float t1 = (boxMinV.x - rayOriginV.x) * rayInvDirV.x;\n    float t2 = (boxMaxV.x - rayOriginV.x) * rayInvDirV.x;\n\n    float tmin = min(t1, t2);\n    float tmax = max(t1, t2);\n\n    t1 = (boxMinV.y - rayOriginV.y) * rayInvDirV.y;\n    t2 = (boxMaxV.y - rayOriginV.y) * rayInvDirV.y;\n\n    tmin = max(tmin, min(t1, t2));\n    tmax = min(tmax, max(t1, t2));\n\n    t1 = (boxMinV.z - rayOriginV.z) * rayInvDirV.z;\n    t2 = (boxMaxV.z - rayOriginV.z) * rayInvDirV.z;\n\n    tmin = max(tmin, min(t1, t2));\n    tmax = min(tmax, max(t1, t2));\n\n    return tmin <= tmax && tmax >= 0.0;\n}\n\n// intersect a ray with a rounded box\n// https://iquilezles.org/articles/intersectors\nfloat rayRoundedBox( vec3 ro, vec3 rd, vec3 size, float rad, float sizeMin )\n{\n    // bounding box\n    vec3 m = 1.0/rd;\n    vec3 n = m*ro;\n    vec3 k = abs(m)*(size+rad);\n    vec3 t1 = -n - k;\n    vec3 t2 = -n + k;\n    float tN = max( max( t1.x, t1.y ), t1.z );\n    float tF = min( min( t2.x, t2.y ), t2.z );\n    if( tN > tF || tF < 0.0) return -1.0;\n    float t = tN;\n//    return t;\n\n    // convert to first octant\n    vec3 pos = ro+t*rd;\n    vec3 s = sign(pos);\n    ro  *= s;\n    rd  *= s;\n    pos *= s;\n\n    // faces\n    pos -= size;\n    pos = max( pos.xyz, pos.yzx );\n    if( min(min(pos.x,pos.y),pos.z)<0.0 ) return t;\n\n    // some precomputation\n    vec3 oc = ro - size;\n    vec3 dd = rd*rd;\n    vec3 oo = oc*oc;\n    vec3 od = oc*rd;\n    float ra2 = rad*rad;\n\n    t = 1e20;\n    float res = -1.0;\n\n    // corner\n    {\n        float b = od.x + od.y + od.z;\n        float c = oo.x + oo.y + oo.z - ra2;\n        float h = b*b - c;\n        if( h>0.0 ) {t = -b-sqrt(h); res = 2.0;}\n\n        if (sizeMin < rad && !(h>0.0)) {\n            float t2 = checkOtherCorners(ro, rd, size, rad);\n            if( t2>0.0 ) { t = t2; res = 4.0; };\n        }\n    }\n\n    // edge X\n    {\n        float a = dd.y + dd.z;\n        float b = od.y + od.z;\n        float c = oo.y + oo.z - ra2;\n        float h = b*b - a*c;\n        if( h>0.0 )\n        {\n            h = (-b-sqrt(h))/a;\n            if( h>0.0 && h<t && abs(ro.x+rd.x*h)<size.x ) {t = h; res=3.0;}\n        }\n    }\n    // edge Y\n    {\n        float a = dd.z + dd.x;\n        float b = od.z + od.x;\n        float c = oo.z + oo.x - ra2;\n        float h = b*b - a*c;\n        if( h>0.0 )\n        {\n            h = (-b-sqrt(h))/a;\n            if( h>0.0 && h<t && abs(ro.y+rd.y*h)<size.y ) {t = h; res=3.0;}\n        }\n    }\n    // edge Z\n    {\n        float a = dd.x + dd.y;\n        float b = od.x + od.y;\n        float c = oo.x + oo.y - ra2;\n        float h = b*b - a*c;\n        if( h>0.0 )\n        {\n            h = (-b-sqrt(h))/a;\n            if( h>0.0 && h<t && abs(ro.z+rd.z*h)<size.z ) {t = h; res=3.0;}\n        }\n    }\n\n    if( t>1e19 ) t=-1.0;\n\n    return t;\n//    return res;\n}\n\n// normal of a rounded box\nvec3 roundedBoxNormal(vec3 pos, vec3 size)\n{\n    return sign(pos)*normalize(max(abs(pos)-size,0.0));\n}\n\nfloat rayBlockIntersection(vec3 ray0, vec3 rayDir, vec3 blockPos, float blockR, float spread) {\n    ray0 -= (blockPos * spread);\n\n    float sizeOrig = (1.0-blockR)*BLOCK_R_1540259130;\n\n    return\n           blockR > 0.99\n           ? raySphereCorner(ray0, rayDir, vec3(sizeOrig), blockR*BLOCK_R_1540259130) :\n           rayRoundedBox(ray0, rayDir, vec3(sizeOrig), blockR*BLOCK_R_1540259130, sizeOrig);\n}\n\nbool raySliceIntersection(vec3 ray0, vec3 rayDir, vec3 blockMin, vec3 blockMax, float spread) {\n    return rayBox(ray0, rayDir, (blockMin*spread)-BLOCK_R_1540259130, (blockMax*spread)+BLOCK_R_1540259130);\n}\n\nvec3 adjustV(vec3 v, int axis) {\n    return axis == 1 ? v.yxz : axis == 2 ? v.zyx : v;\n}\n\nfloat blockIntersection(\n    out vec3 outReflect, mat3 mat, mat3 invMat, vec3 fragPosition, vec3 rayDir, vec3 origPos, float blockR, float spread, float currAngle, int axis, int level\n) {\n    outReflect = rayDir;\n\n    bool rotating = abs(currAngle) > 0.0;\n    vec3 invRayDir = invMat * rayDir;\n    vec3 invRay0 = invMat * fragPosition;\n\n    vec3 origPosAdj = adjustV(origPos, axis);\n    vec3 origPosCmp = (rotating && int(origPosAdj.x) == level) ? rotate(origPos, currAngle, axis) : vec3(origPos);\n\n    float t = -1.0;\n    float dist = 1e20;\n    vec3 hitPoint = vec3(0);\n    bool hitBlockRot = false;\n\n    for (int _a = -1; _a < 2; _a++) {\n        int a = origPosAdj.x < 0.0 ? _a : -_a;\n\n        vec3 iRayDir = invRayDir, iRay0 = invRay0;\n\n        if (rotating && a == level) {\n            iRayDir = rotate(iRayDir, -currAngle, axis);\n            iRay0 = rotate(iRay0, -currAngle, axis);\n        }\n        if (\n            !raySliceIntersection(iRay0, iRayDir, adjustV(vec3(a, -1, -1), axis), adjustV(vec3(a, 1, 1), axis), spread)\n        ) continue;\n\n        for (int _b = -1; _b < 2; _b++) {\n            int b = origPosAdj.y < 0.0 ? _b : -_b;\n\n            if (\n                !raySliceIntersection(iRay0, iRayDir, adjustV(vec3(a, b, -1), axis), adjustV(vec3(a, b, 1), axis), spread)\n            ) continue;\n\n            for (int _c = -1; _c < 2; _c++) {\n                int c = origPosAdj.z < 0.0 ? _c : -_c;\n\n//                if(!(a==1&&b==1&&c==1)) continue;\n\n                vec3 blockPos =  adjustV(vec3(a, b, c), axis);\n                if (distance(origPos, blockPos) < BLOCK_R_1540259130) continue;\n\n                vec3 blockPosCmp = (rotating && a == level) ? rotate(blockPos, currAngle, axis) : vec3(blockPos);\n                float dist2 = distance(origPosCmp, blockPosCmp);\n\n                if (t>=0.0 && dist <= dist2) continue;\n                float t2 = rayBlockIntersection(iRay0, iRayDir, blockPos, blockR, spread);\n\n                if (t2>=0.0 && (t2 < t || t<0.0)) {\n                    t=t2; dist=dist2; hitPoint=(iRay0-(blockPos * spread))+t2*iRayDir; hitBlockRot=(rotating && a == level);\n                }\n            }\n        }\n    }\n\n    if (t >= 0.0) {\n        vec3 newNormal = roundedBoxNormal(hitPoint, vec3((1.0-max(0.001,blockR))*BLOCK_R_1540259130));\n        if (hitBlockRot) {\n            newNormal = rotate(newNormal, currAngle, axis);\n        }\n        newNormal = normalize( mat * newNormal );\n        outReflect = normalize(reflect(rayDir, newNormal));\n    }\n\n    return t;\n}\n\nfloat blockAO(\n    mat3 invMat, vec3 fragPosition, vec3 rayDir, vec3 origPos, float blockR, float spread, float currAngle, int axis, int level\n) {\n    float pad =(spread-1.0)*0.5;\n\n    bool rotating = abs(currAngle) > 0.0;\n    vec3 invRayDir = invMat * rayDir;\n    vec3 invRay0 = invMat * fragPosition;\n\n    vec3 origPosAdj = adjustV(origPos, axis);\n    vec3 origPosCmp = (rotating && int(origPosAdj.x) == level) ? rotate(origPos, currAngle, axis) : vec3(origPos);\n\n    float t = -1.0;\n    float dist = 1e20;\n    vec3 hitPoint = vec3(0);\n    vec3 hitBlock = vec3(0);\n    vec3 hitPoint2 = vec3(0);\n\n    for (int a = -1; a < 2; a++) {\n\n        vec3 iRayDir = invRayDir, iRay0 = invRay0;\n\n        if (rotating && a == level) {\n            iRayDir = rotate(iRayDir, -currAngle, axis);\n            iRay0 = rotate(iRay0, -currAngle, axis);\n        }\n        if (\n            !raySliceIntersection(iRay0, iRayDir, adjustV(vec3(a, -1, -1), axis), adjustV(vec3(a, 1, 1), axis), spread)\n        ) continue;\n\n        for (int b = -1; b < 2; b++) {\n            if (\n                !raySliceIntersection(iRay0, iRayDir, adjustV(vec3(a, b, -1), axis), adjustV(vec3(a, b, 1), axis), spread)\n            ) continue;\n\n            for (int c = -1; c < 2; c++) {\n                if(!(a==1&&b==1&&c==1)) continue;\n                vec3 blockPos =  adjustV(vec3(a, b, c), axis);\n                if (distance(origPos, blockPos) < BLOCK_R_1540259130) continue;\n\n                vec3 blockPosCmp = (rotating && a == level) ? rotate(blockPos, currAngle, axis) : vec3(blockPos);\n                float dist2 = distance(origPosCmp, blockPosCmp);\n\n//                if (dist2 > 1.99999) continue;  // blocks further than this (sqrt of 3) shouldnt contribute to AO\n\n                if (t>0.0 && dist <= dist2) continue;\n                float t2 = rayBlockIntersection(iRay0, iRayDir, blockPos, blockR, spread);\n\n                if (t2>0.0 && (t2 < t || t<0.0)) {\n                    t=t2; dist=dist2; hitPoint=iRay0+t2*iRayDir; hitPoint2=(iRay0-(blockPos * spread))+t2*iRayDir; hitBlock=blockPos;\n                }\n            }\n        }\n    }\n\n    float ao = 1.0;\n\n//    return vec2(t, ao);\n\n    if (t > 0.0) {\n        float r = blockR * BLOCK_R_1540259130;\n        float w = 2.0 * r + spread - 1.0;\n        float blockTop = blockR < 0.01 ? 0.0 : (2.0 * (r - r * sin(acos(r/w))));\n\n        float surfaceTravel = (spread - 1.0) * 2.0 + blockR;\n        float spaceTravel = (spread - 1.0/spread) + (blockR*blockR*blockR/1.5);\n\n        float shadowR = 0.5 * (1.0-blockR);\n        float outerBoxR = spread + BLOCK_R_1540259130;\n        vec3 pos = abs(hitPoint);\n        vec3 edgeDist = max(pos - (outerBoxR-blockTop-surfaceTravel), 0.0) / surfaceTravel;\n        vec3 edgeDistB = max(abs(invRay0) - (outerBoxR-blockTop-surfaceTravel), 0.0) / surfaceTravel;\n        edgeDist = length(edgeDist) > length(edgeDistB) ? edgeDist : edgeDistB;\n\n        vec3 light1 = edgeDist.y > edgeDist.x && edgeDist.y > edgeDist.z ? edgeDist.yxz :\n                     edgeDist.z > edgeDist.x && edgeDist.z > edgeDist.y ? edgeDist.zyx : edgeDist.xyz;\n        light1 = light1.z > light1.y ? light1.xzy : light1.xyz;\n\n        float ao1 = light1.y < shadowR ? max(light1.x, light1.y) : shadowR + length(light1.xy - shadowR);\n\n        vec3 facingOut = -(sign(hitPoint2) * sign(hitBlock));\n        facingOut = clamp(facingOut + 1.0, 0.0, 1.0) * 2.0 - 1.0; // change -1, 0, 1 to -1, 1, 1\n        vec3 pos2b = abs(hitPoint2);\n        vec3 pos2 = pos2b * facingOut;\n        pos2 = pos2b.x > pos2b.y && pos2b.x > pos2b.z ? vec3(     0, pos2.y, pos2.z) :\n               pos2b.y > pos2b.x && pos2b.y > pos2b.z ? vec3(pos2.x,      0, pos2.z) :\n                                                        vec3(pos2.x, pos2.y,      0) ;\n\n        vec3 edgeDist2 = max(pos2 - (BLOCK_R_1540259130-blockTop-surfaceTravel), 0.0) / surfaceTravel;\n\n        vec3 invRayOrig = (rotating && int(origPosAdj.x) == level) ? rotate(invRay0, -currAngle, axis) : invRay0;\n        invRayOrig -= (origPos*spread);\n\n        facingOut = -(sign(invRayOrig) * sign(origPos));\n        facingOut = clamp(facingOut + 1.0, 0.0, 1.0) * 2.0 - 1.0; // change -1, 0, 1 to -1, 1, 1\n        pos2b = abs(invRayOrig);\n        int facing = pos2b.x > pos2b.y && pos2b.x > pos2b.z ? 0 : pos2b.y > pos2b.x && pos2b.y > pos2b.z ? 1 : 2;\n        pos2 = pos2b * facingOut;\n        pos2 = facing == 0 ? vec3(     0, pos2.y, pos2.z) :\n               facing == 1 ? vec3(pos2.x,      0, pos2.z) :\n                             vec3(pos2.x, pos2.y,      0) ;\n\n        vec3 edgeDist2B = max(pos2 - (BLOCK_R_1540259130-blockTop-surfaceTravel), 0.0) / surfaceTravel;\n        edgeDist2 = length(edgeDist2) > length(edgeDist2B) ? edgeDist2 : edgeDist2B;\n\n        vec3 light2 = edgeDist2.y > edgeDist2.x && edgeDist2.y > edgeDist2.z ? edgeDist2.yxz :\n                      edgeDist2.z > edgeDist2.x && edgeDist2.z > edgeDist2.y ? edgeDist2.zyx : edgeDist2.xyz;\n        light2 = light2.z > light2.y ? light2.xzy : light2.xyz;\n\n        float ao2 = light2.y < shadowR ? max(light2.x, light2.y) : shadowR + length(light2.xy - shadowR);\n        ao2 *= spaceTravel;\n\n//        float ao3 = 0.0;\n//        if (check==1&& rotating && facing != axis && abs(int(origPosAdj.x) - level) == 1) {\n//            vec3 invRay0Adj =  adjustV(invRay0, axis);\n//            ao3 = 1.0 - abs(float(level) - invRay0Adj.x);\n//\n//            vec3 testDir = adjustV(vec3(1,0,0), axis != 0 && facing != 0 ? 0 : axis != 1 && facing != 1 ? 1 : 2) * -sign(invRay0);\n//            vec3 test0 = (-testDir * (outerBoxR * sign(invRay0) - invRay0)) + invRay0;\n//\n//            float testRes = rayBoxT(rotate(test0, -currAngle, axis), rotate(testDir, -currAngle, axis), vec3(outerBoxR)).x;\n////            return vec4(t,testRes>0.0?vec3(0,testRes,0):vec3(-testRes,0,0));\n//\n//            vec3 edgeDist3 = max(abs(invRay0) - (outerBoxR-blockTop-(testRes>0.0?testRes*5.0: 0.0)-surfaceTravel), 0.0) / surfaceTravel;\n//            ao3 *= length(edgeDist3);\n//            float deg45 = 3.14159265359 * 0.25;\n//            ao3 = clamp(ao3, 0.0, 1.0) * (1.0 - abs(mod(abs(currAngle), deg45*2.0) - deg45) / deg45);\n//        }\n\n        ao = clamp(length(vec2(ao1, ao2)), 0.0, 1.0);\n        //        ao = clamp(length(vec3(ao1, ao2, ao3)), 0.0, 1.0);\n    }\n    return ao;\n}\n\nvec3 toneMap(vec3 color) {\n    return pow(color, vec3(1.0/2.2));\n}\n\nfloat _blockAO() {\n//    return u_EnableBlockingAO == 1 ? blockAO(\n//        u_RubikMatrixInv, v_FragPosition, u_BlockPosition, u_BlockR, u_Spread, u_CurrAngle, u_Axis, u_Level\n//    ) : 1.0;\n    return 1.0;\n}\n\nfloat _blockIntersection(vec3 rayDir, out vec3 outReflect) {\n    return u_EnableBlocking == 1 ? blockIntersection(\n        outReflect, mat3(u_RubikMatrix), u_RubikMatrixInv, v_FragPosition, rayDir, u_BlockPosition, u_BlockR, u_Spread, u_CurrAngle, u_Axis, u_Level\n    ) : -1.0;\n}\n\nvoid main() {\n    vec3 normal = v_Normal;\n\n    vec3 directionalLightVector1 = vec3(0, 0, 1);\n    vec3 directionalLightColor1 = vec3(1, 1, 1);\n    float directionalLightStrength1 = 0.7;\n\n    // reflection\n    vec3 viewDir = normalize(u_ViewPosition - v_FragPosition);\n    vec3 reflectVector = reflect(-viewDir, normalize(normal));\n\n    float t = _blockIntersection(reflectVector, reflectVector);\n    float ao = _blockAO();\n\n    vec3 reflection = toneMap(textureLod(u_GGXEnvSampler, reflectVector, 0.0).rgb);\n    vec3 someReflection = 0.75 * reflection;\n\n    // ambient\n    vec3 ambient = vec3(0.3);\n\n    // diffuse\n    float NdotL1 = max(dot(normal, directionalLightVector1), 0.0);\n    vec3 diffuse = (directionalLightStrength1 * directionalLightColor1 * NdotL1);\n\n    vec3 lighting = ambient + diffuse;\n\n    vec3 finalColor = lighting * v_Color + someReflection;\n    finalColor *= ao;\n\n    fragColor = vec4(finalColor, u_Opacity);\n\n//    float greyF = 0.0;\n//    float lightF = 0.0;\n//\n//    float grey = finalColor.g*0.59 + finalColor.r*0.3 + finalColor.b*0.11;\n//    vec3 mixed = greyF*vec3(grey) + (1.0-greyF)*finalColor;\n//    vec3 lightened = mixed * (1.0-lightF) + lightF;\n//\n//    fragColor = vec4(lightened, u_Opacity);\n}\n")),this.vertexPosition=this.lookupAttribLocationStrict("a_VertexPosition"),this.vertexColor=this.lookupAttribLocationStrict("a_VertexColor"),this.vertexNormal=this.lookupAttribLocationStrict("a_VertexNormal")}setUniforms(t){this.setUniform("u_ProjectionMatrix",t.projectionMatrix),this.setUniform("u_ViewMatrix",t.viewMatrix),this.setUniform("u_ViewPosition",t.position)}}class Ge extends Ne{constructor(t){super(t,e("#version 300 es\n#define GLSLIFY 1\n\nuniform mat4 u_ViewMatrix;\nuniform mat4 u_ProjectionMatrix;\n\nuniform mat3 u_EnvRotation;\n\nin vec3 a_position;\nout vec3 v_TexCoords;\n\nvoid main()\n{\n    v_TexCoords = u_EnvRotation * a_position;\n\n    mat4 mat = u_ProjectionMatrix * u_ViewMatrix;\n    mat[3] = vec4(0.0, 0.0, 0.0, 0.1);\n    vec4 pos = mat * vec4(a_position, 1.0);\n    gl_Position = pos.xyww;\n}\n"),e("#version 300 es\n\nprecision highp float;\n#define GLSLIFY 1\n\nuniform float u_EnvBlurNormalized;\nuniform int u_MipCount;\nuniform samplerCube u_GGXEnvSampler;\n\nuniform vec3 u_EnvColor;\n\nin vec3 v_TexCoords;\n\nout vec4 FragColor;\n\nvec3 toneMap(vec3 color) {\n    return pow(color, vec3(1.0/2.2));\n}\n\nvec3 desaturate(vec3 color) {\n    float greyF = 0.75;\n    float grey = color.g*0.59 + color.r*0.3 + color.b*0.11;\n    return mix(color, vec3(grey), greyF);\n}\n\nvec3 colorLighting(vec3 color) {\n    float strength = 0.5;\n    return color * (1.0+strength*(u_EnvColor - vec3(0.5)));\n}\n\nvoid main() {\n    vec4 color = textureLod(u_GGXEnvSampler, v_TexCoords, u_EnvBlurNormalized * float(u_MipCount - 1));\n\n    vec3 finalColor = colorLighting(desaturate(color.rgb));\n\n    FragColor = vec4(toneMap(finalColor), 1);\n}\n")),this.vertexPosition=this.lookupAttribLocationStrict("a_position")}setUniforms(t){this.setUniform("u_ProjectionMatrix",t.projectionMatrix),this.setUniform("u_ViewMatrix",t.viewMatrix)}}var Ve={};function Xe(){var t=new l(9);return l!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function He(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function We(t){var e=new l(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function qe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function je(t,e,n,o,r,i,a,s,c){var u=new l(9);return u[0]=t,u[1]=e,u[2]=n,u[3]=o,u[4]=r,u[5]=i,u[6]=a,u[7]=s,u[8]=c,u}function Ye(t,e,n,o,r,i,a,s,c,l){return t[0]=e,t[1]=n,t[2]=o,t[3]=r,t[4]=i,t[5]=a,t[6]=s,t[7]=c,t[8]=l,t}function $e(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Qe(t,e){if(t===e){var n=e[1],o=e[2],r=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=o,t[7]=r}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function Ze(t,e){var n=e[0],o=e[1],r=e[2],i=e[3],a=e[4],s=e[5],c=e[6],l=e[7],u=e[8],h=u*a-s*l,f=-u*i+s*c,v=l*i-a*c,m=n*h+o*f+r*v;return m?(m=1/m,t[0]=h*m,t[1]=(-u*o+r*l)*m,t[2]=(s*o-r*a)*m,t[3]=f*m,t[4]=(u*n-r*c)*m,t[5]=(-s*n+r*i)*m,t[6]=v*m,t[7]=(-l*n+o*c)*m,t[8]=(a*n-o*i)*m,t):null}function Ke(t,e){var n=e[0],o=e[1],r=e[2],i=e[3],a=e[4],s=e[5],c=e[6],l=e[7],u=e[8];return t[0]=a*u-s*l,t[1]=r*l-o*u,t[2]=o*s-r*a,t[3]=s*c-i*u,t[4]=n*u-r*c,t[5]=r*i-n*s,t[6]=i*l-a*c,t[7]=o*c-n*l,t[8]=n*a-o*i,t}function Je(t){var e=t[0],n=t[1],o=t[2],r=t[3],i=t[4],a=t[5],s=t[6],c=t[7],l=t[8];return e*(l*i-a*c)+n*(-l*r+a*s)+o*(c*r-i*s)}function tn(t,e,n){var o=e[0],r=e[1],i=e[2],a=e[3],s=e[4],c=e[5],l=e[6],u=e[7],h=e[8],f=n[0],v=n[1],m=n[2],d=n[3],p=n[4],g=n[5],b=n[6],x=n[7],M=n[8];return t[0]=f*o+v*a+m*l,t[1]=f*r+v*s+m*u,t[2]=f*i+v*c+m*h,t[3]=d*o+p*a+g*l,t[4]=d*r+p*s+g*u,t[5]=d*i+p*c+g*h,t[6]=b*o+x*a+M*l,t[7]=b*r+x*s+M*u,t[8]=b*i+x*c+M*h,t}function en(t,e,n){var o=e[0],r=e[1],i=e[2],a=e[3],s=e[4],c=e[5],l=e[6],u=e[7],h=e[8],f=n[0],v=n[1];return t[0]=o,t[1]=r,t[2]=i,t[3]=a,t[4]=s,t[5]=c,t[6]=f*o+v*a+l,t[7]=f*r+v*s+u,t[8]=f*i+v*c+h,t}function nn(t,e,n){var o=e[0],r=e[1],i=e[2],a=e[3],s=e[4],c=e[5],l=e[6],u=e[7],h=e[8],f=Math.sin(n),v=Math.cos(n);return t[0]=v*o+f*a,t[1]=v*r+f*s,t[2]=v*i+f*c,t[3]=v*a-f*o,t[4]=v*s-f*r,t[5]=v*c-f*i,t[6]=l,t[7]=u,t[8]=h,t}function on(t,e,n){var o=n[0],r=n[1];return t[0]=o*e[0],t[1]=o*e[1],t[2]=o*e[2],t[3]=r*e[3],t[4]=r*e[4],t[5]=r*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function rn(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function an(t,e){var n=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=n,t[2]=0,t[3]=-n,t[4]=o,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function sn(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function cn(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function ln(t,e){var n=e[0],o=e[1],r=e[2],i=e[3],a=n+n,s=o+o,c=r+r,l=n*a,u=o*a,h=o*s,f=r*a,v=r*s,m=r*c,d=i*a,p=i*s,g=i*c;return t[0]=1-h-m,t[3]=u-g,t[6]=f+p,t[1]=u+g,t[4]=1-l-m,t[7]=v-d,t[2]=f-p,t[5]=v+d,t[8]=1-l-h,t}function un(t,e){var n=e[0],o=e[1],r=e[2],i=e[3],a=e[4],s=e[5],c=e[6],l=e[7],u=e[8],h=e[9],f=e[10],v=e[11],m=e[12],d=e[13],p=e[14],g=e[15],b=n*s-o*a,x=n*c-r*a,M=n*l-i*a,y=o*c-r*s,_=o*l-i*s,R=r*l-i*c,T=u*d-h*m,C=u*p-f*m,k=u*g-v*m,E=h*p-f*d,w=h*g-v*d,P=f*g-v*p,S=b*P-x*w+M*E+y*k-_*C+R*T;return S?(S=1/S,t[0]=(s*P-c*w+l*E)*S,t[1]=(c*k-a*P-l*C)*S,t[2]=(a*w-s*k+l*T)*S,t[3]=(r*w-o*P-i*E)*S,t[4]=(n*P-r*k+i*C)*S,t[5]=(o*k-n*w-i*T)*S,t[6]=(d*R-p*_+g*y)*S,t[7]=(p*M-m*R-g*x)*S,t[8]=(m*_-d*M+g*b)*S,t):null}function hn(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function fn(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function vn(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}function mn(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t}function dn(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}function pn(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t}function gn(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t[2]=e[2]+n[2]*o,t[3]=e[3]+n[3]*o,t[4]=e[4]+n[4]*o,t[5]=e[5]+n[5]*o,t[6]=e[6]+n[6]*o,t[7]=e[7]+n[7]*o,t[8]=e[8]+n[8]*o,t}function bn(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function xn(t,e){var n=t[0],o=t[1],r=t[2],i=t[3],a=t[4],s=t[5],l=t[6],u=t[7],h=t[8],f=e[0],v=e[1],m=e[2],d=e[3],p=e[4],g=e[5],b=e[6],x=e[7],M=e[8];return Math.abs(n-f)<=c*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(o-v)<=c*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(r-m)<=c*Math.max(1,Math.abs(r),Math.abs(m))&&Math.abs(i-d)<=c*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(a-p)<=c*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(s-g)<=c*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(l-b)<=c*Math.max(1,Math.abs(l),Math.abs(b))&&Math.abs(u-x)<=c*Math.max(1,Math.abs(u),Math.abs(x))&&Math.abs(h-M)<=c*Math.max(1,Math.abs(h),Math.abs(M))}t(Ve,"create",(()=>Xe)),t(Ve,"fromMat4",(()=>He)),t(Ve,"clone",(()=>We)),t(Ve,"copy",(()=>qe)),t(Ve,"fromValues",(()=>je)),t(Ve,"set",(()=>Ye)),t(Ve,"identity",(()=>$e)),t(Ve,"transpose",(()=>Qe)),t(Ve,"invert",(()=>Ze)),t(Ve,"adjoint",(()=>Ke)),t(Ve,"determinant",(()=>Je)),t(Ve,"multiply",(()=>tn)),t(Ve,"translate",(()=>en)),t(Ve,"rotate",(()=>nn)),t(Ve,"scale",(()=>on)),t(Ve,"fromTranslation",(()=>rn)),t(Ve,"fromRotation",(()=>an)),t(Ve,"fromScaling",(()=>sn)),t(Ve,"fromMat2d",(()=>cn)),t(Ve,"fromQuat",(()=>ln)),t(Ve,"normalFromMat4",(()=>un)),t(Ve,"projection",(()=>hn)),t(Ve,"str",(()=>fn)),t(Ve,"frob",(()=>vn)),t(Ve,"add",(()=>mn)),t(Ve,"subtract",(()=>dn)),t(Ve,"multiplyScalar",(()=>pn)),t(Ve,"multiplyScalarAndAdd",(()=>gn)),t(Ve,"exactEquals",(()=>bn)),t(Ve,"equals",(()=>xn)),t(Ve,"mul",(()=>Mn)),t(Ve,"sub",(()=>yn));var Mn=tn,yn=dn,_n={};function Rn(){var t=new l(2);return l!=Float32Array&&(t[0]=0,t[1]=0),t}function Tn(t){var e=new l(2);return e[0]=t[0],e[1]=t[1],e}function Cn(t,e){var n=new l(2);return n[0]=t,n[1]=e,n}function kn(t,e){return t[0]=e[0],t[1]=e[1],t}function En(t,e,n){return t[0]=e,t[1]=n,t}function wn(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function Pn(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function Sn(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t}function An(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t}function Ln(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function In(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function Dn(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t}function zn(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t}function Un(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function Bn(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t}function Fn(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t}function Nn(t,e){var n=e[0]-t[0],o=e[1]-t[1];return Math.hypot(n,o)}function On(t,e){var n=e[0]-t[0],o=e[1]-t[1];return n*n+o*o}function Gn(t){var e=t[0],n=t[1];return Math.hypot(e,n)}function Vn(t){var e=t[0],n=t[1];return e*e+n*n}function Xn(t,e){return t[0]=-e[0],t[1]=-e[1],t}function Hn(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function Wn(t,e){var n=e[0],o=e[1],r=n*n+o*o;return r>0&&(r=1/Math.sqrt(r)),t[0]=e[0]*r,t[1]=e[1]*r,t}function qn(t,e){return t[0]*e[0]+t[1]*e[1]}function jn(t,e,n){var o=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=o,t}function Yn(t,e,n,o){var r=e[0],i=e[1];return t[0]=r+o*(n[0]-r),t[1]=i+o*(n[1]-i),t}function $n(t,e){e=e||1;var n=2*u()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t}function Qn(t,e,n){var o=e[0],r=e[1];return t[0]=n[0]*o+n[2]*r,t[1]=n[1]*o+n[3]*r,t}function Zn(t,e,n){var o=e[0],r=e[1];return t[0]=n[0]*o+n[2]*r+n[4],t[1]=n[1]*o+n[3]*r+n[5],t}function Kn(t,e,n){var o=e[0],r=e[1];return t[0]=n[0]*o+n[3]*r+n[6],t[1]=n[1]*o+n[4]*r+n[7],t}function Jn(t,e,n){var o=e[0],r=e[1];return t[0]=n[0]*o+n[4]*r+n[12],t[1]=n[1]*o+n[5]*r+n[13],t}function to(t,e,n,o){var r=e[0]-n[0],i=e[1]-n[1],a=Math.sin(o),s=Math.cos(o);return t[0]=r*s-i*a+n[0],t[1]=r*a+i*s+n[1],t}function eo(t,e){var n=t[0],o=t[1],r=e[0],i=e[1],a=Math.sqrt(n*n+o*o)*Math.sqrt(r*r+i*i),s=a&&(n*r+o*i)/a;return Math.acos(Math.min(Math.max(s,-1),1))}function no(t){return t[0]=0,t[1]=0,t}function oo(t){return"vec2("+t[0]+", "+t[1]+")"}function ro(t,e){return t[0]===e[0]&&t[1]===e[1]}function io(t,e){var n=t[0],o=t[1],r=e[0],i=e[1];return Math.abs(n-r)<=c*Math.max(1,Math.abs(n),Math.abs(r))&&Math.abs(o-i)<=c*Math.max(1,Math.abs(o),Math.abs(i))}t(_n,"create",(()=>Rn)),t(_n,"clone",(()=>Tn)),t(_n,"fromValues",(()=>Cn)),t(_n,"copy",(()=>kn)),t(_n,"set",(()=>En)),t(_n,"add",(()=>wn)),t(_n,"subtract",(()=>Pn)),t(_n,"multiply",(()=>Sn)),t(_n,"divide",(()=>An)),t(_n,"ceil",(()=>Ln)),t(_n,"floor",(()=>In)),t(_n,"min",(()=>Dn)),t(_n,"max",(()=>zn)),t(_n,"round",(()=>Un)),t(_n,"scale",(()=>Bn)),t(_n,"scaleAndAdd",(()=>Fn)),t(_n,"distance",(()=>Nn)),t(_n,"squaredDistance",(()=>On)),t(_n,"length",(()=>Gn)),t(_n,"squaredLength",(()=>Vn)),t(_n,"negate",(()=>Xn)),t(_n,"inverse",(()=>Hn)),t(_n,"normalize",(()=>Wn)),t(_n,"dot",(()=>qn)),t(_n,"cross",(()=>jn)),t(_n,"lerp",(()=>Yn)),t(_n,"random",(()=>$n)),t(_n,"transformMat2",(()=>Qn)),t(_n,"transformMat2d",(()=>Zn)),t(_n,"transformMat3",(()=>Kn)),t(_n,"transformMat4",(()=>Jn)),t(_n,"rotate",(()=>to)),t(_n,"angle",(()=>eo)),t(_n,"zero",(()=>no)),t(_n,"str",(()=>oo)),t(_n,"exactEquals",(()=>ro)),t(_n,"equals",(()=>io)),t(_n,"len",(()=>ao)),t(_n,"sub",(()=>so)),t(_n,"mul",(()=>co)),t(_n,"div",(()=>lo)),t(_n,"dist",(()=>uo)),t(_n,"sqrDist",(()=>ho)),t(_n,"sqrLen",(()=>fo)),t(_n,"forEach",(()=>vo));var ao=Gn,so=Pn,co=Sn,lo=An,uo=Nn,ho=On,fo=Vn,vo=function(){var t=Rn();return function(e,n,o,r,i,a){var s,c;for(n||(n=2),o||(o=0),c=r?Math.min(r*n+o,e.length):e.length,s=o;s<c;s+=n)t[0]=e[s],t[1]=e[s+1],i(t,t,a),e[s]=t[0],e[s+1]=t[1];return e}}();async function mo(t){let e="",n=0;const o=t;let r;for(;!e.match(/\n\n[^\n]+\n/g);)e+=String.fromCharCode(o[n++]);if(r=e.match(/FORMAT=(.*)$/m),r.length<2)return;if(r=r[1],"32-bit_rle_rgbe"!=r)return console.warn("unknown format : "+r),void this.onerror();let i=e.split(/\n/).reverse();if(i.length<2)return;if(i=i[1].split(" "),i.length<4)return;const a=1*i[3],s=1*i[1],c=new Uint8Array(a*s*4);let l=0;for(let t=0;t<s;t++){const t=[];let e=o.slice(n,n+=4);if(2==e[0]&&2==e[1]&&e[2]==(a>>8&255)&&e[3]==(255&a)&&a>=8&&a<32768){for(let e=0;e<4;e++){let r=e*a;const i=(e+1)*a;let s,c;for(;r<i;)if(s=o.slice(n,n+=2),s[0]>128)for(c=s[0]-128;c-- >0;)t[r++]=s[1];else for(c=s[0]-1,t[r++]=s[1];c-- >0;)t[r++]=o[n++]}for(let e=0;e<a;e++)c[l++]=t[e+0*a],c[l++]=t[e+1*a],c[l++]=t[e+2*a],c[l++]=t[e+3*a]}else{n-=4;for(let t=0;t<a;t++)e=o.slice(n,n+=4),c[l++]=e[0],c[l++]=e[1],c[l++]=e[2],c[l++]=e[3]}}const u=function(t){const e=t.byteLength>>2,n=new Float32Array(3*e);for(let o=0;o<e;o++){const e=Math.pow(2,t[4*o+3]-136);n[3*o]=t[4*o]*e,n[3*o+1]=t[4*o+1]*e,n[3*o+2]=t[4*o+2]*e}return n}(c);return{dataFloat:u,width:a,height:s}}var po;po="#version 300 es\n\nprecision highp float;\n#define GLSLIFY 1\n\nout vec2 texCoord;\n\nvoid main(void) \n{\n    float x = float((gl_VertexID & 1) << 2);\n    float y = float((gl_VertexID & 2) << 1);\n    texCoord.x = x * 0.5;\n    texCoord.y = y * 0.5;\n    gl_Position = vec4(x - 1.0, y - 1.0, 0, 1);\n}";class go extends Ne{constructor(t){super(t,e(po),e("#version 300 es\n\n//#version 450\n//#extension GL_ARB_separate_shader_objects : enable\n\nprecision mediump float;\n#define GLSLIFY 1\n#define MATH_PI 3.1415926535897932384626433832795\n//#define MATH_INV_PI (1.0 / MATH_PI)\n\nuniform samplerCube uCubeMap;\n\n// enum\nconst int cLambertian = 0;\nconst int cGGX = 1;\nconst int cCharlie = 2;\n\n//layout(push_constant) uniform FilterParameters {\nuniform  float u_roughness;\nuniform  int u_sampleCount;\nuniform  int u_width;\nuniform  float u_lodBias;\nuniform  int u_distribution; // enum\nuniform int u_currentFace;\nuniform int u_isGeneratingLUT;\n\n//layout (location = 0) in vec2 inUV;\nin vec2 texCoord;\n\nout vec4 fragmentColor;\n\n//layout(location = 6) out vec3 outLUT;\n\nvec3 uvToXYZ(int face, vec2 uv)\n{\n    if(face == 0)\n        return vec3(     1.f,   uv.y,    -uv.x);\n\n    else if(face == 1)\n        return vec3(    -1.f,   uv.y,     uv.x);\n\n    else if(face == 2)\n        return vec3(   +uv.x,   -1.f,    +uv.y);\n\n    else if(face == 3)\n        return vec3(   +uv.x,    1.f,    -uv.y);\n\n    else if(face == 4)\n        return vec3(   +uv.x,   uv.y,      1.f);\n\n    else {//if(face == 5)\n        return vec3(    -uv.x,  +uv.y,     -1.f);}\n}\n\nvec2 dirToUV(vec3 dir)\n{\n    return vec2(\n            0.5f + 0.5f * atan(dir.z, dir.x) / MATH_PI,\n            1.f - acos(dir.y) / MATH_PI);\n}\n\nfloat saturate(float v)\n{\n    return clamp(v, 0.0f, 1.0f);\n}\n\n// Hammersley Points on the Hemisphere\n// CC BY 3.0 (Holger Dammertz)\n// http://holger.dammertz.org/stuff/notes_HammersleyOnHemisphere.html\n// with adapted interface\nfloat radicalInverse_VdC(uint bits)\n{\n    bits = (bits << 16u) | (bits >> 16u);\n    bits = ((bits & 0x55555555u) << 1u) | ((bits & 0xAAAAAAAAu) >> 1u);\n    bits = ((bits & 0x33333333u) << 2u) | ((bits & 0xCCCCCCCCu) >> 2u);\n    bits = ((bits & 0x0F0F0F0Fu) << 4u) | ((bits & 0xF0F0F0F0u) >> 4u);\n    bits = ((bits & 0x00FF00FFu) << 8u) | ((bits & 0xFF00FF00u) >> 8u);\n    return float(bits) * 2.3283064365386963e-10; // / 0x100000000\n}\n\n// hammersley2d describes a sequence of points in the 2d unit square [0,1)^2\n// that can be used for quasi Monte Carlo integration\nvec2 hammersley2d(int i, int N) {\n    return vec2(float(i)/float(N), radicalInverse_VdC(uint(i)));\n}\n\n// Hemisphere Sample\n\n// TBN generates a tangent bitangent normal coordinate frame from the normal\n// (the normal must be normalized)\nmat3 generateTBN(vec3 normal)\n{\n    vec3 bitangent = vec3(0.0, 1.0, 0.0);\n\n    float NdotUp = dot(normal, vec3(0.0, 1.0, 0.0));\n    float epsilon = 0.0000001;\n    if (1.0 - abs(NdotUp) <= epsilon)\n    {\n        // Sampling +Y or -Y, so we need a more robust bitangent.\n        if (NdotUp > 0.0)\n        {\n            bitangent = vec3(0.0, 0.0, 1.0);\n        }\n        else\n        {\n            bitangent = vec3(0.0, 0.0, -1.0);\n        }\n    }\n\n    vec3 tangent = normalize(cross(bitangent, normal));\n    bitangent = cross(normal, tangent);\n\n    return mat3(tangent, bitangent, normal);\n}\n\nstruct MicrofacetDistributionSample\n{\n    float pdf;\n    float cosTheta;\n    float sinTheta;\n    float phi;\n};\n\nfloat D_GGX(float NdotH, float roughness) {\n    float a = NdotH * roughness;\n    float k = roughness / (1.0 - NdotH * NdotH + a * a);\n    return k * k * (1.0 / MATH_PI);\n}\n\n// GGX microfacet distribution\n// https://www.cs.cornell.edu/~srm/publications/EGSR07-btdf.html\n// This implementation is based on https://bruop.github.io/ibl/,\n//  https://www.tobias-franke.eu/log/2014/03/30/notes_on_importance_sampling.html\n// and https://developer.nvidia.com/gpugems/GPUGems3/gpugems3_ch20.html\nMicrofacetDistributionSample GGX(vec2 xi, float roughness)\n{\n    MicrofacetDistributionSample ggx;\n\n    // evaluate sampling equations\n    float alpha = roughness * roughness;\n    ggx.cosTheta = saturate(sqrt((1.0 - xi.y) / (1.0 + (alpha * alpha - 1.0) * xi.y)));\n    ggx.sinTheta = sqrt(1.0 - ggx.cosTheta * ggx.cosTheta);\n    ggx.phi = 2.0 * MATH_PI * xi.x;\n\n    // evaluate GGX pdf (for half vector)\n    ggx.pdf = D_GGX(ggx.cosTheta, alpha);\n\n    // Apply the Jacobian to obtain a pdf that is parameterized by l\n    // see https://bruop.github.io/ibl/\n    // Typically you'd have the following:\n    // float pdf = D_GGX(NoH, roughness) * NoH / (4.0 * VoH);\n    // but since V = N => VoH == NoH\n    ggx.pdf /= 4.0;\n\n    return ggx;\n}\n\n// NDF\nfloat D_Ashikhmin(float NdotH, float roughness)\n{\n    float alpha = roughness * roughness;\n    // Ashikhmin 2007, \"Distribution-based BRDFs\"\n    float a2 = alpha * alpha;\n    float cos2h = NdotH * NdotH;\n    float sin2h = 1.0 - cos2h;\n    float sin4h = sin2h * sin2h;\n    float cot2 = -cos2h / (a2 * sin2h);\n    return 1.0 / (MATH_PI * (4.0 * a2 + 1.0) * sin4h) * (4.0 * exp(cot2) + sin4h);\n}\n\n// NDF\nfloat D_Charlie(float sheenRoughness, float NdotH)\n{\n    sheenRoughness = max(sheenRoughness, 0.000001); //clamp (0,1]\n    float invR = 1.0 / sheenRoughness;\n    float cos2h = NdotH * NdotH;\n    float sin2h = 1.0 - cos2h;\n    return (2.0 + invR) * pow(sin2h, invR * 0.5) / (2.0 * MATH_PI);\n}\n\nMicrofacetDistributionSample Charlie(vec2 xi, float roughness)\n{\n    MicrofacetDistributionSample charlie;\n\n    float alpha = roughness * roughness;\n    charlie.sinTheta = pow(xi.y, alpha / (2.0*alpha + 1.0));\n    charlie.cosTheta = sqrt(1.0 - charlie.sinTheta * charlie.sinTheta);\n    charlie.phi = 2.0 * MATH_PI * xi.x;\n\n    // evaluate Charlie pdf (for half vector)\n    charlie.pdf = D_Charlie(alpha, charlie.cosTheta);\n\n    // Apply the Jacobian to obtain a pdf that is parameterized by l\n    charlie.pdf /= 4.0;\n\n    return charlie;\n}\n\nMicrofacetDistributionSample Lambertian(vec2 xi, float roughness)\n{\n    MicrofacetDistributionSample lambertian;\n\n    // Cosine weighted hemisphere sampling\n    // http://www.pbr-book.org/3ed-2018/Monte_Carlo_Integration/2D_Sampling_with_Multidimensional_Transformations.html#Cosine-WeightedHemisphereSampling\n    lambertian.cosTheta = sqrt(1.0 - xi.y);\n    lambertian.sinTheta = sqrt(xi.y); // equivalent to `sqrt(1.0 - cosTheta*cosTheta)`;\n    lambertian.phi = 2.0 * MATH_PI * xi.x;\n\n    lambertian.pdf = lambertian.cosTheta / MATH_PI; // evaluation for solid angle, therefore drop the sinTheta\n\n    return lambertian;\n}\n\n// getImportanceSample returns an importance sample direction with pdf in the .w component\nvec4 getImportanceSample(int sampleIndex, vec3 N, float roughness)\n{\n    // generate a quasi monte carlo point in the unit square [0.1)^2\n    vec2 xi = hammersley2d(sampleIndex, u_sampleCount);\n\n    MicrofacetDistributionSample importanceSample;\n\n    // generate the points on the hemisphere with a fitting mapping for\n    // the distribution (e.g. lambertian uses a cosine importance)\n    if(u_distribution == cLambertian)\n    {\n        importanceSample = Lambertian(xi, roughness);\n    }\n    else if(u_distribution == cGGX)\n    {\n        // Trowbridge-Reitz / GGX microfacet model (Walter et al)\n        // https://www.cs.cornell.edu/~srm/publications/EGSR07-btdf.html\n        importanceSample = GGX(xi, roughness);\n    }\n    else if(u_distribution == cCharlie)\n    {\n        importanceSample = Charlie(xi, roughness);\n    }\n\n    // transform the hemisphere sample to the normal coordinate frame\n    // i.e. rotate the hemisphere to the normal direction\n    vec3 localSpaceDirection = normalize(vec3(\n        importanceSample.sinTheta * cos(importanceSample.phi), \n        importanceSample.sinTheta * sin(importanceSample.phi), \n        importanceSample.cosTheta\n    ));\n    mat3 TBN = generateTBN(N);\n    vec3 direction = TBN * localSpaceDirection;\n\n    return vec4(direction, importanceSample.pdf);\n}\n\n// Mipmap Filtered Samples (GPU Gems 3, 20.4)\n// https://developer.nvidia.com/gpugems/gpugems3/part-iii-rendering/chapter-20-gpu-based-importance-sampling\n// https://cgg.mff.cuni.cz/~jaroslav/papers/2007-sketch-fis/Final_sap_0073.pdf\nfloat computeLod(float pdf)\n{\n    // // Solid angle of current sample -- bigger for less likely samples\n    // float omegaS = 1.0 / (float(u_sampleCount) * pdf);\n    // // Solid angle of texel\n    // // note: the factor of 4.0 * MATH_PI \n    // float omegaP = 4.0 * MATH_PI / (6.0 * float(u_width) * float(u_width));\n    // // Mip level is determined by the ratio of our sample's solid angle to a texel's solid angle \n    // // note that 0.5 * log2 is equivalent to log4\n    // float lod = 0.5 * log2(omegaS / omegaP);\n\n    // babylon introduces a factor of K (=4) to the solid angle ratio\n    // this helps to avoid undersampling the environment map\n    // this does not appear in the original formulation by Jaroslav Krivanek and Mark Colbert\n    // log4(4) == 1\n    // lod += 1.0;\n\n    // We achieved good results by using the original formulation from Krivanek & Colbert adapted to cubemaps\n\n    // https://cgg.mff.cuni.cz/~jaroslav/papers/2007-sketch-fis/Final_sap_0073.pdf\n    float lod = 0.5 * log2( 6.0 * float(u_width) * float(u_width) / (float(u_sampleCount) * pdf));\n\n    return lod;\n}\n\nvec3 filterColor(vec3 N)\n{\n    //return  textureLod(uCubeMap, N, 3.0).rgb;\n    vec3 color = vec3(0.f);\n    float weight = 0.0f;\n\n    for(int i = 0; i < u_sampleCount; ++i)\n    {\n        vec4 importanceSample = getImportanceSample(i, N, u_roughness);\n\n        vec3 H = vec3(importanceSample.xyz);\n        float pdf = importanceSample.w;\n\n        // mipmap filtered samples (GPU Gems 3, 20.4)\n        float lod = computeLod(pdf);\n\n        // apply the bias to the lod\n        lod += u_lodBias;\n\n        if(u_distribution == cLambertian)\n        {\n            // sample lambertian at a lower resolution to avoid fireflies\n            vec3 lambertian = textureLod(uCubeMap, H, lod).rgb;\n\n            //// the below operations cancel each other out\n            // lambertian *= NdotH; // lamberts law\n            // lambertian /= pdf; // invert bias from importance sampling\n            // lambertian /= MATH_PI; // convert irradiance to radiance https://seblagarde.wordpress.com/2012/01/08/pi-or-not-to-pi-in-game-lighting-equation/\n\n            color += lambertian;\n        }\n        else if(u_distribution == cGGX || u_distribution == cCharlie)\n        {\n            // Note: reflect takes incident vector.\n            vec3 V = N;\n            vec3 L = normalize(reflect(-V, H));\n            float NdotL = dot(N, L);\n\n            if (NdotL > 0.0)\n            {\n                if(u_roughness == 0.0)\n                {\n                    // without this the roughness=0 lod is too high\n                    lod = u_lodBias;\n                }\n                vec3 sampleColor = textureLod(uCubeMap, L, lod).rgb;\n                color += sampleColor * NdotL;\n                weight += NdotL;\n            }\n        }\n    }\n\n    if(weight != 0.0f)\n    {\n        color /= weight;\n    }\n    else\n    {\n        color /= float(u_sampleCount);\n    }\n\n    return color.rgb ;\n}\n\n// From the filament docs. Geometric Shadowing function\n// https://google.github.io/filament/Filament.html#toc4.4.2\nfloat V_SmithGGXCorrelated(float NoV, float NoL, float roughness) {\n    float a2 = pow(roughness, 4.0);\n    float GGXV = NoL * sqrt(NoV * NoV * (1.0 - a2) + a2);\n    float GGXL = NoV * sqrt(NoL * NoL * (1.0 - a2) + a2);\n    return 0.5 / (GGXV + GGXL);\n}\n\n// https://github.com/google/filament/blob/master/shaders/src/brdf.fs#L136\nfloat V_Ashikhmin(float NdotL, float NdotV)\n{\n    return clamp(1.0 / (4.0 * (NdotL + NdotV - NdotL * NdotV)), 0.0, 1.0);\n}\n\n// Compute LUT for GGX distribution.\n// See https://blog.selfshadow.com/publications/s2013-shading-course/karis/s2013_pbs_epic_notes_v2.pdf\nvec3 LUT(float NdotV, float roughness)\n{\n    // Compute spherical view vector: (sin(phi), 0, cos(phi))\n    vec3 V = vec3(sqrt(1.0 - NdotV * NdotV), 0.0, NdotV);\n\n    // The macro surface normal just points up.\n    vec3 N = vec3(0.0, 0.0, 1.0);\n\n    // To make the LUT independant from the material's F0, which is part of the Fresnel term\n    // when substituted by Schlick's approximation, we factor it out of the integral,\n    // yielding to the form: F0 * I1 + I2\n    // I1 and I2 are slighlty different in the Fresnel term, but both only depend on\n    // NoL and roughness, so they are both numerically integrated and written into two channels.\n    float A = 0.0;\n    float B = 0.0;\n    float C = 0.0;\n\n    for(int i = 0; i < u_sampleCount; ++i)\n    {\n        // Importance sampling, depending on the distribution.\n        vec4 importanceSample = getImportanceSample(i, N, roughness);\n        vec3 H = importanceSample.xyz;\n        // float pdf = importanceSample.w;\n        vec3 L = normalize(reflect(-V, H));\n\n        float NdotL = saturate(L.z);\n        float NdotH = saturate(H.z);\n        float VdotH = saturate(dot(V, H));\n        if (NdotL > 0.0)\n        {\n            if (u_distribution == cGGX)\n            {\n                // LUT for GGX distribution.\n\n                // Taken from: https://bruop.github.io/ibl\n                // Shadertoy: https://www.shadertoy.com/view/3lXXDB\n                // Terms besides V are from the GGX PDF we're dividing by.\n                float V_pdf = V_SmithGGXCorrelated(NdotV, NdotL, roughness) * VdotH * NdotL / NdotH;\n                float Fc = pow(1.0 - VdotH, 5.0);\n                A += (1.0 - Fc) * V_pdf;\n                B += Fc * V_pdf;\n                C += 0.0;\n            }\n\n            if (u_distribution == cCharlie)\n            {\n                // LUT for Charlie distribution.\n                float sheenDistribution = D_Charlie(roughness, NdotH);\n                float sheenVisibility = V_Ashikhmin(NdotL, NdotV);\n\n                A += 0.0;\n                B += 0.0;\n                C += sheenVisibility * sheenDistribution * NdotL * VdotH;\n            }\n        }\n    }\n\n    // The PDF is simply pdf(v, h) -> NDF * <nh>.\n    // To parametrize the PDF over l, use the Jacobian transform, yielding to: pdf(v, l) -> NDF * <nh> / 4<vh>\n    // Since the BRDF divide through the PDF to be normalized, the 4 can be pulled out of the integral.\n    return vec3(4.0 * A, 4.0 * B, 4.0 * 2.0 * MATH_PI * C) / float(u_sampleCount);\n}\n\n// entry point\nvoid main()\n{\n    vec3 color = vec3(0);\n\n    if(u_isGeneratingLUT == 0)\n    {\n        vec2 newUV = texCoord ;\n\n        newUV = newUV*2.0-1.0;\n\n        vec3 scan = uvToXYZ(u_currentFace, newUV);\n\n        vec3 direction = normalize(scan);\n        direction.y = -direction.y;\n    \n        color = filterColor(direction);\n    }\n    else\n    {\n        color = LUT(texCoord.x, texCoord.y);\n    }\n    \n    fragmentColor = vec4(color,1.0);\n}\n\n"))}setUniforms(t){}}class bo extends Ne{constructor(t){super(t,e(po),e("#version 300 es\n\n#define MATH_PI 3.1415926535897932384626433832795\n#define MATH_INV_PI (1.0 / MATH_PI)\n\nprecision highp float;\n#define GLSLIFY 1\n\nin vec2 texCoord;\nout vec4 fragmentColor;\n\nuniform int u_currentFace;\n\nuniform sampler2D u_inputTexture;\nuniform sampler2D u_panorama;\n\nvec3 uvToXYZ(int face, vec2 uv)\n{\n\tif(face == 0)\n\t\treturn vec3(     1.f,   uv.y,    -uv.x);\n\n\telse if(face == 1)\n\t\treturn vec3(    -1.f,   uv.y,     uv.x);\n\n\telse if(face == 2)\n\t\treturn vec3(   +uv.x,   -1.f,    +uv.y);\n\n\telse if(face == 3)\n\t\treturn vec3(   +uv.x,    1.f,    -uv.y);\n\n\telse if(face == 4)\n\t\treturn vec3(   +uv.x,   uv.y,      1.f);\n\n\telse //if(face == 5)\n\t{\treturn vec3(    -uv.x,  +uv.y,     -1.f);}\n}\n\nvec2 dirToUV(vec3 dir)\n{\n\treturn vec2(\n\t\t0.5f + 0.5f * atan(dir.z, dir.x) / MATH_PI,\n\t\t1.f - acos(dir.y) / MATH_PI);\n}\n\nvec3 panoramaToCubeMap(int face, vec2 texCoord)\n{\n\tvec2 texCoordNew = texCoord*2.0-1.0;\n\tvec3 scan = uvToXYZ(face, texCoordNew);\n\tvec3 direction = normalize(scan);\n\tvec2 src = dirToUV(direction);\n\n\treturn  texture(u_panorama, src).rgb;\n}\n\nvoid main(void)\n{\n    fragmentColor = vec4(0.0, 0.0, 0.0, 1.0);\n\n\tfragmentColor.rgb = panoramaToCubeMap(u_currentFace, texCoord);\n}\n"))}setUniforms(t){}}class xo{constructor(t){this.gl=t,this.textureSize=256,this.ggxSampleCount=1024,this.lambertianSampleCount=2048,this.sheenSamplCount=64,this.lodBias=0,this.lowestMipLevel=4,this.lutResolution=1024,this.mipmapCount=void 0,this.lambertianTextureID=void 0,this.ggxTextureID=void 0,this.sheenTextureID=void 0,this.ggxLutTextureID=void 0,this.charlieLutTextureID=void 0,this.inputTextureID=void 0,this.cubemapTextureID=void 0,this.framebuffer=void 0,this.iblShader=new go(t),this.panoShader=new bo(t)}loadTextureHDR(t){const e=this.gl.createTexture();this.gl.bindTexture(this.gl.TEXTURE_2D,e);let n,o=this.gl.RGB32F,r=this.gl.RGB,i=this.gl.FLOAT;if(t.dataFloat instanceof Float32Array&&void 0!==this.gl.RGB32F)o=this.gl.RGB32F,r=this.gl.RGB,i=this.gl.FLOAT,n=t.dataFloat;else if(t.dataFloat instanceof Float32Array){o=this.gl.RGBA32F,r=this.gl.RGBA,i=this.gl.FLOAT;const e=t.dataFloat.length/3;n=new Float32Array(4*e);for(let o=0,r=0,i=0;o<e;++o,r+=3,i+=4)n[i]=t.dataFloat[r],n[i+1]=t.dataFloat[r+1],n[i+2]=t.dataFloat[r+2],n[i+3]=0}else{if(!("undefined"!=typeof Image&&t instanceof Image))return void console.error("loadTextureHDR failed, unsupported HDR image");o=this.gl.RGBA,r=this.gl.RGBA,i=this.gl.UNSIGNED_BYTE,n=t}return this.gl.texImage2D(this.gl.TEXTURE_2D,0,o,t.width,t.height,0,r,i,n),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.MIRRORED_REPEAT),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.MIRRORED_REPEAT),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),e}internalFormat(){return this.use8bit?this.gl.RGBA8:this.gl.RGBA32F}type(){return this.use8bit?this.gl.UNSIGNED_BYTE:this.gl.FLOAT}createCubemapTexture(t){const e=this.gl.createTexture();this.gl.bindTexture(this.gl.TEXTURE_CUBE_MAP,e);for(let t=0;t<6;++t)this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,this.internalFormat(),this.textureSize,this.textureSize,0,this.gl.RGBA,this.type(),null);return t?this.gl.texParameteri(this.gl.TEXTURE_CUBE_MAP,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR_MIPMAP_LINEAR):this.gl.texParameteri(this.gl.TEXTURE_CUBE_MAP,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_CUBE_MAP,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_CUBE_MAP,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_CUBE_MAP,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),e}createLutTexture(){const t=this.gl.createTexture();return this.gl.bindTexture(this.gl.TEXTURE_2D,t),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.internalFormat(),this.lutResolution,this.lutResolution,0,this.gl.RGBA,this.type(),null),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),t}init(t){this.gl.getExtension("EXT_color_buffer_float")&&this.gl.getExtension("OES_texture_float_linear")||(console.warn("Floating point textures are not supported"),this.use8bit=!0),this.inputTextureID=this.loadTextureHDR(t),this.cubemapTextureID=this.createCubemapTexture(!0),this.framebuffer=this.gl.createFramebuffer(),this.lambertianTextureID=this.createCubemapTexture(!1),this.ggxTextureID=this.createCubemapTexture(!0),this.sheenTextureID=this.createCubemapTexture(!0),this.gl.bindTexture(this.gl.TEXTURE_CUBE_MAP,this.ggxTextureID),this.gl.generateMipmap(this.gl.TEXTURE_CUBE_MAP),this.gl.bindTexture(this.gl.TEXTURE_CUBE_MAP,this.sheenTextureID),this.gl.generateMipmap(this.gl.TEXTURE_CUBE_MAP),this.mipmapLevels=Math.floor(Math.log2(this.textureSize))+1-this.lowestMipLevel}filterAll(){this.panoramaToCubeMap(),this.cubeMapToLambertian(),this.cubeMapToGGX(),this.cubeMapToSheen(),this.sampleGGXLut(),this.sampleCharlieLut(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}panoramaToCubeMap(){for(let t=0;t<6;++t){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.framebuffer),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+t,this.cubemapTextureID,0),this.gl.bindTexture(this.gl.TEXTURE_CUBE_MAP,this.cubemapTextureID),this.gl.viewport(0,0,this.textureSize,this.textureSize),this.gl.clearColor(1,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT);const e=this.panoShader;e.bind(),this.gl.activeTexture(this.gl.TEXTURE0+0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.inputTextureID);const n=e.lookupUniformLocation("u_panorama");this.gl.uniform1i(n,0),e.setUniform("u_currentFace",t),this.gl.drawArrays(this.gl.TRIANGLES,0,3)}this.gl.bindTexture(this.gl.TEXTURE_CUBE_MAP,this.cubemapTextureID),this.gl.generateMipmap(this.gl.TEXTURE_CUBE_MAP)}applyFilter(t,e,n,o,r,i=0){const a=this.textureSize>>n;for(let s=0;s<6;++s){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.framebuffer),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+s,o,n),this.gl.bindTexture(this.gl.TEXTURE_CUBE_MAP,o),this.gl.viewport(0,0,a,a),this.gl.clearColor(1,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT);const c=this.iblShader;c.bind(),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_CUBE_MAP,this.cubemapTextureID);const l=c.lookupUniformLocation("u_cubemapTexture");this.gl.uniform1i(l,0),c.setUniform("u_roughness",e),c.setUniform("u_sampleCount",r),c.setUniform("u_width",this.textureSize),c.setUniform("u_lodBias",i),c.setUniform("u_distribution",t),c.setUniform("u_currentFace",s),c.setUniform("u_isGeneratingLUT",0),this.gl.drawArrays(this.gl.TRIANGLES,0,3)}}cubeMapToLambertian(){this.applyFilter(0,0,0,this.lambertianTextureID,this.lambertianSampleCount)}cubeMapToGGX(){for(let t=0;t<=this.mipmapLevels;++t){const e=t/(this.mipmapLevels-1);this.applyFilter(1,e,t,this.ggxTextureID,this.ggxSampleCount)}}cubeMapToSheen(){for(let t=0;t<=this.mipmapLevels;++t){const e=t/(this.mipmapLevels-1);this.applyFilter(2,e,t,this.sheenTextureID,this.sheenSamplCount)}}sampleLut(t,e,n){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.framebuffer),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,e,0),this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.viewport(0,0,n,n),this.gl.clearColor(1,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT);const o=this.iblShader;o.bind(),this.gl.activeTexture(this.gl.TEXTURE0+0),this.gl.bindTexture(this.gl.TEXTURE_CUBE_MAP,this.cubemapTextureID);const r=o.lookupUniformLocation("u_cubemapTexture");this.gl.uniform1i(r,0),o.setUniform("u_roughness",0),o.setUniform("u_sampleCount",512),o.setUniform("u_width",0),o.setUniform("u_lodBias",0),o.setUniform("u_distribution",t),o.setUniform("u_currentFace",0),o.setUniform("u_isGeneratingLUT",1),this.gl.drawArrays(this.gl.TRIANGLES,0,3)}sampleGGXLut(){this.ggxLutTextureID=this.createLutTexture(),this.sampleLut(1,this.ggxLutTextureID,this.lutResolution)}sampleCharlieLut(){this.charlieLutTextureID=this.createLutTexture(),this.sampleLut(2,this.charlieLutTextureID,this.lutResolution)}}var Mo;Mo=new URL(i("27Lyk").resolve("gTDnR"),import.meta.url).toString();var yo;yo=new URL(i("27Lyk").resolve("gnyTy"),import.meta.url).toString();var _o;_o=new URL(i("27Lyk").resolve("dvABv"),import.meta.url).toString();const Ro=(t,e,n,o)=>({magFilter:t,minFilter:e,wrapS:n,wrapT:o});const To=(t,e)=>({type:t,image:e});function Co(t){return new Promise(((e,n)=>{const o=new Image;o.addEventListener("load",(()=>e(o))),o.addEventListener("error",n),o.src=t,o.crossOrigin=""}))}const ko=(t,e,n)=>({type:n,sampler:t,source:e});class Eo{samplers=[];images=[];textures=[]}class wo extends Eo{diffuseEnvMap=0;specularEnvMap=1;sheenEnvMap=2;lut=3;sheenLUT=4}function Po(t,e,n,o,r,i=""){if(-1==e)return console.warn("uniform location not found",i,o,r),!1;let a=n.textures[o];if(null==a)return console.warn("Texture is undefined: "+o),!1;const s=n.images[a.source];return null==s?(console.warn("Image is undefined for texture: "+a.source),!1):(null==a.glTexture&&(a.glTexture=s.image),t.activeTexture(t.TEXTURE0+r),t.bindTexture(a.type,a.glTexture),t.uniform1i(e,r),!0)}async function So(t){const n=new Eo,o=Ro(t.LINEAR,t.LINEAR_MIPMAP_LINEAR,t.REPEAT,t.REPEAT);n.samplers.push(o);const r=t.TEXTURE_2D;return(await async function(t){const e=[];for(let n of t)e.push(Co(n));return Promise.all(e)}([e(Mo),e(yo),e(_o)])).forEach(((e,i)=>{const a=t.createTexture();t.bindTexture(r,a),function(t,e,n){t.texParameteri(n,t.TEXTURE_WRAP_S,e.wrapS),t.texParameteri(n,t.TEXTURE_WRAP_T,e.wrapT),t.texParameteri(n,t.TEXTURE_MIN_FILTER,e.minFilter),t.texParameteri(n,t.TEXTURE_MAG_FILTER,e.magFilter)}(t,o,r),t.texImage2D(r,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.generateMipmap(r),n.images.push(To(r,a)),n.textures.push(ko(0,i,r))})),n}async function Ao(t,e){const n=await fetch(e),o=await n.arrayBuffer(),r=await mo(new Uint8Array(o));if(!r)throw new Error("couldn't load HDR image");return async function(t,e){const n=new wo,o=new xo(t);return o.init(e),o.filterAll(),n.samplers.push(Ro(t.LINEAR,t.LINEAR,t.CLAMP_TO_EDGE,t.CLAMP_TO_EDGE)),n.images.push(To(t.TEXTURE_CUBE_MAP,o.lambertianTextureID)),n.textures.push(ko(0,0,t.TEXTURE_CUBE_MAP)),n.samplers.push(Ro(t.LINEAR,t.LINEAR_MIPMAP_LINEAR,t.CLAMP_TO_EDGE,t.CLAMP_TO_EDGE)),n.images.push(To(t.TEXTURE_CUBE_MAP,o.ggxTextureID)),n.textures.push(ko(1,1,t.TEXTURE_CUBE_MAP)),n.samplers.push(Ro(t.LINEAR,t.LINEAR_MIPMAP_LINEAR,t.CLAMP_TO_EDGE,t.CLAMP_TO_EDGE)),n.images.push(To(t.TEXTURE_CUBE_MAP,o.sheenTextureID)),n.textures.push(ko(2,2,t.TEXTURE_CUBE_MAP)),n.samplers.push(Ro(t.LINEAR,t.LINEAR,t.CLAMP_TO_EDGE,t.CLAMP_TO_EDGE)),n.images.push(To(t.TEXTURE_2D,o.ggxLutTextureID)),n.textures.push(ko(3,3,t.TEXTURE_2D)),n.images.push(To(t.TEXTURE_2D,o.charlieLutTextureID)),n.textures.push(ko(3,4,t.TEXTURE_2D)),n.mipCount=o.mipmapLevels,n}(t,r)}var Lo={},Io=function(){var t=2;function e(){this.move=[],this.moveSol=[],this.nodeUD=[],this.valid1=0,this.allowShorter=!1,this.cc=new T,this.urfCubieCube=[],this.urfCoordCube=[],this.phase1Cubie=[],this.preMoveCubes=[],this.preMoves=[],this.preMoveLen=0,this.maxPreMoves=0,this.isRec=!1;for(var t=0;t<21;t++)this.nodeUD[t]=new D,this.phase1Cubie[t]=new T;for(t=0;t<6;t++)this.urfCubieCube[t]=new T,this.urfCoordCube[t]=new D;for(t=0;t<20;t++)this.preMoveCubes[t+1]=new T}for(var n=2768,o=495,r=140,i=[],a=[1],s=["U ","U2","U'","R ","R2","R'","F ","F2","F'","D ","D2","D'","L ","L2","L'","B ","B2","B'"],c=[0,1,2,4,7,9,10,11,13,16,3,5,6,8,12,14,15,17],l=[],u=[],h=[[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17],[6,7,8,0,1,2,3,4,5,15,16,17,9,10,11,12,13,14],[3,4,5,6,7,8,0,1,2,12,13,14,15,16,17,9,10,11],[2,1,0,5,4,3,8,7,6,11,10,9,14,13,12,17,16,15],[8,7,6,2,1,0,5,4,3,17,16,15,11,10,9,14,13,12],[5,4,3,8,7,6,2,1,0,14,13,12,17,16,15,11,10,9]],f=0;f<18;f++)l[c[f]]=f;for(f=0;f<10;f++){var v=~~(c[f]/3);u[f]=0;for(var m=0;m<10;m++){var d=~~(c[m]/3);u[f]|=(v==d||v%3==d%3&&v>=d?1:0)<<m}}u[10]=0;for(f=0;f<13;f++){i[f]=[],a[f+1]=a[f]*(f+1),i[f][0]=i[f][f]=1;for(m=1;m<13;m++)i[f][m]=m<=f?i[f-1][m-1]+i[f-1][m]:0}function p(t,e,n){return n?e<<1|1&t:e|248&t}function g(t,e){return e?t>>1:7&t}function b(t,e,n){t[e>>3]^=n<<(e<<2)}function x(t,e){return t[e>>3]>>(e<<2)&15}function M(t,e,n){return Math.min(t,e[n>>3]>>(n<<2)&15)}function y(t){return 0!=(t-286331153&~t&2290649224)}function _(t){return t^14540032>>((15&t)<<1)&3}function R(t,e,n){var o=J[t];return n&&(o=_(o)),65520&o|B[15&o][e]}function T(){this.ca=[0,1,2,3,4,5,6,7],this.ea=[0,2,4,6,8,10,12,14,16,18,20,22]}function C(t,e,n,o){n--;for(var r=1985229328,i=0;i<n;++i){var s=a[n-i],c=~~(e/s);e%=s,c<<=2,t[i]=p(t[i],r>>c&15,o);var l=(1<<c)-1;r=(r&l)+(r>>4&~l)}t[n]=p(t[n],15&r,o)}function k(t,e,n){for(var o=0,r=1985229328,i=0;i<e-1;++i){var a=g(t[i],n)<<2;o=(e-i)*o+(r>>a&15),r-=286331152<<a}return o}function E(t,e,n,o){t[n-1]=p(t[n-1],0,o);for(var r=n-2;r>=0;--r){t[r]=p(t[r],e%(n-r),o),e=~~(e/(n-r));for(var i=r+1;i<n;++i)g(t[i],o)>=g(t[r],o)&&(t[i]=p(t[i],g(t[i],o)+1,o))}}function w(t,e,n){for(var o=0,r=0;r<e;++r){o*=e-r;for(var i=r+1;i<e;++i)g(t[i],n)<g(t[r],n)&&++o}return o}function P(t,e,n){for(var o=0,r=4,a=t.length-1;a>=0;a--){(12&g(t[a],n))==e&&(o+=i[a][r--])}return o}function S(t,e,n,o){for(var r=t.length-1,a=4,s=r,c=r;c>=0;c--)e>=i[c][a]?(e-=i[c][a--],t[c]=p(t[c],a|n,o)):((12&s)==n&&(s-=4),t[c]=p(t[c],s--,o))}function A(t,e){for(var n=0,o=e-2;o>=0;o--)n^=t%(e-o),t=~~(t/(e-o));return 1&n}T.EdgeMult=function(t,e,n){for(var o=0;o<12;o++)n.ea[o]=t.ea[e.ea[o]>>1]^1&e.ea[o]},T.CornMult=function(t,e,n){for(var o=0;o<8;o++){var r=((t.ca[7&e.ca[o]]>>3)+(e.ca[o]>>3))%3;n.ca[o]=7&t.ca[7&e.ca[o]]|r<<3}},T.CornMultFull=function(t,e,n){for(var o=0;o<8;o++){var r=t.ca[7&e.ca[o]]>>3,i=e.ca[o]>>3,a=r+(r<3?i:6-i);a=a%3+(r<3==i<3?0:3),n.ca[o]=7&t.ca[7&e.ca[o]]|a<<3}},T.CornConjugate=function(t,e,n){for(var o=U[F[0][e]],r=U[e],i=0;i<8;i++){var a=o.ca[7&t.ca[7&r.ca[i]]]>>3,s=t.ca[7&r.ca[i]]>>3,c=a<3?s:(3-s)%3;n.ca[i]=7&o.ca[7&t.ca[7&r.ca[i]]]|c<<3}},T.EdgeConjugate=function(t,e,n){for(var o=U[F[0][e]],r=U[e],i=0;i<12;i++)n.ea[i]=o.ea[t.ea[r.ea[i]>>1]>>1]^1&t.ea[r.ea[i]>>1]^1&r.ea[i]},T.prototype.init=function(t,e){return this.ca=t.slice(),this.ea=e.slice(),this},T.prototype.initCoord=function(t,e,n,o){return C(this.ca,t,8,!1),this.setTwist(e),E(this.ea,n,12,!0),this.setFlip(o),this},T.prototype.isEqual=function(t){for(var e=0;e<8;e++)if(this.ca[e]!=t.ca[e])return!1;for(e=0;e<12;e++)if(this.ea[e]!=t.ea[e])return!1;return!0},T.prototype.setFlip=function(t){for(var e,n=0,o=10;o>=0;o--,t>>=1)n^=e=1&t,this.ea[o]=254&this.ea[o]|e;this.ea[11]=254&this.ea[11]|n},T.prototype.getFlip=function(){for(var t=0,e=0;e<11;e++)t=t<<1|1&this.ea[e];return t},T.prototype.getFlipSym=function(){return X[this.getFlip()]},T.prototype.setTwist=function(t){for(var e,n=15,o=6;o>=0;o--,t=~~(t/3))n-=e=t%3,this.ca[o]=7&this.ca[o]|e<<3;this.ca[7]=7&this.ca[7]|n%3<<3},T.prototype.getTwist=function(){for(var t=0,e=0;e<7;e++)t+=(t<<1)+(this.ca[e]>>3);return t},T.prototype.getTwistSym=function(){return W[this.getTwist()]},T.prototype.setCPerm=function(t){C(this.ca,t,8,!1)},T.prototype.getCPerm=function(){return k(this.ca,8,!1)},T.prototype.getCPermSym=function(){return _(j[k(this.ca,8,!1)])},T.prototype.setEPerm=function(t){C(this.ea,t,8,!0)},T.prototype.getEPerm=function(){return k(this.ea,8,!0)},T.prototype.getEPermSym=function(){return j[k(this.ea,8,!0)]},T.prototype.getUDSlice=function(){return 494-P(this.ea,8,!0)},T.prototype.setUDSlice=function(t){S(this.ea,494-t,8,!0)},T.prototype.getMPerm=function(){return w(this.ea,12,!0)%24},T.prototype.setMPerm=function(t){E(this.ea,t,12,!0)},T.prototype.getCComb=function(){return P(this.ca,0,!1)},T.prototype.setCComb=function(t){S(this.ca,t,0,!1)},T.prototype.URFConjugate=function(){var t=new T;T.CornMult(T.urf2,this,t),T.CornMult(t,T.urf1,this),T.EdgeMult(T.urf2,this,t),T.EdgeMult(t,T.urf1,this)};var L=[[8,9,20],[6,18,38],[0,36,47],[2,45,11],[29,26,15],[27,44,24],[33,53,42],[35,17,51]],I=[[5,10],[7,19],[3,37],[1,46],[32,16],[28,25],[30,43],[34,52],[23,12],[21,41],[50,39],[48,14]];function D(){this.twist=0,this.tsym=0,this.flip=0,this.fsym=0,this.slice=0,this.prun=0,this.twistc=0,this.flipc=0}T.prototype.toFaceCube=function(t,e){t=t||L,e=e||I;for(var n="URFDLB",o=[],r=0;r<54;r++)o[r]=n[~~(r/9)];for(var i=0;i<8;i++)for(var a=7&this.ca[i],s=this.ca[i]>>3,c=0;c<3;c++)o[t[i][(c+s)%3]]=n[~~(t[a][c]/9)];for(var l=0;l<12;l++)for(a=this.ea[l]>>1,s=1&this.ea[l],c=0;c<2;c++)o[e[l][(c+s)%2]]=n[~~(e[a][c]/9)];return o.join("")},T.prototype.invFrom=function(t){for(var e=0;e<12;e++)this.ea[t.ea[e]>>1]=e<<1|1&t.ea[e];for(var n=0;n<8;n++)this.ca[7&t.ca[n]]=n|32>>(t.ca[n]>>3)&24;return this},T.prototype.fromFacelet=function(t,e,n){e=e||L,n=n||I;for(var o,r,i,a,s=0,c=[],l=t[4]+t[13]+t[22]+t[31]+t[40]+t[49],u=0;u<54;++u){if(c[u]=l.indexOf(t[u]),-1==c[u])return-1;s+=1<<(c[u]<<2)}if(10066329!=s)return-1;for(u=0;u<8;++u){for(a=0;a<3&&(0!=c[e[u][a]]&&3!=c[e[u][a]]);++a);for(o=c[e[u][(a+1)%3]],r=c[e[u][(a+2)%3]],i=0;i<8;++i)if(o==~~(e[i][1]/9)&&r==~~(e[i][2]/9)){this.ca[u]=i|a%3<<3;break}}for(u=0;u<12;++u)for(i=0;i<12;++i){if(c[n[u][0]]==~~(n[i][0]/9)&&c[n[u][1]]==~~(n[i][1]/9)){this.ea[u]=i<<1;break}if(c[n[u][0]]==~~(n[i][1]/9)&&c[n[u][1]]==~~(n[i][0]/9)){this.ea[u]=i<<1|1;break}}},D.prototype.set=function(t){this.twist=t.twist,this.tsym=t.tsym,this.flip=t.flip,this.fsym=t.fsym,this.slice=t.slice,this.prun=t.prun,this.twistc=t.twistc,this.flipc=t.flipc},D.prototype.calcPruning=function(t){this.prun=Math.max(Math.max(M(pt,rt,this.twist*o+ot[this.slice][this.tsym]),M(gt,it,this.flip*o+ot[this.slice][this.fsym])),Math.max(M(dt,at,this.twistc>>3<<11|Z[this.flipc^7&this.twistc]),M(dt,at,this.twist<<11|Z[this.flip<<3|this.fsym^this.tsym])))},D.prototype.setWithPrun=function(t,e){if(this.twist=t.getTwistSym(),this.flip=t.getFlipSym(),this.tsym=7&this.twist,this.twist=this.twist>>3,this.prun=M(dt,at,this.twist<<11|Z[this.flip^this.tsym]),this.prun>e)return!1;if(this.fsym=7&this.flip,this.flip=this.flip>>3,this.slice=t.getUDSlice(),this.prun=Math.max(this.prun,Math.max(M(pt,rt,this.twist*o+ot[this.slice][this.tsym]),M(gt,it,this.flip*o+ot[this.slice][this.fsym]))),this.prun>e)return!1;var n=new T;return T.CornConjugate(t,1,n),T.EdgeConjugate(t,1,n),this.twistc=n.getTwistSym(),this.flipc=n.getFlipSym(),this.prun=Math.max(this.prun,M(dt,at,this.twistc>>3<<11|Z[this.flipc^7&this.twistc])),this.prun<=e},D.prototype.doMovePrun=function(t,e,n){return this.slice=tt[t.slice][e],this.flip=nt[t.flip][G[e<<3|t.fsym]],this.fsym=7&this.flip^t.fsym,this.flip>>=3,this.twist=et[t.twist][G[e<<3|t.tsym]],this.tsym=7&this.twist^t.tsym,this.twist>>=3,this.prun=Math.max(Math.max(M(pt,rt,this.twist*o+ot[this.slice][this.tsym]),M(gt,it,this.flip*o+ot[this.slice][this.fsym])),M(dt,at,this.twist<<11|Z[this.flip<<3|this.fsym^this.tsym])),this.prun},D.prototype.doMovePrunConj=function(t,e){return e=N[3][e],this.flipc=nt[t.flipc>>3][G[e<<3|7&t.flipc]]^7&t.flipc,this.twistc=et[t.twistc>>3][G[e<<3|7&t.twistc]]^7&t.twistc,M(dt,at,this.twistc>>3<<11|Z[this.flipc^7&this.twistc])},e.prototype.solution=function(t,e,n,o,r){Ct();var i=this.verify(t);return 0!=i?"Error "+Math.abs(i):(void 0===e&&(e=21),void 0===n&&(n=1e9),void 0===o&&(o=0),void 0===r&&(r=0),this.sol=e+1,this.probe=0,this.probeMax=n,this.probeMin=Math.min(o,n),this.verbose=r,this.moveSol=null,this.isRec=!1,this.initSearch(),this.search())},e.prototype.initSearch=function(){this.conjMask=0,this.maxPreMoves=this.conjMask>7?0:20;for(var t=0;t<6;t++)if(this.urfCubieCube[t].init(this.cc.ca,this.cc.ea),this.urfCoordCube[t].setWithPrun(this.urfCubieCube[t],20),this.cc.URFConjugate(),t%3==2){var e=(new T).invFrom(this.cc);this.cc.init(e.ca,e.ea)}},e.prototype.next=function(t,e,n){return void 0===t&&(t=1e9),void 0===e&&(e=0),void 0===n&&(n=0),this.probe=0,this.probeMax=t,this.probeMin=Math.min(e,t),this.moveSol=null,this.isRec=!0,this.verbose=n,this.search()},e.prototype.verify=function(t){if(-1==this.cc.fromFacelet(t))return-1;for(var e=0,n=0,o=0;o<12;o++)n|=1<<(this.cc.ea[o]>>1),e^=1&this.cc.ea[o];if(4095!=n)return-2;if(0!=e)return-3;var r=0;e=0;for(var i=0;i<8;i++)r|=1<<(7&this.cc.ca[i]),e+=this.cc.ca[i]>>3;return 255!=r?-4:e%3!=0?-5:0!=(A(w(this.cc.ea,12,!0),12)^A(this.cc.getCPerm(),8))?-6:0},e.prototype.phase1PreMoves=function(t,e,n){if(this.preMoveLen=this.maxPreMoves-t,(this.isRec?this.depth1==this.length1-this.preMoveLen:0==this.preMoveLen||0==(225207>>e&1))&&(this.depth1=this.length1-this.preMoveLen,this.phase1Cubie[0].init(n.ca,n.ea),this.allowShorter=7==this.depth1&&0!=this.preMoveLen,this.nodeUD[this.depth1+1].setWithPrun(n,this.depth1)&&0==this.phase1(this.nodeUD[this.depth1+1],this.depth1,-1)))return 0;if(0==t||this.preMoveLen+7>=this.length1)return 1;var o=0;(1==t||this.preMoveLen+1+7>=this.length1)&&(o|=225207),e=3*~~(e/3);for(var r=0;r<18;r++){if(r!=e&&r!=e-9&&r!=e+9){if(!(this.isRec&&r!=this.preMoves[this.maxPreMoves-t]||0!=(o&1<<r)))if(T.CornMult(z[r],n,this.preMoveCubes[t]),T.EdgeMult(z[r],n,this.preMoveCubes[t]),this.preMoves[this.maxPreMoves-t]=r,0==this.phase1PreMoves(t-1,r,this.preMoveCubes[t]))return 0}else r+=2}return 1},e.prototype.search=function(){for(this.length1=this.isRec?this.length1:0;this.length1<this.sol;this.length1++)for(this.urfIdx=this.isRec?this.urfIdx:0;this.urfIdx<6;this.urfIdx++)if(0==(this.conjMask&1<<this.urfIdx)&&0==this.phase1PreMoves(this.maxPreMoves,-30,this.urfCubieCube[this.urfIdx],0))return null==this.moveSol?"Error 8":this.moveSol;return null==this.moveSol?"Error 7":this.moveSol},e.prototype.initPhase2Pre=function(){if(this.isRec=!1,this.probe>=(null==this.moveSol?this.probeMax:this.probeMin))return 0;++this.probe;for(var t=this.valid1;t<this.depth1;t++)T.CornMult(this.phase1Cubie[t],z[this.move[t]],this.phase1Cubie[t+1]),T.EdgeMult(this.phase1Cubie[t],z[this.move[t]],this.phase1Cubie[t+1]);this.valid1=this.depth1;var e=this.initPhase2(this.phase1Cubie[this.depth1]);if(0==e||0==this.preMoveLen||2==e)return e;var n=3*~~(this.preMoves[this.preMoveLen-1]/3)+1;return T.CornMult(z[n],this.phase1Cubie[this.depth1],this.phase1Cubie[this.depth1+1]),T.EdgeMult(z[n],this.phase1Cubie[this.depth1],this.phase1Cubie[this.depth1+1]),this.preMoves[this.preMoveLen-1]+=2-this.preMoves[this.preMoveLen-1]%3*2,e=this.initPhase2(this.phase1Cubie[this.depth1+1]),this.preMoves[this.preMoveLen-1]+=2-this.preMoves[this.preMoveLen-1]%3*2,e},e.prototype.initPhase2=function(t){var e=t.getCPermSym(),n=15&e;e>>=4;var o=t.getEPermSym(),i=15&o;o>>=4;var a,s=t.getMPerm(),c=R(o,i,!1),l=R(e,n,!0),u=Math.max(M(bt,vt,24*e+ut[s][n]),M(xt,mt,o*r+ft[255&K[e]][F[i][n]]),M(xt,mt,(c>>4)*r+ft[255&K[l>>4]][F[15&c][15&l]])),h=Math.min(13,this.sol-this.length1);if(u>=h)return u>h?2:1;for(a=h-1;a>=u;a--){var f=this.phase2(o,i,e,n,s,a,this.depth1,10);if(f<0)break;a-=f,this.moveSol=[];for(var v=0;v<this.depth1+a;v++)this.appendSolMove(this.move[v]);for(v=this.preMoveLen-1;v>=0;v--)this.appendSolMove(this.preMoves[v]);this.sol=this.moveSol.length,this.moveSol=this.solutionToString()}return a!=h-1&&this.probe>=this.probeMin?0:1},e.prototype.phase1=function(t,e,n){if(0==t.prun&&e<5){if(this.allowShorter||0==e){this.depth1-=e;var o=this.initPhase2Pre();return this.depth1+=e,o}return 1}for(var r=0;r<18;r+=3)if(r!=n&&r!=n-9)for(var i=0;i<3;i++){var a=r+i;if(!this.isRec||a==this.move[this.depth1-e]){var s=this.nodeUD[e].doMovePrun(t,a,!0);if(s>e)break;if(s!=e){if((s=this.nodeUD[e].doMovePrunConj(t,a))>e)break;if(s!=e){if(this.move[this.depth1-e]=a,this.valid1=Math.min(this.valid1,this.depth1-e),0==(o=this.phase1(this.nodeUD[e],e-1,r)))return 0;if(2==o)break}}}}return 1},e.prototype.appendSolMove=function(t){if(0!=this.moveSol.length){var e,n=~~(t/3),o=~~(this.moveSol[this.moveSol.length-1]/3);if(n!=o)if(this.moveSol.length>1&&n%3==o%3&&n==~~(this.moveSol[this.moveSol.length-2]/3))3==(e=(t%3+this.moveSol[this.moveSol.length-2]%3+1)%4)?(this.moveSol[this.moveSol.length-2]=this.moveSol[this.moveSol.length-1],this.moveSol.pop()):this.moveSol[this.moveSol.length-2]=3*n+e;else this.moveSol.push(t);else 3==(e=(t%3+this.moveSol[this.moveSol.length-1]%3+1)%4)?this.moveSol.pop():this.moveSol[this.moveSol.length-1]=3*n+e}else this.moveSol.push(t)},e.prototype.phase2=function(t,e,n,o,i,a,s,l){if(0==t&&0==n&&0==i)return a;for(var h=u[l],f=0;f<10;f++)if(0==(h>>f&1)){var v=lt[i][f],m=st[n][O[o][f]],d=B[15&m][o];m>>=4;var p=ct[t][O[e][f]],g=B[15&p][e],b=R(p>>=4,g,!1),x=R(m,d,!0),y=M(xt,mt,(b>>4)*r+ft[255&K[x>>4]][F[15&b][15&x]]);if(y>a+1)break;if(y>=a)f+=66>>f&3&a-y;else if((y=Math.max(M(xt,mt,p*r+ft[255&K[m]][F[g][d]]),M(bt,vt,24*m+ut[v][d])))>=a)f+=66>>f&3&a-y;else{var _=this.phase2(p,g,m,d,v,a-1,s+1,f);if(_>=0)return this.move[s]=c[f],_}}else f+=66>>f&3;return-1},e.prototype.solutionToString=function(){var t="",e=0!=(2&this.verbose)?(this.urfIdx+3)%6:this.urfIdx;if(e<3)for(var n=0;n<this.moveSol.length;++n)t+=s[h[e][this.moveSol[n]]]+" ";else for(n=this.moveSol.length-1;n>=0;--n)t+=s[h[e][this.moveSol[n]]]+" ";return t};var z=[],U=[],B=[],F=[],N=[],O=[],G=[],V=[],X=[],H=[],W=[],q=[],j=[],Y=[],$=[],Q=[],Z=[],K=[],J=[],tt=[],et=[],nt=[],ot=[],rt=[],it=[],at=[],st=[],ct=[],lt=[],ut=[],ht=[],ft=[],vt=[],mt=[],dt=15,pt=15,gt=15,bt=15,xt=15;for(f=0;f<18;f++)z[f]=new T;z[0].initCoord(15120,0,119750400,0),z[3].initCoord(21021,1494,323403417,0),z[6].initCoord(8064,1236,29441808,550),z[9].initCoord(9,0,5880,0),z[12].initCoord(1230,412,2949660,0),z[15].initCoord(224,137,328552,137);for(var Mt=0;Mt<18;Mt+=3)for(var yt=0;yt<2;yt++)T.EdgeMult(z[Mt+yt],z[Mt],z[Mt+yt+1]),T.CornMult(z[Mt+yt],z[Mt],z[Mt+yt+1]);T.urf1=(new T).initCoord(2531,1373,67026819,1367),T.urf2=(new T).initCoord(2089,1906,322752913,2040);var _t=-1;function Rt(e,n,o,r,i,a,s,c){var l=15&c,u=1==(c>>4&1)?14540032:0,h=c>>8&15,f=c>>12&15,v=c>>16&15,m=(1<<l)-1,d=null==r,p=n*o,g=1==(c>>5&1)?10:18,M=10==g?66:599186,_=x(e,p)-1;if(-1==_){for(var R=0;R<1+(p>>3);R++)e[R]=4294967295;b(e,0,15),_=0}else b(e,p,15^_+1);for(var T=t>0?Math.min(Math.max(_+1,v),f):f;_<T;){var C=_>h,k=C?15:_,E=286331153*k,w=C?_:15;_++,_t++;var P=15^_,S=0;for(R=0;R<p;R++,S>>=4)if(0!=(7&R)||y((S=e[R>>3])^E)){if((15&S)==k){var A=R%n,L=~~(R/n),I=0,D=0;d&&(D=7&(I=X[A]),I>>=3);for(var z=0;z<g;z++){var U,B=a[L][z];U=d?Z[nt[I][G[z<<3|D]]^D^B&m]:i[r[A][z]][B&m];var F=(B>>=l)*n+U,N=x(e,F);if(N==w){if(C){b(e,R,P);break}b(e,F,P);for(var O=1,V=s[B];0!=(V>>=1);O++)if(1==(1&V)){var H=B*n;x(e,H+=d?Z[X[U]^O]:i[U][O^u>>(O<<1)&3])==w&&(b(e,H,P))}}else N<_-1&&(z+=M>>z&3)}}}else R+=7}return b(e,p,_+1^15),_+1}function Tt(t){dt=Rt(at,2048,324,null,null,et,$,103939),_t>t||(pt=Rt(rt,495,324,tt,ot,et,$,431619),_t>t||(gt=Rt(it,495,336,tt,ot,nt,Y,431619),_t>t||(bt=Rt(vt,24,2768,lt,ut,st,Q,584244),_t>t||(xt=Rt(mt,r,2768,ht,ft,ct,Q,514084)))))}function Ct(){if(_t<0&&(!function(){for(var t=new T,e=new T,i=(new T).initCoord(28783,0,259268407,0),a=(new T).initCoord(15138,0,119765538,7),s=(new T).initCoord(5167,0,83473207,0),u=0;u<8;u++)s.ca[u]|=24;for(u=0;u<16;u++)U[u]=(new T).init(t.ca,t.ea),T.CornMultFull(t,a,e),T.EdgeMult(t,a,e),t.init(e.ca,e.ea),u%4==3&&(T.CornMultFull(t,s,e),T.EdgeMult(t,s,e),t.init(e.ca,e.ea)),u%8==7&&(T.CornMultFull(t,i,e),T.EdgeMult(t,i,e),t.init(e.ca,e.ea));for(u=0;u<16;u++)B[u]=[],F[u]=[],N[u]=[],G[u]=[],O[u]=[];for(u=0;u<16;u++)for(var h=0;h<16;h++)B[u][h]=u^h^84660>>h&u<<1&2,F[B[u][h]][h]=u;t=new T;for(var f=0;f<16;f++)for(h=0;h<18;h++){T.CornConjugate(z[h],F[0][f],t);t:for(var v=0;v<18;v++){for(var m=0;m<8;m++)if(z[v].ca[m]!=t.ca[m])continue t;N[f][h]=v,O[f][l[h]]=l[v];break}f%2==0&&(G[h<<3|f>>1]=N[f][h])}{function d(t,e,n,o,r,i,a){for(var s=new T,c=new T,l=0,u=r>=2?1:2,h=1!=r?T.EdgeConjugate:T.CornConjugate,f=0;f<t;f++)if(void 0===n[f]){i.call(s,f);for(var v=0;v<16;v+=u){h(s,v,c);var m=a.call(c);0==r&&(Z[l<<3|v>>1]=m),m==f&&(o[l]|=1<<v/u),n[m]=(l<<4|v)/u}e[l++]=f}return l}d(2048,V,X,Y,0,T.prototype.setFlip,T.prototype.getFlip),d(2187,H,W,$,1,T.prototype.setTwist,T.prototype.getTwist),d(40320,q,j,Q,2,T.prototype.setEPerm,T.prototype.getEPerm);var p=new T;for(u=0;u<n;u++)C(p.ea,q[u],8,!0),K[u]=P(p.ea,0,!0)+70*A(q[u],8),t.invFrom(p),J[u]=j[t.getEPerm()]}{function g(n,o,r,i,a,s,c,l){for(var u=0;u<r;u++){n[u]=[],a.call(t,o[u]);for(var h=0;h<i;h++)c(t,z[l?l[h]:h],e),n[u][h]=s.call(e)}}for(t=new T,e=new T,g(nt,V,336,18,T.prototype.setFlip,T.prototype.getFlipSym,T.EdgeMult),g(et,H,324,18,T.prototype.setTwist,T.prototype.getTwistSym,T.CornMult),g(ct,q,n,10,T.prototype.setEPerm,T.prototype.getEPermSym,T.EdgeMult,c),g(st,q,n,10,T.prototype.setCPerm,T.prototype.getCPermSym,T.CornMult,c),u=0;u<o;u++){for(tt[u]=[],ot[u]=[],t.setUDSlice(u),h=0;h<18;h++)T.EdgeMult(t,z[h],e),tt[u][h]=e.getUDSlice();for(h=0;h<16;h+=2)T.EdgeConjugate(t,F[0][h],e),ot[u][h>>1]=e.getUDSlice()}for(u=0;u<24;u++){for(lt[u]=[],ut[u]=[],t.setMPerm(u),h=0;h<10;h++)T.EdgeMult(t,z[c[h]],e),lt[u][h]=e.getMPerm();for(h=0;h<16;h++)T.EdgeConjugate(t,F[0][h],e),ut[u][h]=e.getMPerm()}for(u=0;u<r;u++){for(ht[u]=[],ft[u]=[],t.setCComb(u%70),h=0;h<10;h++)T.CornMult(t,z[c[h]],e),ht[u][h]=e.getCComb()+70*(165>>h&1^~~(u/70));for(h=0;h<16;h++)T.CornConjugate(t,F[0][h],e),ft[u][h]=e.getCComb()+70*~~(u/70)}}}(),_t=0),0==_t)Tt(99);else{if(!(_t<54))return!0;Tt(_t)}return!1}return{Search:e,solve:function(t){return(new e).solution(t)},randomCube:function(){var t,e,n=~~(2048*Math.random()),o=~~(2187*Math.random());do{t=~~(Math.random()*a[12]),e=~~(Math.random()*a[8])}while(A(e,8)!=A(t,12));return(new T).initCoord(e,o,t,n).toFaceCube()},fromScramble:function(t){for(var e=-1,n=new T,o=new T,r=0;r<t.length;r++)switch(t[r]){case"U":case"R":case"F":case"D":case"L":case"B":e=3*"URFDLB".indexOf(t[r]);break;case" ":-1!=e&&(T.CornMult(n,z[e],o),T.EdgeMult(n,z[e],o),n.init(o.ca,o.ea)),e=-1;break;case"2":e++;break;case"'":e+=2;break;default:continue}return-1!=e&&(T.CornMult(n,z[e],o),T.EdgeMult(n,z[e],o),n.init(o.ca,o.ea)),o.toFaceCube()},initFull:function(){t=0,Ct()}}}();async function Do(t){const e=(0,Lo.solve)(t);if(e.toUpperCase().includes("ERROR"))return console.warn("error solving facelet ",t),[];const n={R:"x",U:"y",F:"z",L:"x",D:"y",B:"z"},o={R:1,U:1,F:1,L:-1,D:-1,B:-1};return e.split(" ").filter((t=>t)).map((t=>[n[t[0]],o[t[0]],("'"==t[1]?1:-1)*o[t[0]],"2"==t[1]?2:1]))}void 0!==Lo&&(Lo=Io);class zo{constructor(t,e,n,o){this.gl=t,this.numComponents=n,this.componentType=o,this.buffer=t.createBuffer(),this.write(e)}write(t){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(t),this.gl.STATIC_DRAW)}bind(t){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.buffer),this.gl.vertexAttribPointer(t,this.numComponents,this.componentType,!1,0,0)}}class Uo{indexCount=0;constructor(t,e){this.gl=t,this.buffer=t.createBuffer(),this.write(e)}write(t){this.indexCount=t.length,this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.buffer),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(t),this.gl.STATIC_DRAW)}bind(){this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.buffer)}}function Bo(t,e,n=[]){const o=Array.from({length:t.length},(()=>ct.create()));for(let[n,r,i]of e){const e=t[n],a=t[r],s=t[i],c=ct.subtract(ct.create(),e,a),l=ct.subtract(ct.create(),s,a),u=ct.cross(ct.create(),l,c);for(let t of[n,r,i])ct.add(o[t],o[t],u)}return o.map(((t,e)=>n[e]||Re(ct.normalize(t,t)))).flat()}class Fo{constructor(t,e,n,o,r){this.gl=t;const i=Bo(e,o,r);this.positions=new zo(t,e.flat(),3,t.FLOAT),this.colors=new zo(t,n.flat(),3,t.FLOAT),this.normals=new zo(t,i,3,t.FLOAT),this.indices=new Uo(t,o.flat()),this.transform=s.create()}update(t,e,n,o){const r=Bo(t,n,o);this.positions.write(t.flat()),this.colors.write(e.flat()),this.normals.write(r.flat()),this.indices.write(n.flat())}draw(t){t.setUniform("u_ModelMatrix",this.transform),this.positions.bind(t.vertexPosition),this.colors.bind(t.vertexColor),this.normals.bind(t.vertexNormal),this.indices.bind(),this.gl.drawElements(this.gl.TRIANGLES,this.indices.indexCount,this.gl.UNSIGNED_SHORT,0)}}const No={faceCover:.85,faceR:.15,faceEdgeR:.5,faceRingW:1,faceExtrude:.005,faceColor:"classic",faceMetallic:0,faceRoughness:.15},Oo={spread:1,blockR:.15,bevelW:0,blockType:"stickered",blockColor:"bl",blockMetallic:0,blockRoughness:.15,addStickers:!1,...No,wearTear:.2},Go={classic:{spread:1.025,blockR:.15,bevelW:0,faceCover:.85,faceR:.15,faceEdgeR:.5,faceRingW:1,faceExtrude:.005,blockType:"stickered",blockColor:"bl",blockMetallic:0,blockRoughness:.15,addStickers:!0,faceColor:"classic",faceMetallic:0,faceRoughness:.15,wearTear:.2},reverse:{spread:1.025,blockR:.15,bevelW:0,faceCover:.85,faceR:.15,faceEdgeR:.5,faceRingW:1,faceExtrude:.005,blockType:"stickerless",blockColor:"classic",blockMetallic:0,blockRoughness:.05,addStickers:!0,faceColor:"bl",faceMetallic:0,faceRoughness:.05,wearTear:.2},classic2:{spread:1,blockR:.1,bevelW:.2,faceCover:.95,faceR:.1,faceEdgeR:.5,faceRingW:1,faceExtrude:.005,blockType:"stickered",blockColor:"bl",blockMetallic:0,blockRoughness:.05,addStickers:!0,faceColor:"classic",faceMetallic:0,faceRoughness:.15,wearTear:.2},reverse2:{spread:1,blockR:.1,bevelW:.2,faceCover:.95,faceR:.1,faceEdgeR:.5,faceRingW:1,faceExtrude:.005,blockType:"stickerless",blockColor:"classic",blockMetallic:0,blockRoughness:.15,addStickers:!0,faceColor:"bl",faceMetallic:0,faceRoughness:.05,wearTear:.2},toy:{spread:1,blockR:.15,bevelW:.15,blockType:"stickerless",blockColor:"bright",blockMetallic:0,blockRoughness:.1,addStickers:!1,...No,wearTear:.2},precious:{spread:1.05,blockR:.1,bevelW:0,faceCover:.85,faceR:1,faceEdgeR:1,faceRingW:.35,faceExtrude:.07,blockType:"stickered",blockColor:"go",blockMetallic:1,blockRoughness:.05,addStickers:!0,faceColor:"bright",faceMetallic:1,faceRoughness:.15,wearTear:.2},bubble:{spread:1,blockR:1,bevelW:0,blockType:"stickerless",blockColor:"bright",blockMetallic:0,blockRoughness:.1,addStickers:!1,...No,wearTear:.2},colorful:{spread:1.025,blockR:.15,bevelW:0,faceCover:.85,faceR:.35,faceEdgeR:.5,faceRingW:.13,faceExtrude:.01,blockType:"stickered",blockColor:"colorful",blockMetallic:0,blockRoughness:.15,addStickers:!0,faceColor:"bright",faceMetallic:0,faceRoughness:.15,wearTear:.2},framed:{spread:1.025,blockR:0,bevelW:0,faceCover:1,faceR:.05,faceEdgeR:1,faceRingW:.15,faceExtrude:.05,blockType:"stickerless",blockColor:"bright",blockMetallic:0,blockRoughness:.15,addStickers:!0,faceColor:"si",faceMetallic:1,faceRoughness:.05,wearTear:.2},retro:{spread:1,blockR:.25,bevelW:0,faceCover:.9,faceR:.4,faceEdgeR:.5,faceRingW:.35,faceExtrude:.02,blockType:"stickered",blockColor:"#292929",blockMetallic:0,blockRoughness:.05,addStickers:!0,faceColor:"neutral",faceMetallic:0,faceRoughness:.15,wearTear:.5},retro2:{spread:1,blockR:.05,bevelW:.2,faceCover:.95,faceR:.15,faceEdgeR:.5,faceRingW:.07,faceExtrude:0,blockType:"stickered",blockColor:"bl",blockMetallic:0,blockRoughness:.3,addStickers:!0,faceColor:"pastel",faceMetallic:0,faceRoughness:.1,wearTear:.75},unicorn:{spread:1,blockR:1,bevelW:0,blockType:"stickered",blockColor:"colorful",blockMetallic:.5,blockRoughness:.25,addStickers:!1,...No,wearTear:.2},lego:{spread:1,blockR:.05,bevelW:0,faceCover:.4,faceR:1,faceEdgeR:.2,faceRingW:1,faceExtrude:.1,blockType:"stickerless",blockColor:"neutral",blockMetallic:0,blockRoughness:.1,addStickers:!0,faceColor:"neutral",faceMetallic:0,faceRoughness:.1,wearTear:.2},fancy:{spread:1.03,blockR:.05,bevelW:.32,blockType:"stickerless",blockColor:"pastel",blockMetallic:0,blockRoughness:.38,addStickers:!0,faceCover:.98,faceR:.15,faceEdgeR:.72,faceRingW:.67,faceExtrude:.023,faceColor:"go",faceMetallic:.5,faceRoughness:.23,wearTear:.2}},Vo=(t=1,e=0)=>{const n=t/2;return[[[-n,-n,e],[n,-n,e],[n,n,e],[-n,n,e]],[[0,1,2],[0,2,3]]]};function Xo(t,e,n,o=!1,r){n>.99&&(n=1),n<.01&&(n=0);const i=1==n,a=0==n,s=a?0:ue(re(20*n),4,16),c=t/2,l=n*c,u=i?0:c-l,h=[0,0,0],f=[l,0,0],v=t=>[-t[1],t[0],t[2]],m=()=>Array.from({length:s-1},((t,e)=>Re(ct.rotateZ(ct.create(),f,h,ie((e+1)*(90/s)))))),d=i?[f,...m()]:o?[f,...m(),v(f)]:a?[h]:[h,f,...m(),v(f)],p=d.map(v),g=p.map(v),b=g.map(v);i&&!o&&d.unshift(h);const x=[[u,u,e],[-u,u,e],[-u,-u,e],[u,-u,e]],M=(t,e)=>{for(let n of t)n[0]+=e[0],n[1]+=e[1],n[2]+=e[2]};return M(d,x[0]),M(p,x[1]),M(g,x[2]),M(b,x[3]),r&&[d,p,g,b].forEach(((t,e,n)=>{const o=t[t.length-1],i=n[(e+1)%4][0],[a]=ke([0],[1],r,[o,i]);t.push(...a.flat())})),[...d,...p,...g,...b]}function Ho(t,e,n,o,r,i,a){o<.01&&(o=.01),i<.01&&(i=0);const s=!(o>.99),c=i>0,l=e+Math.max(.001,r),u=.5*n,h=(a-u)/(1-2*u),f=a-u<.01?void 0:a<.5?[h,1-h]:1,v=(1-o)*t,m=i*Math.min(r,s?(t-v)/4:t/2);let d,p,g,b=[];if(s){d=Xo(t-2*m,l,n,!0,f),b=Xo(v+2*m,l,n,!0,f),g=[[b.length,v+2*m],[d.length,t-2*m]];const e=b.length;p=we(me(e),me(e,e))}else[d,p]=Wo(t-2*m,l,n,f),g=[[d.length,t-2*m]];if(r<.01){const t=g.map((([t,e])=>Array(t).fill(e))).flat();return[[...b,...d],p,[],t]}const x=d.length+b.length;let M=0;const y=[],_=[],R=[],T=[[t,1,0],[v,-1,1]];for(let[t,o,r]of T){if(r&&!s){y.push([]),_.push([]);continue}const i=Xo(t,l,n,!0,f),a=i.map((t=>[t[0],t[1],e]));M=i.length;const u=me;if(!c){const e=we(u(M,x+(0+3*r)*M),u(M,x+(1+1*r)*M));y.push([...i,...a]),_.push(e),R.push([M,t],[M,t]);continue}const h=t-m*o*2,v=Xo(h,l,n,!0,f),d=i.map(((t,e)=>{const n=[v[e][0],v[e][1],v[e][2]-m];return Re(ct.lerp(ct.create(),n,t,m/ct.distance(t,n)))})),p=i.map((t=>[t[0],t[1],t[2]-m])),g=we(u(M,x+(0+5*r)*M),u(M,x+(1+3*r)*M)),b=we(u(M,x+(1+5*r)*M),u(M,x+(2+3*r)*M)),T=we(u(M,x+(2+5*r)*M),u(M,x+(3+3*r)*M));y.push([...v,...d,...p,...a]),_.push([...g,...b,...T]),R.push([M,h],[M,2*d[0][0]],[M,t],[M,t])}const C=[...b,...d,...y[0],...y[1]],k=[...p,..._[0],..._[1]],E=[...g,...R],w=[];if(c)for(let t=0;t<M;t++){if(w[x+0*M+t]=[0,0,1],s){w[x+4*M+t]=[0,0,1]}}return[C,k,w,E.map((([t,e])=>Array(t).fill(e))).flat()]}function Wo(t=1,e=0,n=.25,o){n>.99&&(n=1),n<.01&&(n=0);const r=1==n,i=0==n,a=Xo(t,e,n);if(r){const t=Pe(me(a.length),!0);return[a,t]}const s=[],c=a.length/4,l=t=>Array.from({length:c},((e,n)=>n+t*c)),u=[l(0),l(1),l(2),l(3)],h=t=>{const e=u[(t+1)%u.length];return[e[0],e[1]]},f=[];return u.forEach(((t,e)=>{if(i){if(o){const[n,r]=[t[0],h(e)[0]],[i,s]=ke([r],[n],o,a);a.push(...i.flat()),f.push([r,...s.flat(),n])}}else{s.push(...Pe(t));const[n,r]=[t[0],t[t.length-1]],[i,c]=h(e);let l=[],u=[];if(o){const[t,e]=ke([i],[n],o,a);a.push(...t.flat()),l=e;const[s,h]=ke([c],[r],o,a);a.push(...s.flat()),u=h}const v=[c,...u.flat(),r],m=[i,...l.flat(),n];s.push(...Ee(v,m)),f.push(m)}})),o?s.push(...function(t,e,n){const o=t[0].slice(1,t[0].length-1),r=t[2].slice(1,t[2].length-1),[i,a]=ke(o,r,n,e);e.push(...i.flat());const s=[],c=a.map(((e,n)=>[t[1][n+1],...e,t[3][n+1]])),l=[t[0],...c,t[2]];return l.forEach(((t,e)=>{e&&s.push(...Ee(l[e-1],l[e]))})),s}([f[0],[...f[1]].reverse(),[...f[2]].reverse(),f[3]],a,o)):s.push(...Ee([u[1][0],u[0][0]],[u[2][0],u[3][0]])),[a,s]}const qo=(t=1)=>{const e=t/2;return[[[-e,-e,e],[e,-e,e],[e,e,e],[-e,e,e],[-e,-e,-e],[-e,e,-e],[e,e,-e],[e,-e,-e]],[[0,1,2],[0,2,3],[7,4,5],[7,5,6],[3,2,6],[3,6,5],[4,7,1],[4,1,0],[1,7,6],[1,6,2],[4,0,3],[4,3,5]]]},jo=t=>6*t[0]+t[1],Yo=t=>{return e=t,n=6,[Math.floor(e/n),e%n];var e,n};function $o(t=1,e=.25,n){e<.01&&(e=0),e>.99&&(e=1);const o=e>0,r=1==e,i=Math.ceil((480*e/6)**.5)+1,a=t/2,s=e*a,c=[[a-s,a-s,a-s],[a-s,a-s,a],[a,a-s,a-s],[a-s,a,a-s]],[l,u,h,f]=c,v=[ct.sub(ct.create(),u,l),ct.sub(ct.create(),h,l),ct.sub(ct.create(),f,l)],m=[[0,2],[1,0],[2,1]],d=t=>Yo(t),p=(t,e)=>jo([t,e]),g=[[[2,0],[2,1]].map((([t,e])=>p(t,e))),[[0,1],[0,2]].map((([t,e])=>p(t,e))),[[1,0],[1,2]].map((([t,e])=>p(t,e)))],b=[],x=[[],[],[]],M=(t,e,n)=>{if(!r)for(let o of e)x[o].push([ct.distance(t,v[o]),n])};v.forEach(((t,e)=>M(t,m[e],e)));const y=t=>[t[2],t[1],-t[0]],_=t=>[-t[0],t[1],-t[2]],R=t=>[-t[2],t[1],t[0]],T=[[],[],[],[],[],[],[],[]],C=[[],[],[],[],[],[],[],[]],k=t=>{if(r)return;const e=(t=>[t[0]+l[0],t[1]+l[0],t[2]+l[0]])(t),n=(t=>[t[2],-t[1],t[0]])(e),[o,i,a]=[y(e),_(e),R(e)],[s,c,u]=[y(n),_(n),R(n)];[e,n,o,s,i,c,a,u].forEach(((t,e)=>T[e].push(t)))};v.forEach(k);const E=t=>{if(r)return;const e=(t=>{const e=t=>2==t?0:0==t?5:t,n=t=>2==t?5:0==t?3:t,o=t=>2==t?3:0==t?2:t,r=(t,e)=>e.map((e=>[t(e[0]),t(e[1])])),i=[...t.map((t=>([1,2,6,8,12,13].includes(t)||console.error("invalid id: "+t),Yo(t))))],a=r((t=>0==t?2:2==t?0:4),i),[s,c,l]=[r(e,i),r(n,i),r(o,i)],[u,h,f]=[r(e,a),r(n,a),r(o,a)];return[i,a,s,u,c,h,l,f].map((t=>t.map(jo)))})(t);e.forEach(((t,e)=>C[e].push(t)))};g.forEach(E);const w={},P=(t,e,n,o)=>{const r=he([t,e]).join("-"),i=[t,e].join("-");if(!w[r]){const[a,c]=[v[t],v[e]],[l,u]=[m[t],m[e]],h=ve(l,u),f=o||ve(g[t],g[e]),d=Array.from({length:n},((t,e)=>((t,e,n)=>{const o=v.length;return M(t,e,o),ct.scale(t,t,s/ct.length(t)),v.push(t),m.push(e),g.push(n),k(t),E(n),o})(ct.lerp(ct.create(),a,c,(e+1)/(n+1)),[...h],[...f])));w[r]={p:d,orig:i}}return i!=w[r].orig?[...w[r].p].reverse():[...w[r].p]},S=(t,e,n,o)=>{const r=[...P(n,t,o-1),t],i=[...P(n,e,o-1),e],a=[[n]];de(r,i).forEach((([t,e],n)=>{const o=P(t,e,n);a.push([t,...o,e])}));for(let t=1;t<a.length;t++){const e=a[t-1],n=a[t],o=e.length-1;b.push(...Ee(e,n,!1,(()=>!0)),[e[o],n[o],n[o+1]])}},A=(t,e,n,o)=>{const[r,i,a]=[v[t],v[e],v[n]],c=ct.create();ct.add(c,r,ct.add(c,i,a)),ct.normalize(c,c),ct.scale(c,c,s);const l=v.length,u=t=>{const e=t.map((t=>d(t)[0]));return t.filter((t=>{const[n,o]=d(t);return e.includes(n)&&e.includes(o)}))},h=u([...g[t],...g[e],...g[n]]);v.push(c),m.push([]),g.push(h),k(c),E(h);const[f]=P(t,e,1,u([...g[t],...g[e]])),[p]=P(e,n,1,u([...g[e],...g[n]])),[b]=P(n,t,1,u([...g[n],...g[t]]));S(t,f,l,o-1),S(f,e,l,o-1),S(e,p,l,o-1),S(p,n,l,o-1),S(n,b,l,o-1),S(b,t,l,o-1)};if(r){g[0].push(p(2,3),p(2,4)),g[1].push(p(0,4),p(0,5)),g[2].push(p(1,3),p(1,5)),v.push([0,0,-a],[-a,0,0],[0,-a,0]),m.push([],[],[]),g.push([[5,0],[5,1],[5,3],[5,4]].map((([t,e])=>p(t,e))),[[3,1],[3,2],[3,4],[3,5]].map((([t,e])=>p(t,e))),[[4,0],[4,2],[4,3],[4,5]].map((([t,e])=>p(t,e)))),A(0,1,2,i),A(1,3,2,i),A(3,4,2,i),A(4,0,2,i),A(1,0,5,i),A(3,1,5,i),A(4,3,5,i),A(0,4,5,i);const[t,e]=[v.map((t=>Re(t))),b];return[t,e,g]}o&&A(0,1,2,i);const L=(t,e)=>t+e*v.length,I=[...T].flat(),D=Array.from(Array(8)).map(((t,e)=>b.map((t=>[L(t[0],e),L(t[1],e),L(t[2],e)])))).flat(),z=[...C].flat(),U=[];x.forEach((t=>t.sort(((t,e)=>t[0]-e[0]))));const[B,F,N]=x,O=[...B].reverse(),G=[...F].reverse(),V=[...N].reverse(),X=[],H=[],W=[],q=[[],[],[],[],[],[]],j=o?2*Math.floor(.001+10*(1-e)/2)+1:n>0?9:3,Y=Array.from({length:j},((t,e)=>(e+1)/(j+1)));if(n-s>.01&&n<.5){const t=(n-s)/(1-2*s),e=Math.max(1,Math.min(Math.floor(j/2),re(t*(j+1))))-1;Y[e]=t,Y[j-1-e]=1-t}for(let t of[0,1,2,3]){const e=t?t-1:3,n=e=>(2*t+e)%8,[r,i,a,s]=[n(0),n(1),n(2),n(3)];if(X.push(L(2,r)),H.push(L(2,i)),o){const n=B.map((([t,e])=>L(e,r))),o=O.map((([t,e])=>L(e,i))),c=F.map((([t,e])=>L(e,r))),l=V.map((([t,e])=>L(e,a))),u=N.map((([t,e])=>L(e,i))),h=G.map((([t,e])=>L(e,s)));for(let[r,i,a]of[[n,o,[1]],[c,l,[0]],[u,h,[2]]]){const n=ke(r,i,Y,I,z),[o,s,c]=n;I.push(...o.flat()),z.push(...c.flat());const l=[r,...s,i];l.forEach(((t,e)=>{e&&D.push(...Ee(l[e-1],l[e]))}));const u=l.map((t=>t[0])),h=l.map((t=>t[t.length-1]));0==a[0]&&(q[t][0]=u),1==a[0]&&(q[t][1]=h),2==a[0]&&(q[t][2]=h),0==a[0]&&(q[4][t]=0==t||3==t?[...h].reverse():h),1==a[0]&&(q[e][3]=u),2==a[0]&&(q[5][3-t]=1==t||2==t?[...u].reverse():u)}}o||W.push([L(1,r),L(0,a),L(0,i),L(1,s)])}let $;if(o)$=q;else{const t=[];W.push([X[3],X[2],X[0],X[1]]),W.push([H[0],H[1],H[3],H[2]]);for(let[e,n,o,r]of W){const i=[];[[e,n],[e,o],[o,r],[n,r]].forEach((([t,e])=>{const n=ke([t],[e],Y,I,z),[o,r,a]=n;I.push(...o.flat()),z.push(...a.flat()),i.push([t,...r.flat(),e])})),t.push(i)}$=t}for(let t of $){const e=t[0].slice(1,t[0].length-1),n=t[2].slice(1,t[2].length-1),[o,r]=ke(e,n,Y,I),i=Qo(t[0],t[1],t[2],t[3],r,z,j);I.push(...o.flat()),z.push(...i.flat());const a=r.map(((e,n)=>[t[1][n+1],...e,t[3][n+1]])),s=[t[0],...a,t[2]];s.forEach(((t,e)=>{e&&U.push(...Ee(s[e-1],s[e],!1,(t=>t==e-1)))}))}return D.push(...U),[I,D,z]}function Qo(t,e,n,o,r,i,a){const[s,c,l,u]=[t[1],e[1],n[1],o[1]].map((t=>i[t][0])),h=(t,e)=>t>=Math.abs(e);return r.map(((t,e)=>t.map(((t,n)=>{const o=n-Math.floor(a/2),r=e-Math.floor(a/2),i=[h(-r,o),h(-o,r),h(r,o),h(o,r)];return[s,c,l,u].filter(((t,e)=>i[e]))}))))}function Zo(t){t.forEach((e=>{if(t.includes(e<3?e+3:e-3))throw"invalid choice (non adjacent) faces."}))}function Ko(t,e,n,o){let r;if(2==o.length)r=function(t,e){const n=[t,e];Zo(n);const o=[0,1,2,3,4,5],r=o.filter((t=>!n.includes(t))),i=(t,e)=>jo([t,e]),a=Array.from({length:6},(()=>[]));for(let[n,s]of[[t,e],[e,t]]){const t=n<3?n+3:n-3,e=s<3?s+3:s-3;a[n].push(...o.filter((e=>e!=n&&e!=t)).map((t=>i(n,t)))),a[n].push(...o.filter((t=>t!=s&&t!=e)).map((t=>i(e,t))));const[c,l]=r.filter((n=>n!=t&&n!=e));a[n].push(i(c,n),i(l,n),i(c,e),i(l,e))}return[a[t],a[e]]}(o[0],o[1]);else if(3==o.length)r=function(t,e,n){const o=[t,e,n];Zo(o);const r=[0,1,2,3,4,5],i=r.filter((t=>!o.includes(t))),a=(t,e)=>jo([t,e]),s=Array.from({length:6},(()=>[]));for(let t of o){const e=t<3?t+3:t-3;s[t].push(...r.filter((n=>n!=t&&n!=e)).map((e=>a(t,e))));const[n,o]=i.filter((t=>t!=e));s[t].push(a(n,t),a(o,t),a(n,o),a(o,n))}return[s[t],s[e],s[n]]}(o[0],o[1],o[2]);else{if(6!=o.length)return[t,e];r=function(t,e,n,o,r,i){const a=[t,e,n,o,r,i],s=[0,1,2,3,4,5],c=Array.from({length:6},(()=>[]));for(let t of a){const e=t<3?t+3:t-3;c[t].push(...s.filter((n=>n!=t&&n!=e)).map((e=>jo([t,e]))))}return[c[t],c[e],c[n],c[o],c[r],c[i]]}(o[0],o[1],o[2],o[3],o[4],o[5])}const i={};r.forEach(((t,e)=>t.forEach((t=>i[t]=e))));const a=[...t],s=Array.from(r,(()=>[])),c=Array.from(r,(()=>({})));t.forEach(((t,e)=>{he(fe(n[e].map((t=>i[t])))).forEach(((n,o)=>{let r=e;o&&(r=a.length,a.push([...t]),c[n][e]=r),s[n].push(r)}))}));const l=s.flat(),u=Object.fromEntries(l.map(((t,e)=>[t,e])));return[l.map((t=>a[t])),e.map((([t,e,o])=>{const r=fe(ve(n[t],ve(n[e],n[o])).map((t=>i[t])))[0],a=t=>u[c[r][t]??t];return[a(t),a(e),a(o)]}))]}function Jo(t){return[[0,1,2,1],[2,0,1,1],[2,1,0,-1]].map((([e,n,o,r])=>[[!!t[o]&&t[e]<1&&t[n]<1,n,o,45*r],[!!t[o]&&t[e]<1&&t[n]>-1,n,o,135*r],[!!t[o]&&t[e]>-1&&t[n]>-1,n,o,225*r],[!!t[o]&&t[e]>-1&&t[n]<1,n,o,315*r]])).flat()}function tr(t,e,n,o){if(t<.01)return o;if(!(n[0]||n[1]||n[2]))return o;const r=.5*Math.min(e,.5),i=Math.sqrt(2)/2,a=i-Math.sqrt(t*t/2),s=Jo(n);return o.map((e=>{const o=ct.fromValues(...e);for(let[c,l,u,h]of s)if(c){const s=[ct.rotateX,ct.rotateY,ct.rotateZ][u];s(o,o,[0,0,0],ie(h));const c=Math.min(1,(e[u]*Math.sign(n[u])+.5)/t),f=i+c*(a-i),v=[o[0],o[1],o[2]];v[l]=Math.min(o[l],f);const[m,d]=[v[l]-a+r,v[u]*Math.sign(n[u])-.5+r];m>0&&d>0&&(v[l]=Math.min(m,Math.sqrt(r*r-d*d))+a-r),s(o,v,[0,0,0],ie(-h))}return Re(o)}))}function er(t,e,n,o){if(t<.01)return n;const r=Math.sqrt(2)/2-Math.sqrt(t*t/2),i=Jo(e);return n.map(((t,e)=>{const n=ct.fromValues(...t);for(let[t,a,s,c]of i)if(t){const t=[ct.rotateX,ct.rotateY,ct.rotateZ][s];t(n,n,[0,0,0],ie(c));const i=[n[0],n[1],n[2]];i[a]=Math.min(n[a],r*(o[e]??1)),t(n,i,[0,0,0],ie(-c))}return Re(n)}))}let nr;var or;(or=nr||(nr={})).L="L",or.R="R",or.D="D",or.U="U",or.B="B",or.F="F";const rr=[nr.F,nr.U,nr.R,nr.B,nr.D,nr.L];let ir;var ar;let sr;var cr;let lr;var ur;function hr(t,e=1){return[t==ir.x?e:0,t==ir.y?e:0,t==ir.z?e:0]}function fr(t){const e=Re(t).map(((t,e)=>[t,e])),[n,o]=(r=t=>Math.abs(t[0]),e.reduce(((t,e)=>r(t)>r(e)?t:e)));var r;return[[ir.x,ir.y,ir.z][o],n>0?1:-1]}function vr(t,e){return{x:{"-1":nr.L,1:nr.R},y:{"-1":nr.D,1:nr.U},z:{"-1":nr.B,1:nr.F}}[t][e]}function mr(t,e,n){if(e==ir.z&&1==n)return t;const o=e==ir.y?ct.rotateX:ct.rotateY,r=e==ir.z?180:e==ir.x&&-1==n||e==ir.y&&1==n?-90:90;return t.map((t=>Re(o(ct.create(),t,[0,0,0],ie(r)))))}(ar=ir||(ir={})).x="x",ar.y="y",ar.z="z",(cr=sr||(sr={}))[cr.m1=-1]="m1",cr[cr.z0=0]="z0",cr[cr.p1=1]="p1",(ur=lr||(lr={}))[ur.ccw=1]="ccw",ur[ur.cw=-1]="cw";const dr={[nr.L]:[.7,.3,0],[nr.R]:[.6,0,.1],[nr.D]:[.9,.9,.15],[nr.U]:[.85,.88,.9],[nr.B]:[0,.2,.55],[nr.F]:[0,.45,.22]},pr={[nr.L]:[.9,.42,.1],[nr.R]:[.81,.39,.58],[nr.D]:[.95,.9,.2],[nr.U]:[.85,.85,.85],[nr.B]:[.24,.62,.81],[nr.F]:[.45,.75,.15]},gr={[nr.L]:[.898,.459,.122],[nr.R]:[.878,.141,.267],[nr.D]:[.929,.929,.269],[nr.U]:[.878,.878,.878],[nr.B]:[.051,.435,.729],[nr.F]:[.031,.667,.161]},br={[nr.L]:[.961,.701,.456],[nr.R]:[.923,.621,.601],[nr.D]:[.96,.903,.549],[nr.U]:[.973,.933,.902],[nr.B]:[.552,.79,.885],[nr.F]:[.592,.885,.75]},xr={classic:dr,bright:pr,neutral:gr,pastel:br};function Mr(t,e,n){const o=(xr[n]||xr.classic)[t];return Array(e).fill(o)}const yr={bl:[.08,.08,.08],st:[.42,.42,.42],si:[.594,.588,.576],go:[.6,.54,.36],rg:[.6,.42,.36]},_r={colorful:1};class Rr{get geometry(){return this._geometry}constructor(t,e){this.root=e,this._geometry=t}draw(){this.geometry.draw(this.root.shader)}}class Tr{get geometry(){return this._geometry}constructor(t,e,n,o,r,i){this.gl=t,this.block=e,this.root=n,this.axis=o,this.side=r,this.faceId=i||vr(o,r);const[a,s,c,l]=this.initGeo();this._geometry=new Fo(t,a,c,s,l),this.initPosition()}initGeo(){const{root:t,axis:e,side:n,faceId:o}=this,{faceColor:r,faceColorCustom6:i}=t.config,[a,s,c,l]=this.root.faceGeoData,u=mr(a,e,n),h=mr(c,e,n),f=er(this.root.bevelW,this.block.origPosition,u,l);return[f,s,"custom6"==r?Array(f.length).fill(i[o]):Mr(o,f.length,this.root.config.faceColor),h]}updateGeo(){const[t,e,n,o]=this.initGeo();this.geometry.update(t,n,e,o)}initPosition(){s.translate(this.geometry.transform,s.create(),this.block.displayPosition)}updatePosition(){this.geometry.transform=s.create(),this.initPosition()}draw(){this.geometry.draw(this.root.shader)}}class Cr{_boundingBox=[];faceRotation=Ve.create();get boundingBox(){return this._boundingBox.map((t=>Ce(t,this.root.transform)))}get geometry(){return this._geometry}constructor(t,e,n){this.gl=t,this.root=e,this.position=n,this.origPosition=[...n];const[o,r,i]=this.initGeo();this._geometry=new Fo(t,o,i,r),this.faces=this.createFaces(),this.initPosition()}initGeo(){const{blockType:t,blockColor2:e,blockColorCustom6:n}=this.root.config,o="stickerless"==t,r=this.origPosition;let i=r.map(((t,e)=>t<0?e+3:e)).filter(((t,e)=>r[e]));i.length||(i=[0,1,2,3,4,5]);const[a,s]=o?Ko(...this.root.blockGeoData,i):this.root.blockGeoData,c=tr(this.root.bevelW,this.root.blockR,r,a),l=c.length;return[c,s,o?i.map((t=>{const o=vr([ir.x,ir.y,ir.z][t%3],t<3?1:-1),r=l/i.length;return"custom6"==e?Array(r).fill(n[o]):Mr(o,r,e)})).flat():Array(l).fill([1,1,1])]}updateGeo(){const[t,e,n]=this.initGeo();this.geometry.update(t,n,e)}get displayPosition(){const{spread:t}=this.root;return[this.position[0]*t,this.position[1]*t,this.position[2]*t]}createFaces(){const t=this.position,e=[];return t.forEach(((t,n)=>{t&&e.push(new Tr(this.gl,this,this.root,[ir.x,ir.y,ir.z][n],t>0?1:-1))})),e}initPosition(){s.translate(this.geometry.transform,s.create(),this.displayPosition);const[t,e]=qo(),n=t.map((t=>Re(ct.add(ct.create(),t,this.displayPosition))));this._boundingBox=Te(n,e)}updatePosition(){this.geometry.transform=s.create(),this.faces.forEach((t=>{t.updatePosition()})),this.initPosition()}rotateUpdatePosition(t,e,n,o){const r=t(this.position);this.position=[re(r[0]),re(r[1]),re(r[2])],Ve.multiply(this.faceRotation,function(t,e){e%=4;let n=Math.round(Math.sin(ie(90*e))),o=Math.round(Math.cos(ie(90*e)));return"x"==t?[1,0,0,0,o,n,0,-n,o]:"y"==t?[o,0,-n,0,1,0,n,0,o]:[o,n,0,-n,o,0,0,0,1]}(e,n*o),this.faceRotation),this.updatePosition()}rotate(t,e,n,o,r){const i=hr(t);if(o){const n=n=>({x:ct.rotateX,y:ct.rotateY,z:ct.rotateZ}[t](ct.create(),n,[0,0,0],ie(90*e*r)));this.rotateUpdatePosition(n,t,e,r)}else{const t=ie(n*e),o=s.fromRotation(s.create(),t,i),r=t=>{s.multiply(t.geometry.transform,o,t.geometry.transform)};r(this),this.faces.forEach(r)}}draw(){const{blockColor:t,blockColorCustom:e,blockMetallic:n,blockRoughness:o,addStickers:r}=this.root.config,i="stickered"==this.root.config.blockType;this.root.shader.setUniform("u_BlockPosition",this.position),this.root.shader.setUniform("u_BlockPositionOrig",this.origPosition),this.root.shader.setUniform("u_FaceRotation",this.faceRotation);const a=[...yr[t]||e,1],s=_r[t]||0;this.root.shader.setUniform("u_BaseColorFactor",i?a:[1,1,1,1]),this.root.shader.setUniform("u_NonVColor",i?1:0),this.root.shader.setUniform("u_ProcColor",i?s:0),this.root.shader.setUniform("u_MetallicFactor",n),this.root.shader.setUniform("u_RoughnessFactor",o),this.root.shader.setUniform("u_EnableBlockingAO",this.root.blockAO?1:0),this.geometry.draw(this.root.shader),r&&this.drawFaces()}drawFaces(){const{faceMetallic:t,faceRoughness:e,faceColor:n,faceColorCustom:o}=this.root.config,r=xr.hasOwnProperty(n)||"custom6"==n,i=[...yr[n]||o,1],a=_r[n]||0;this.root.shader.setUniform("u_BaseColorFactor",r?[1,1,1,1]:i),this.root.shader.setUniform("u_NonVColor",r?0:1),this.root.shader.setUniform("u_ProcColor",r?0:a),this.root.shader.setUniform("u_EnableBlockingAO",0),this.root.shader.setUniform("u_MetallicFactor",t),this.root.shader.setUniform("u_RoughnessFactor",e);for(let t of this.faces)t.draw()}}class kr{speed=2;solveSpeed=3;scrambleSpeed=4;scrambleMoves=20;rotationQueue=[];transform=s.create();invTransform=s.create();invTransform3=Ve.create();animAlpha=2.25;solving=!1;scrambling=!1;showBounding=!1;_blockGeoData=[[],[],[]];_faceGeoData=[[],[],[],[]];manualBlockMoving=!1;moveBlockInfo=null;movedBlockInfo=null;clickedBlockInfo=null;blockRays=!0;blockAO=!0;_spread=1;blockR=.15;bevelW=0;faceCover=.85;faceR=.15;faceEdgeR=.5;faceRingW=1;faceExtrude=.005;config={blockType:"stickered",blockColor:"bl",blockColorCustom:[1,.5,.5],blockColor2:"classic",blockColorCustom6:{...dr},blockMetallic:0,blockRoughness:.25,addStickers:!0,faceColor:"classic",faceColorCustom:[1,.5,.5],faceColorCustom6:{...dr},faceMetallic:0,faceRoughness:.25,wearTear:.5};preset="classic";userPresets={};presetToDelete=null;get spread(){return Math.max(this._spread,1.001)}get faceCoverAdj(){const t=1-this.blockR;return this.faceCover*t}get cubeR(){return.5*(3+2*(this.spread-1))}get boundingPlanes(){return(this.boundingBox||[]).map((([t,e,n])=>[t,e,n.map((t=>Ce(t,this.transform)))]))}get rotating(){return this.rotationQueue.length>0}get shader(){return this.scene.activeShader}constructor(t,e){this.gl=t,this.scene=e,this.camera=e.camera,So(t).then((t=>{this.resources=t,this.scene.materialsLoaded=!0,this.scene.environment.setBG()})),this.updateBoundingBox(),this.updateFaceGeo(),this.updateBlockGeo(),this.blocks=this.createBlocks(),this.loadUserPresets(),this.initDOMInputs(),this.initialPosition(),this.loadConfigFromPreset(),(0,Lo.initFull)()}updateBlockGeo(){this._blockGeoData=$o(1,this.blockR,this.bevelW)}loadUserPresets(){const t=JSON.parse(localStorage.getItem("userPresets")||"null");t?this.userPresets=t:localStorage.setItem("userPresets","{}")}loadConfigFromPreset(t){const e={_spread:(t=t||Go[this.preset]||this.userPresets[this.preset]||Go.classic).spread,blockR:t.blockR,bevelW:t.bevelW,faceCover:t.faceCover,faceR:t.faceR,faceEdgeR:t.faceEdgeR,faceRingW:t.faceRingW,faceExtrude:t.faceExtrude,blockType:t.blockType,blockMetallic:t.blockMetallic,blockRoughness:t.blockRoughness,addStickers:t.addStickers,faceMetallic:t.faceMetallic,faceRoughness:t.faceRoughness,wearTear:t.wearTear},n=t.blockColor;if(Array.isArray(n)){e.blockColor2="custom6";const t=[...n,...Array(6).fill("#000000")].map(Be);e.blockColorCustom6={R:t[0],U:t[1],F:t[2],L:t[3],D:t[4],B:t[5]}}else yr.hasOwnProperty(n)||_r.hasOwnProperty(n)?e.blockColor=n:xr.hasOwnProperty(n)?e.blockColor2=n:(e.blockColor="custom",e.blockColorCustom=Be(n));const o=t.faceColor;if(Array.isArray(o)){e.faceColor="custom6";const t=[...o,...Array(6).fill("#000000")].map(Be);e.faceColorCustom6={R:t[0],U:t[1],F:t[2],L:t[3],D:t[4],B:t[5]}}else yr.hasOwnProperty(o)||_r.hasOwnProperty(o)||xr.hasOwnProperty(o)?e.faceColor=o:(e.faceColor="custom",e.faceColorCustom=Be(o));this.generalUIUpdate(e,!1)}deletePreset(){this.presetToDelete&&delete this.userPresets[this.presetToDelete],this.preset==this.presetToDelete&&(this.preset="---"),this.presetToDelete=null,localStorage.setItem("userPresets",JSON.stringify(this.userPresets)),this.updatePresetSelectUI()}saveConfigToPreset(){new bootstrap.Collapse("#accBody-savePresets").hide();const{_spread:t,blockR:e,bevelW:n,faceCover:o,faceR:r,faceEdgeR:i,faceRingW:a,faceExtrude:s}=this,{blockType:c,blockColor:l,blockColorCustom:u,blockColor2:h,blockColorCustom6:f,blockMetallic:v,blockRoughness:m}=this.config,{addStickers:d,faceColor:p,faceColorCustom:g,faceColorCustom6:b,faceMetallic:x,faceRoughness:M,wearTear:y}=this.config,_=t=>rr.map((e=>t[e])).map((t=>Ue(...t))),R={...Oo,spread:t,blockR:e,bevelW:n,...d?{faceCover:o,faceR:r,faceEdgeR:i,faceRingW:a,faceExtrude:s}:{},blockType:c,blockColor:"stickered"==c?"custom"==l?Ue(...u):l:"custom6"==h?_(f):h,blockMetallic:v,blockRoughness:m,addStickers:d,...d?{faceColor:"custom6"==p?_(b):"custom"==p?Ue(...g):p,faceMetallic:x,faceRoughness:M}:{},wearTear:y},T=ge("saveName"),C=`(u)${T.value||T.placeholder}`;this.userPresets[C]=R,localStorage.setItem("userPresets",JSON.stringify(this.userPresets)),T.value="",this.preset=C,this.updatePresetSelectUI()}get blockGeoData(){const[t,e,n]=this._blockGeoData;return[[...t],[...e],[...n]]}updateFaceGeo(){const{faceCoverAdj:t,faceR:e,faceRingW:n,faceExtrude:o,faceEdgeR:r,bevelW:i}=this;this._faceGeoData=Ho(t,.5,e,n,o,r,i)}get faceGeoData(){const[t,e,n,o]=this._faceGeoData;return[[...t],[...e],n.map((t=>t)),[...o]]}createBlocks(){const t=[];for(let e=-1;e<2;e++)for(let n=-1;n<2;n++)for(let o=-1;o<2;o++)t.push(new Cr(this.gl,this,[e,n,o]));return t}updateBoundingBox(){const t=[],e=[],{cubeR:n}=this;for(let o of[ir.x,ir.y,ir.z])for(let r of[-1,1]){const i=vr(o,r),[a,s]=Vo(2*n,n),c=mr(a,o,r),l=Te(c,s),u=Mr(i,c.length,"classic"),h=[o,r,l];t.push(h),e.push(new Rr(new Fo(this.gl,c,u,s),this))}this.boundingBox=t,this.bounds=e}handleSaverUI(t=!1){let e=this.preset;if(t||"---"==e){let t=1;for(e=`(u)random${t}`;this.userPresets[e];)t++,e=`(u)random${t}`}ge("saveName").placeholder=e.replace("(u)",""),this.handleSaverUIText(e)}handleSaverUIText(t){const e=!!this.userPresets[t];pe("saveHelp").classList[e?"remove":"add"]("hidden"),pe("saveHelpNew").classList[e?"add":"remove"]("hidden")}updatePresetSelectUI(){const t="(u)";pe("presetChoice").innerHTML=this.preset.replace(t,"");const e='<li><h6 class="dropdown-header">presets</h6></li>'+Object.keys(Go).map((t=>`<li><a id="${t}_preset" class="dropdown-item">${t}</a></li>`)).join(""),n='<li><hr class="dropdown-divider"></li>\n       <li><h6 class="dropdown-header">user presets</h6></li>'+Object.keys(this.userPresets).map((e=>`\n          <li>\n            <a id="${e}_preset" class="dropdown-item">\n              ${e.replace(t,"")}\n              <button class="btn2 trash-btn" id="${e}_del"  data-bs-toggle="modal" data-bs-target="#deleteModal">\n                <span class="trash-icon"></span>\n              </button>\n            </a>\n          </li>`)).join("");pe("presetsSelect").innerHTML=e+(Object.keys(this.userPresets).length?n:"");const o=()=>{document.querySelectorAll("#presetsSelect li a").forEach((t=>{t.classList.remove("active"),this.preset==t.id.split("_")[0]&&t.classList.add("active")}))};o(),this.handleSaverUI(),document.querySelectorAll("#presetsSelect li a").forEach((e=>{e instanceof HTMLAnchorElement&&(e.onclick=n=>{n.target instanceof HTMLAnchorElement&&(this.preset=e.id.split("_")[0],pe("presetChoice").innerHTML=this.preset.replace(t,""),o(),this.handleSaverUI(),this.loadConfigFromPreset())})})),document.querySelectorAll("#presetsSelect li a .trash-btn").forEach((e=>{e instanceof HTMLButtonElement&&(e.onclick=()=>{this.presetToDelete=e.id.split("_")[0],pe("delName").innerHTML=this.presetToDelete.replace(t,"")})}))}updateDOMVal(t,e){pe(t).innerText=e.toString()}initDOMInputs(){const{blockType:t,blockColor:e,blockColor2:n,addStickers:o,faceColor:r}=this.config,i=t=>be((e=>this.generalUIUpdate({[t]:+e.value}))),a=t=>be((e=>this.generalUIUpdate({[t]:e.value.split("_")[1]})));this.updatePresetSelectUI();for(let t of["blockRays","blockAO","showBounding"]){const e=be((e=>{this[t]=e.checked,this.triggerRedraw()}));xe(t,this[t],"onclick",e)}Me("solve","onclick",(()=>this.solve())),Me("scramble","onclick",(()=>this.scramble())),Me("reset","onclick",(()=>this.reset())),Me("smButton","onclick",(()=>pe("sideMenuButton").classList.add("transp"))),Me("sideMenuClose","onclick",(()=>pe("sideMenuButton").classList.remove("transp"))),Me("randomizer","onclick",(()=>{pe("presetChoice").innerHTML="---",this.handleSaverUI(!0),document.querySelectorAll("#presetsSelect li a").forEach((t=>{t.classList.remove("active")})),this.loadConfigFromPreset((()=>{const t=(t=1,e=0,n=2)=>re(t*Math.random()+e,n),e=t()<.5?"stickered":"stickerless",[n,o,r]=[Object.keys(yr),Object.keys(_r),Object.keys(xr)],i=[...n,...o],a=[...r],s=[...r,...r,...o,...n],c=()=>Ue(Math.random(),Math.random(),Math.random()),l=()=>Array.from({length:6},(()=>Ue(Math.random(),Math.random(),Math.random()))),u="stickered"==e?Math.random()<1/(1+i.length)?c():i[ce(i.length)]:Math.random()<1/(1+a.length)?l():a[ce(a.length)],h=Math.random()<1/(2+s.length)?c():Math.random()<2/(2+s.length)?l():s[ce(s.length)],f=re(Math.random()*("stickered"==e?.85:1),2),v=f<.85&&["stickered"==e,"stickered"==e,!0,!0,!1][ce(5)],m=v?{faceCover:re(1-le(2)*(1-(.25+.25*f)),2),faceR:t(),faceEdgeR:t(),faceRingW:t(.95,.05),faceExtrude:re(.1*le(2),3),faceColor:h,faceMetallic:[0,0,.5,1,1][ce(5)],faceRoughness:t(.5)}:No;return{spread:re(1+.25*le(5),3),blockR:f,bevelW:t()<.5?0:re(.5*le(4),2),blockType:e,blockColor:u,blockMetallic:[0,0,.5,1,1][ce(5)],blockRoughness:t(.5),addStickers:v,...m,wearTear:re(le(2),2)}})())}));xe("saveName","","oninput",be((t=>{t.value=function(t){const e=[];for(let n of t){const t=n.charCodeAt(0);if((t>47&&t<58||t>64&&t<91||t>96&&t<123)&&(e.push(n),16==e.length))break}return e.join("")}(t.value),this.handleSaverUIText(`(u)${t.value}`)}))),Me("delModalButton","onclick",(()=>this.deletePreset())),Me("save","onclick",(()=>this.saveConfigToPreset())),xe("u_Debug","0","onchange",(()=>this.triggerRedraw()));const s=this.scene.environment.intensity,c=be((t=>{this.scene.environment.intensity=+t.value,this.triggerRedraw();const e=this.scene.environment.intensity;this.updateDOMVal("envIntensityTxt",`${re(10**e,2)} (${re(e,2)})`)}));xe("envIntensityRange",s.toString(),"onchange",c),this.updateDOMVal("envIntensityTxt",`${re(10**s,2)} (${re(s,2)})`);const l=be((t=>{this.scene.environment.color=t.value,this.triggerRedraw()}));xe("envColorInput",this.scene.environment.color,"onchange",l);for(let t of["scrambleMoves","scrambleSpeed","solveSpeed"]){const e=be((e=>{this[t]=+e.value,this.updateDOMVal(`${t}Txt`,this[t])}));xe(`${t}Range`,this[t].toString(),"onchange",e),this.updateDOMVal(`${t}Txt`,this[t])}xe("spreadRange",this._spread.toString(),"onchange",i("_spread"));for(let t of["blockR","bevelW","faceCover","faceR","faceEdgeR","faceRingW","faceExtrude"])xe(`${t}Range`,this[t].toString(),"onchange",i(t));ye("blockTypeRadio",`blockTypeRadio_${t}`,a("blockType")),ye("blockColorRadio",`blockColorRadio_${e}`,a("blockColor"));const u=(t,e)=>e.map((e=>`\n        <span>\n          <label for="${t}ColorInput_${e}">${e}</label> <input type="color" id="${t}ColorInput_${e}" />\n        </span>`)).join("");for(let t of["block","face"]){const e="block"==t?"blockColor":"faceColor",n="block"==t?"blockColorCustom":"faceColorCustom",o="block"==t?"blockColorCustom6":"faceColorCustom6",r=be((t=>{this.generalUIUpdate({[n]:Be(t.value),[e]:"custom"})}));xe(`${t}ColorInput`,Ue(...this.config[n]),"onchange",r),pe(`${t}ColorInputs6row1`).innerHTML=u(t,rr.slice(0,3)),pe(`${t}ColorInputs6row2`).innerHTML=u(t,rr.slice(3,6)),rr.forEach((e=>{const n=be((t=>{this.generalUIUpdate({[o]:{...this.config[o],[e]:Be(t.value)}})})),r=this.config[o][e];xe(`${t}ColorInput_${e}`,Ue(...r),"onchange",n)}))}ye("blockColorRadio2",`blockColorRadio_${n}`,a("blockColor2"));for(let t of["blockMetallic","blockRoughness","faceMetallic","faceRoughness","wearTear"])xe(`${t}Range`,this.config[t].toString(),"onchange",i(t));xe("addStickersCheck",o,"onclick",be((t=>this.generalUIUpdate({addStickers:t.checked})))),ye("faceColorRadio",`faceColorRadio_${r}`,a("faceColor"))}updateGeo(t,e){for(let n of this.blocks)if(t&&n.updateGeo(),e)for(let t of n.faces)t.updateGeo()}generalUIUpdate(t,e=!0){let[n,o,r,i]=[!1,!1,!1,!1];if(t._spread){this._spread=t._spread,this.updateBoundingBox();for(let t of this.blocks)t.updatePosition();ge("spreadRange").value=this._spread.toString(),this.updateDOMVal("spreadTxt",this._spread)}for(let e of["blockR","bevelW","faceCover","faceR","faceEdgeR","faceRingW","faceExtrude"])null!=t[e]&&(this[e]=t[e],"blockR"!=e&&"bevelW"!=e||(n=!0,r=!0),o=!0,i=!0,ge(`${e}Range`).value=this[e].toString(),this.updateDOMVal(`${e}Txt`,this[e]));t.blockType&&(this.config.blockType=t.blockType,r=!0,this.uiToggleBlockColorRadios(),ge(`blockTypeRadio_${this.config.blockType}`).checked=!0);for(let e of["block","face"]){const n="block"==e?"blockColor":"faceColor",o="block"==e?"blockColorCustom":"faceColorCustom",a="block"==e?"blockColorCustom6":"faceColorCustom6";null!=t[o]&&(this.config[o]=t[o],this.config[n]="custom",ge(`${e}ColorRadio_custom`).checked=!0,ge(`${e}ColorInput`).value=Ue(...this.config[o])),null!=t[a]&&(this.config[a]=t[a],rr.forEach((t=>{ge(`${e}ColorInput_${t}`).value=Ue(...this.config[a][t])})),"face"==e&&(i=!0),"block"==e&&(r=!0))}null!=t.blockColor&&(this.config.blockColor=t.blockColor,ge(`blockColorRadio_${this.config.blockColor}`).checked=!0),null!=t.blockColor2&&(this.config.blockColor2=t.blockColor2,r=!0,ge(`blockColorRadio_${this.config.blockColor2}`).checked=!0,pe("blockColorInputs6").classList["custom6"==t.blockColor2?"remove":"add"]("hidden"));for(let e of["blockMetallic","blockRoughness","faceMetallic","faceRoughness","wearTear"])null!=t[e]&&(this.config[e]=t[e],this.updateDOMVal(`${e}Txt`,this.config[e]),ge(`${e}Range`).value=this.config[e].toString());if(null!=t.addStickers&&(this.config.addStickers=t.addStickers,this.uiToggleStickerOptions(),ge("addStickersCheck").checked=this.config.addStickers),null!=t.faceColor){this.config.faceColor=t.faceColor;(xr.hasOwnProperty(this.config.faceColor)||"custom6"==this.config.faceColor)&&(i=!0),ge(`faceColorRadio_${this.config.faceColor}`).checked=!0,pe("faceColorInputs6").classList["custom6"==t.faceColor?"remove":"add"]("hidden")}const a=pe("presetChoice");e&&"---"!=a.innerHTML&&!a.innerHTML.endsWith("(edited)")&&(a.innerHTML+=" (edited)"),n&&this.updateBlockGeo(),o&&this.updateFaceGeo(),(r||i)&&this.updateGeo(r,i),this.triggerRedraw()}uiToggleStickerOptions(){const t=this.config.addStickers;pe("faceStickerOptions").classList[t?"remove":"add"]("hidden")}uiToggleBlockColorRadios(){const t=this.config.blockType,e="stickered"==t?"stickerless":"stickered";pe(`blockColor_${t}`).classList.remove("hidden"),pe(`blockColor_${e}`).classList.add("hidden"),this.config.addStickers="stickered"==t,ge("addStickersCheck").checked=this.config.addStickers,this.uiToggleStickerOptions()}triggerRedraw(){this.scene.triggerRedraw()}queueRotation(t,e,n,o){this.rotationQueue.push({axis:t,level:e,dir:n,elapsedA:0,elapsedT:0,turns:o,finalTurns:o})}rotate(t,e){const n=s.fromRotation(s.create(),ie(t),e);s.multiply(this.transform,n,this.transform),s.invert(this.invTransform,this.transform),this.triggerRedraw()}mouseRotate(t,e){this.rotate(e,[1,0,0]),this.rotate(t,[0,1,0])}facesToFacelet(){const t=[];for(let e of this.blocks){const[n,o,r]=e.position;for(let i of e.faces){const a=ct.transformMat3(ct.create(),hr(i.axis,i.side),e.faceRotation),[s,c]=fr(a),l=[ir.y,ir.x,ir.z].indexOf(s)+(c<0?3:0);t[9*l+([n,-r,n,n,r,-n][l]+1+3*([r,-o,-o,-r,-o,-o][l]+1))]=i.faceId}}return t.join("")}solve(){if(this.rotating)return void(this.solving&&(this.updateButtonCount("solve",!0),this.rotationQueue=[this.rotationQueue[0]]));Do(this.facesToFacelet()).then((t=>{const e={x:ir.x,y:ir.y,z:ir.z};this.solving=t.length>0,t.forEach((([t,n,o,r])=>this.queueRotation(e[t],n,o,r))),this.updateButtonCount("solve")}))}scramble(){if(this.rotating)return void(this.scrambling&&(this.updateButtonCount("scramble",!0),this.rotationQueue=[this.rotationQueue[0]]));this.scrambling=!0;const t=[sr.m1,sr.p1],e=[lr.ccw,lr.cw],n=[ir.x,ir.y,ir.z];let o=n[ce(3)];for(let r=0;r<this.scrambleMoves;r++){const r=t[ce(2)],i=e[ce(2)];this.queueRotation(o,r,i,1),o=n.filter((t=>t!=o))[ce(2)]}this.updateButtonCount("scramble")}updateButtonCount(t,e=!1){pe(t).innerHTML=e?"stopping":this.rotationQueue.length?`(${this.rotationQueue.length}) stop ${t}`:t}initialPosition(){this.rotate(-45,[0,1,0]),this.rotate(25,[1,0,0])}resetCam(){this.transform=s.create(),this.invTransform=s.create(),this.initialPosition(),this.triggerRedraw()}reset(){this.rotationQueue=[],this.scrambling=!1,this.blocks=this.createBlocks(),this.triggerRedraw()}update(t){this.runRotation(t)}runRotation(t){if(this.rotationQueue.length){const{axis:e,level:n,dir:o,elapsedA:r,elapsedT:i,turns:a,finalTurns:s,reverse:c}=this.rotationQueue[0],l=a/(this.scrambling?this.scrambleSpeed:this.solving?this.solveSpeed:this.speed),u=i+t,h=90*a,f=ue(ze(u,l,h,this.animAlpha),0,h)+(r>h?h:0),v=Math.max(f,r),m=(c?-1:1)*Math.max(0,v-r),d=u>=l;this.rotateSlice(e,n,o,m,d,s),d?(this.rotationQueue.shift(),this.scrambling&&this.updateButtonCount("scramble"),this.solving&&this.updateButtonCount("solve")):(this.rotationQueue[0].elapsedA=v,this.rotationQueue[0].elapsedT=u),!this.rotationQueue.length&&this.scrambling&&(this.scrambling=!1),!this.rotationQueue.length&&this.solving&&(this.solving=!1),this.triggerRedraw()}}rotateSlice(t,e,n,o,r,i=1){const a=["x","y","z"].indexOf(t);for(let s of this.blocks)s.position[a]==e&&s.rotate(t,n,o,r,i)}displayTransform(t){return ct.transformMat4(ct.create(),t,this.transform)}inverseDisplayTransform(t){return ct.transformMat4(ct.create(),t,this.invTransform)}findClickedBlock(t,e){this.clickedBlockInfo=null;let n=1/0,o=null,r=null,i=null,a=null;const s=this.camera.position,c=this.camera.getPickedVector(t,e);if(!Se(s,c,[0,0,0],2*this.cubeR))return!1;let l=1/0,u=null;for(let[t,e,n]of this.boundingPlanes)for(let o of n){const n=Ae(s,c,o);if(!n)continue;const r=ct.distance(n,this.camera.position);r<l&&(l=r,u=[t,e,n])}if(!u)return!1;const[h,f,v]=u;o=h,r=f,a=v;const m=["x","y","z"].indexOf(h);for(let t of this.blocks)if(t.position[m]==f&&Se(s,c,this.displayTransform(t.displayPosition),1))for(let e of t.boundingBox){const o=Ae(s,c,e);if(!o)continue;const r=ct.distance(o,this.camera.position);r<n&&(n=r,i=t)}return!!i&&this.handleClickedBlock([o,r,i,a])}handleClickedBlock(t){if(!this.rotating){const[e,n,o,r]=t,i=this.displayTransform(hr(e,n)),a=ct.scale(ct.create(),i,this.cubeR);this.clickedBlockInfo={axis:e,side:n,block:o,p:r,normal:i,center:a}}return!0}handleMousemoveBlock(t,e,n,o){this.manualBlockMoving?this.handleManualBlockMove(t,e):_n.distance([n,o],[t,e])>10&&this.handleManualSwipe(t,e)}handleManualSwipe(t,e){if(!this.clickedBlockInfo)return;const{axis:n,normal:o,block:r,center:i,p:a}=this.clickedBlockInfo,c=this.camera.position,l=this.camera.getPickedVector(t,e),u=Ie(c,l,i,o);if(!u)return void console.warn("no ray plane (1) intersection");const h=ct.subtract(ct.create(),u,a);ct.normalize(h,this.inverseDisplayTransform(h));const f=["x","y","z"].indexOf(n),v=Re(h).map(((t,e)=>[t,e])).filter(((t,e)=>e!=f)),m=(d=v,p=t=>Math.abs(t[0]),d.reduce(((t,e)=>p(t)<p(e)?t:e)))[1];var d,p;const g=[ir.x,ir.y,ir.z][m],b=hr(g),x=r.position[m];let M=this.displayTransform(b);const y=this.displayTransform(hr(g,x)),_=ct.subtract(ct.create(),this.camera.position,y);ct.normalize(_,_);const{normal:R,shallowNormals:T}=function(t,e){const n=ae(se(ct.dot(t,e))),o=n>90,r=o?180-n:n,i=ct.cross(ct.create(),e,t);ct.normalize(i,i);const a=e=>ct.transformMat4(ct.create(),t,s.fromRotation(s.create(),ie(e),i));if(r>=85){const[n,o]=[30,-30],[r,s]=[a(n),a(o)],[c,l]=[ct.create(),ct.create()];return{normal:t,shallowNormals:{normal:t,normal1:r,a1:n,normal2:s,a2:o,rotAxis:i,cameraDir:e,prev:c,prevDir:l}}}return r<=45?{normal:t}:{normal:a((o?1:-1)*(r-(11.25+.75*r)))}}(M,_);M=R;const C=T?De(c,l,y,T):Ie(c,l,y,M);if(!C)return void console.warn("no ray plane (block dir) intersection");const k=ct.subtract(ct.create(),C,y);ct.length(k)<1e-7||(ct.normalize(k,k),T&&(T.prev=C,T.prevDir=k),this.manualBlockMoving=!0,this.moveBlockInfo={currAngle:0,level:x,normal:M,center:y,blockDir:k,shallowNormals:T})}handleManualBlockMove(t,e){if(!this.moveBlockInfo)return;const{level:n,normal:o,center:r,blockDir:i,shallowNormals:a}=this.moveBlockInfo,s=this.camera.position,c=this.camera.getPickedVector(t,e),l=a?De(s,c,r,a):Ie(s,c,r,o);if(!l)return;const u=ct.subtract(ct.create(),l,r);if(ct.length(u)<1e-7)return;ct.normalize(u,u);const[h,f]=this.blockMoveAxisAndSide(i,u);let v;if(a){const{cameraDir:t,prev:e,prevDir:o}=a;a.prev=l,a.prevDir=u;const r=ct.subtract(ct.create(),l,e);ct.normalize(r,r);v=(1-Math.abs(ct.dot(t,r)))*ae(se(ct.dot(o,u)));const[i,s]=this.blockMoveAxisAndSide(o,u);this.rotateSlice(i,n,s,v,!1)}else{v=ae(se(ct.dot(i,u)))-this.moveBlockInfo.currAngle,this.rotateSlice(h,n,f,v,!1)}this.moveBlockInfo.currAngle+=v,this.movedBlockInfo={axis:h,level:n,side:f},this.triggerRedraw()}blockMoveAxisAndSide(t,e){const n=ct.cross(ct.create(),t,e);return ct.normalize(n,this.inverseDisplayTransform(n)),fr(n)}getCurrentSliceMoveDetails(){let t,e,n,o=this.moveBlockInfo?this.moveBlockInfo.currAngle:0;if(this.movedBlockInfo)({axis:t,level:e,side:n}=this.movedBlockInfo);else{if(!this.rotationQueue.length)return{currAngle:0,axis:ir.x,level:sr.z0,dir:lr.ccw};({axis:t,level:e,dir:n}=this.rotationQueue[0])}const r=this.blocks.find((n=>n.position[["x","y","z"].indexOf(t)]==e));if(r){const i=hr(t,e*this.spread),a=ct.transformMat4(ct.create(),[0,0,0],r.geometry.transform),s=ct.sub(ct.create(),r.displayPosition,i),c=ct.sub(ct.create(),a,i);ct.normalize(s,s),ct.normalize(c,c);const l=ct.dot(s,c),u=ct.cross(ct.create(),s,c);ct.normalize(u,u),Math.abs(l)<.99999&&([t,n]=fr(u)),o=ae(se(l))}return{currAngle:o,axis:t,level:e,dir:n}}cleanupMousemoveBlock(){if(this.movedBlockInfo){const{currAngle:t,axis:e,level:n,dir:o}=this.getCurrentSliceMoveDetails(),r=t-(t>90?90:0),i=r<45,a=i?90-r:r,s=ze(a,90,1/this.speed,1/this.animAlpha),c=a+(t>90?90:0),l=re(t/90);this.rotationQueue.push({axis:e,level:n,dir:o,elapsedA:c,elapsedT:s,turns:1,finalTurns:l,reverse:i}),this.triggerRedraw()}this.manualBlockMoving=!1,this.moveBlockInfo=null,this.movedBlockInfo=null}drawBlocks(){for(let t of this.blocks)t.draw()}drawBounds(){for(let t of this.bounds||[])t.draw()}setUniforms(){const{currAngle:t,axis:e,level:n,dir:o}=this.getCurrentSliceMoveDetails();this.shader.setUniform("u_BlockR",this.blockR),this.shader.setUniform("u_BevelW",this.bevelW),this.shader.setUniform("u_NormalScale",this.config.wearTear),this.shader.setUniform("u_Spread",this.spread),this.shader.setUniform("u_CurrAngle",ie(t)*o),this.shader.setUniform("u_Axis",["x","y","z"].indexOf(e)),this.shader.setUniform("u_Level",n),this.shader.setUniform("u_RubikMatrix",this.transform),this.shader.setUniform("u_RubikMatrixInv",Ve.fromMat4(this.invTransform3,this.invTransform)),this.shader.setUniform("u_EnableBlocking",this.blockRays?1:0),this.shader.setUniform("u_Debug",+pe("u_Debug").value)}applyMaterialTextures(t){const{gl:e,resources:n}=this,{activeShader:o}=this.scene;if(!n)return t;const r=o.lookupUniformLocation.bind(o);return Po(e,r("u_NormalSampler0")||-1,n,0,t++),Po(e,r("u_NormalSampler1")||-1,n,1,t++),Po(e,r("u_NormalSampler2")||-1,n,2,t++),t}draw(){this.shader.bind(this.camera);let t=0;t=this.scene.environment.applyEnvironmentMap(t),this.applyMaterialTextures(t),this.setUniforms(),this.drawBlocks(),this.showBounding&&this.drawBounds()}}var Er;Er=new URL(i("27Lyk").resolve("7lL8B"),import.meta.url).toString();class wr{envColor=[.5,.5,.5];envIntensity=10**-.2;envRotation=Ve.create();constructor(t,n){this.gl=t,this.scene=n,this.camera=n.camera,this.shader=new Ge(t),Ao(t,e(Er)).then((t=>{this.resources=t,this.scene.initGL(),this.setBG(),this.scene.environmentLoaded=!0})),this.indices=new Uo(t,[1,2,0,2,3,0,6,2,1,1,5,6,6,5,4,4,7,6,6,3,2,7,3,6,3,7,0,7,4,0,5,1,0,4,5,0]),this.positions=new zo(t,[-1,-1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1,1,1,-1,1,1,1,1,-1,1,1],3,t.FLOAT),this.rotate()}setBG(){const t=this.intensity,e=e=>e*2**t;this.gl.clearColor(e(this.envColor[0]),e(this.envColor[1]),e(this.envColor[2]),1)}rotate(){let t=s.create();s.rotateY(t,t,ie(155)),s.rotateX(t,t,ie(-15)),Ve.fromMat4(this.envRotation,t)}get intensity(){return Math.log10(this.envIntensity)}set intensity(t){this.envIntensity=10**t,this.setBG()}get color(){return Ue(...this.envColor)}set color(t){this.envColor=Be(t),this.setBG()}drawEnvironmentMap(){const{gl:t,shader:e,resources:n}=this;n&&(this.shader.bind(this.camera),Po(t,e.lookupUniformLocation("u_GGXEnvSampler")??-1,n,n.specularEnvMap,0),e.setUniform("u_MipCount",n.mipCount),e.setUniform("u_EnvBlurNormalized",0),e.setUniform("u_EnvColor",this.envColor),e.setUniform("u_EnvRotation",this.envRotation),t.disable(t.DEPTH_TEST),this.positions.bind(e.vertexPosition),this.indices.bind(),t.drawElements(t.TRIANGLES,this.indices.indexCount,t.UNSIGNED_SHORT,0),t.enable(t.DEPTH_TEST))}applyEnvironmentMap(t){const{gl:e,resources:n}=this,{activeShader:o}=this.scene;if(!n)return t;const r=o.lookupUniformLocation.bind(o);return Po(e,r("u_LambertianEnvSampler")||-1,n,n.diffuseEnvMap,t++),Po(e,r("u_GGXEnvSampler")||-1,n,n.specularEnvMap,t++),Po(e,r("u_GGXLUT")||-1,n,n.lut,t++),o.setUniform("u_MipCount",n.mipCount),o.setUniform("u_EnvColor",this.envColor),o.setUniform("u_EnvRotation",this.envRotation),o.setUniform("u_EnvIntensity",this.envIntensity),t}}class Pr extends Ne{constructor(t){super(t,e("#version 300 es\n#define GLSLIFY 1\nuniform mat4 u_ViewProjectionMatrix,u_RubikMatrix,u_ModelMatrix;uniform mat3 u_FaceRotation;in vec3 a_position;out vec3 v_Position,v_PositionOrig;in vec3 a_normal;out vec3 v_Normal,v_NormalOrig;in vec3 a_color_0;out vec3 v_Color;void main(){gl_PointSize=1.f;vec4 v=u_RubikMatrix*u_ModelMatrix*vec4(u_FaceRotation*a_position,1);v_Position=v.xyz;v_PositionOrig=a_position;v_Normal=normalize(vec3(u_RubikMatrix*u_ModelMatrix*vec4(u_FaceRotation*a_normal,0)));v_NormalOrig=a_normal;v_Color=a_color_0;gl_Position=u_ViewProjectionMatrix*v;}"),e("#version 300 es\nprecision highp float;\n#define GLSLIFY 1\n#define PI 3.1415926535897932384626433832795\nuniform int u_Debug;uniform float u_EnvIntensity,u_BevelW;vec3 f(vec3 v,float u){return vec3(v.x,v.y*cos(u)-v.z*sin(u),v.y*sin(u)+v.z*cos(u));}vec3 n(vec3 v,float u){return vec3(v.z*sin(u)+v.x*cos(u),v.y,v.z*cos(u)-v.x*sin(u));}vec3 s(vec3 v,float u){return vec3(v.x*cos(u)-v.y*sin(u),v.x*sin(u)+v.y*cos(u),v.z);}vec3 f(vec3 v,float u,int z){return z==0?f(v,u):z==1?n(v,u):s(v,u);}float f(vec3 v,vec3 u,vec3 s,float z){vec3 m=v-s,f=m*m,n=m*u;float r=z*z,y=n.x+n.y+n.z,x=y*y-(f.x+f.y)-f.z+r;if(x>0.)return-y-sqrt(x);return-1.;}float n(vec3 v,vec3 u,vec3 m,float z){float i=f(v*vec3(-1,1,1),u*vec3(-1,1,1),m,z);if(i>0.)return i;i=f(v*vec3(1,-1,1),u*vec3(1,-1,1),m,z);if(i>0.)return i;i=f(v*vec3(1,1,-1),u*vec3(1,1,-1),m,z);if(i>0.)return i;return-1.;}bool s(vec3 v,vec3 u,vec3 m,vec3 z){vec3 f=1./u;float i=(m.x-v.x)*f.x,r=(z.x-v.x)*f.x,s=min(i,r),x=max(i,r);i=(m.y-v.y)*f.y;r=(z.y-v.y)*f.y;s=max(s,min(i,r));x=min(x,max(i,r));i=(m.z-v.z)*f.z;r=(z.z-v.z)*f.z;s=max(s,min(i,r));x=min(x,max(i,r));return s<=x&&x>=0.;}float f(vec3 v,vec3 u,vec3 m,float z,float i){vec3 x=1./u,f=x*v,s=abs(x)*(m+z),r=-f-s,t=-f+s,y,e,c,a,l,g;float p=max(max(r.x,r.y),r.z),w=min(min(t.x,t.y),t.z),d,R,N;if(p>w||w<0.)return-1.;d=p;y=v+d*u;e=sign(y);v*=e;u*=e;y*=e;y-=m;y=max(y.xyz,y.yzx);if(min(min(y.x,y.y),y.z)<0.)return d;c=v-m;a=u*u;l=c*c;g=c*u;R=z*z;d=1e20;N=-1.;{float P=g.x+g.y+g.z,W=l.x+l.y+l.z-R,o=P*P-W;if(o>0.)d=-P-sqrt(o),N=2.;if(i<z&&!(o>0.)){float h=n(v,u,m,z);if(h>0.)d=h,N=4.;}}{float P=a.y+a.z,W=g.y+g.z,o=l.y+l.z-R,h=W*W-P*o;if(h>0.){h=(-W-sqrt(h))/P;if(h>0.&&h<d&&abs(v.x+u.x*h)<m.x)d=h,N=3.;}}{float P=a.z+a.x,W=g.z+g.x,o=l.z+l.x-R,h=W*W-P*o;if(h>0.){h=(-W-sqrt(h))/P;if(h>0.&&h<d&&abs(v.y+u.y*h)<m.y)d=h,N=3.;}}{float P=a.x+a.y,W=g.x+g.y,o=l.x+l.y-R,h=W*W-P*o;if(h>0.){h=(-W-sqrt(h))/P;if(h>0.&&h<d&&abs(v.z+u.z*h)<m.z)d=h,N=3.;}}if(d>1e19)d=-1.;return d;}vec3 v(vec3 v,vec3 u){return sign(v)*normalize(max(abs(v)-u,0.));}float n(vec3 v,vec3 u,vec3 m,float z,float y){v-=m*y;float i=(1.-z)*.5;return z>.99?f(v,u,vec3(i),z*.5):f(v,u,vec3(i),z*.5,i);}bool s(vec3 v,vec3 u,vec3 z,vec3 m,float y){return s(v,u,z*y-.5,m*y+.5);}vec3 u(vec3 v,int u){return u==1?v.yxz:u==2?v.zyx:v;}float f(){return u_EnvIntensity>1.?.75+u_EnvIntensity*.25:u_EnvIntensity*.5+.5;}float f(mat3 v,vec3 z,vec3 m,float x,float y,float i,int s,int h){bool d=abs(i)>0.;vec3 r=u(m,s),N,g,R,l,n,a,t,W,c,e,o;float P=y-1.,w=P*.5,p=.5+y,T=.5+w,O=x*.5,b=O*(1.-O/(2.*O+P)),I,k,M,C,E,B,S,F,G,L,A,q,X,D;N=v*z;g=abs(d&&int(r.x)==h?f(N,-i,s):N);I=1.6*f();k=1.2;M=P*I;C=M*k;R=min(max(abs(g-T)-w,0.),C);E=length(M*(C-R)/C);B=(sqrt(2.)-1.)*O;S=(4.-PI)*O*O;F=length(vec2(u_BevelW))*length(vec2(u_BevelW));l=(g-T)/u_BevelW;n=vec3(max(S,F*min(1.,l.x)),max(S,F*min(1.,l.y)),max(S,F*min(1.,l.z)));a=n*I*1.5;t=a*k*1.5;W=min(max(vec3(length(g-vec3(g.x,T,T)),length(g-vec3(T,g.y,T)),length(g-vec3(T,T,g.z)))-length(vec2(B+w)),0.),t);c=vec3(t.x<=0.?0.:a.x*(t.x-W.x)/t.x,t.y<=0.?0.:a.y*(t.y-W.y)/t.y,t.z<=0.?0.:a.z*(t.z-W.z)/t.z);G=length(c);L=(P+sqrt(S))*I*k;A=u_BevelW*I*k;q=max(L,A);e=min(max(p-b-abs(N),0.),q);o=(q-e)/q;X=pow(o.x*o.x*o.x*o.x+o.y*o.y*o.y*o.y+o.z*o.z*o.z*o.z,.25);if(abs(i)>0.&&X<1.){mat3 U=mat3(1,0,0,0,1,0,0,0,1),V=mat3(1,5,5,5,1,5,5,5,1),Z=mat3(0,1,0,0,0,1,1,0,0);vec3 Y=vec3(.5+P)*V[s],Q=f(N,-i,s);float K=0.;for(int J=0;J<4;J++){vec3 H=f(Q,float(J)*PI*.5,s),j;H-=U[s]*float(h)*y;H-=vec3(p)*Z[s]+vec3(.5+P)*5.*Z[s];j=max(abs(H)-Y-b,0.);float at=clamp(1.-length(j)/q,0.,1.);K+=at*at*at*at;}K=pow(K,.25);X=max(K,X);}D=length(vec3(X,E,G));return clamp(D,0.,1.);}float f(out vec3 i,mat3 z,mat3 m,vec3 y,vec3 c,vec3 x,float r,float h,float t,int l,int e){i=c;bool a=abs(t)>0.,g;vec3 d=m*c,W=m*y,o=u(x,l),N;float P=-1.;N=vec3(0);g=false;for(int R=-1;R<2;R++){int p=o.x<0.?R:-R;vec3 T=d,S=W;if(a&&p==e)T=f(T,-t,l),S=f(S,-t,l);if(!s(S,T,u(vec3(p,-1,-1),l),u(vec3(p,1,1),l),h))continue;for(int w=-1;w<2;w++){int F=o.y<0.?w:-w;if(!s(S,T,u(vec3(p,F,-1),l),u(vec3(p,F,1),l),h))continue;for(int O=-1;O<2;O++){int C=o.z<0.?O:-O;vec3 I=u(vec3(p,F,C),l);if(distance(x,I)<.5)continue;float M=n(S,T,I,r,h);if(M>=0.&&(M<P||P<0.))P=M,N=S-I*h+M*T,g=a&&p==e;}}}if(P>=0.){vec3 T=v(N,vec3((1.-max(.001,r))*.5));if(g)T=f(T,t,l);T=normalize(z*T);i=normalize(reflect(c,T));}return P;}uniform float u_Exposure;uniform int u_Tone;uniform vec3 u_EnvColor;const float z=1./2.2;const mat3 m=mat3(.59719,.076,.0284,.35458,.90834,.13383,.04823,.01566,.83777),y=mat3(1.60475,-.10208,-.00327,-.53108,1.10813,-.07276,-.07367,-.00605,1.07602);vec3 f(vec3 v){return pow(v,vec3(z));}vec3 n(vec3 v){return vec3(pow(v.xyz,vec3(2.2)));}float s(float v){return pow(v,2.2);}vec4 u(vec4 v){return vec4(n(v.xyz),v.w);}vec3 v(vec3 v){return clamp(v*(2.51*v+.03)/(v*(2.43*v+.59)+.14),0.,1.);}vec3 x(vec3 v){vec3 u=v*(v+.0245786)-9.0537e-5,r=v*(.983729*v+.432951)+.238081;return u/r;}vec3 e(vec3 v){v=m*v;v=x(v);v=y*v;v=clamp(v,0.,1.);return v;}vec3 p(vec3 u){u*=u_Exposure;if(u_Tone==1)u=v(u);if(u_Tone==2)u=e(u);if(u_Tone==3)u/=.6,u=e(u);return f(u);}vec3 t(vec3 v){float u=v.y*.59+v.x*.3+v.z*.11;return mix(v,vec3(u),.75);}vec4 h(vec4 v){return vec4(t(v.xyz),v.w);}vec3 i(vec3 u){return u*(1.+.5*(u_EnvColor-vec3(.5)));}vec4 w(vec4 v){return vec4(i(v.xyz),v.w);}uniform int u_MipCount;uniform samplerCube u_LambertianEnvSampler,u_GGXEnvSampler;uniform sampler2D u_GGXLUT;uniform mat3 u_EnvRotation;uniform sampler2D u_NormalSampler0,u_NormalSampler1,u_NormalSampler2;uniform float u_NormalScale;in vec3 v_Position,v_PositionOrig,v_Normal,v_NormalOrig,v_Color;uniform vec3 u_BlockPositionOrig;uniform int u_NonVColor,u_ProcColor;vec3 c(vec3 v){v=v.y>v.x&&v.y>v.z?v.yxz:v.z>v.x&&v.z>v.y?v.zyx:v.xyz;v=v.z>v.y?v.xzy:v.xyz;return v;}vec3 c(){vec3 v=v_PositionOrig,u=v+u_BlockPositionOrig,f=abs(v_NormalOrig);if(f.y>f.x&&f.y>f.z)return vec3(u.x,sign(v.y)*u.z,sign(v.y)*(2./3.1));if(f.x>f.y&&f.x>f.z)return vec3(sign(v.x)*-u.z,-u.y,sign(v.x)*(9./5.3));return vec3(sign(v.z)*u.x,-u.y,sign(v.z)*(19./7.));}vec3 c(vec3 v,vec3 u){return v+u-vec3(0,0,1);}vec4 e(){vec4 v=vec4(u_NonVColor==1?vec3(1):v_Color,1);return v;}vec4 e(vec4 v,float u){return vec4(v.xyz/(1.-u*min(.4,1.-c(v.xyz).x)),v.w);}vec4 a(vec4 v){if(u_ProcColor==1){vec3 u=vec3(.08)+sin(v_PositionOrig)/10.;return vec4(normalize(u),v.w);}return v;}struct NormalInfo{vec3 ng;vec3 m;vec3 l;vec3 n;vec3 ntex;};float a(vec3 v,vec3 u){return clamp(dot(v,u),0.,1.);}uniform int u_Axis,u_Level;uniform float u_BlockR,u_Spread,u_CurrAngle;uniform int u_EnableBlocking,u_EnableBlockingAO;uniform vec3 u_BlockPosition;uniform mat4 u_RubikMatrix;uniform mat3 u_RubikMatrixInv;float a(){return s(f(u_RubikMatrixInv,v_Position,u_BlockPosition,u_BlockR,u_Spread,u_CurrAngle,u_Axis,u_Level));}float h(vec3 v,out vec3 u){return u_EnableBlocking==1?f(u,mat3(u_RubikMatrix),u_RubikMatrixInv,v_Position,v,u_BlockPosition,u_BlockR,u_Spread,u_CurrAngle,u_Axis,u_Level):-1.;}vec3 l(vec3 u){return i(t(texture(u_LambertianEnvSampler,u_EnvRotation*u).xyz))*u_EnvIntensity;}vec4 i(vec3 v,float u){return w(h(textureLod(u_GGXEnvSampler,u_EnvRotation*v,u)))*u_EnvIntensity;}vec3 a(vec3 v,vec3 u,float m,vec3 z,float x,float y){float s=a(v,u),f=m*float(u_MipCount-1),r;vec3 p=normalize(reflect(-u,v)),l=vec3(0),o,N,t;r=h(p,l);vec2 T=clamp(vec2(s,m),vec2(0),vec2(1)),g=texture(u_GGXLUT,T).xy;vec4 c=i(p,f);if(r>=0.){vec4 d=clamp(i(l,f)*(y*.75+.25),0.,y*.5+.25)*.75;c=clamp(c,0.,.75)*.75;d=mix(c,d,u_BlockR*.5+.5);c=mix(d,c,clamp(m,0.,.5)*2.*(y*.5+.5+(.5-y*.5)));}o=c.xyz;N=max(vec3(1.-m),z)-z;t=z+N*pow(1.-s,5.);return x*o*(t*g.x+g.y);}vec3 c(vec3 v,vec3 u,float z,vec3 m,vec3 x,float y){float i=a(v,u),r;vec2 f=clamp(vec2(i,z),vec2(0),vec2(1)),o=texture(u_GGXLUT,f).xy;vec3 s=l(v),N=max(vec3(1.-z),x)-x,c=x+N*pow(1.-i,5.),W=y*c*o.x+o.y,T,h,g;r=1.-o.x-o.y;T=y*(x+(1.-x)/21.);h=r*W*T/(1.-T*r);g=m*(1.-W+h);return(h+g)*s;}uniform float u_MetallicFactor,u_RoughnessFactor;uniform vec4 u_BaseColorFactor;uniform vec3 u_Camera;struct MaterialInfo{float ior;float perceptualRoughness;vec3 f0;float alphaRoughness;vec3 c_diff;vec3 f90;float metallic;vec3 baseColor;float specularWeight;};NormalInfo r(vec3 u){vec3 v=c(),f,i,z,m,r,y,x,l,g,t,s;vec2 h=v.xy;f=dFdx(vec3(h,0));i=dFdy(vec3(h,0));if(length(f)+length(i)<=1e-6)f=vec3(1,0,0),i=vec3(0,1,0);z=(i.y*dFdx(v_Position)-f.y*dFdy(v_Position))/(f.x*i.y-i.x*f.y);x=normalize(v_Normal);r=normalize(z-x*dot(x,z));y=cross(x,r);if(gl_FrontFacing==false)r*=-1.,y*=-1.,x*=-1.;NormalInfo o;o.ng=x;float P=v.z,N;l=normalize(texture(u_NormalSampler0,h/3.+P).xyz*2.-1.);g=normalize(texture(u_NormalSampler1,h/4.3+P).xyz*2.-1.);t=normalize(texture(u_NormalSampler2,h/7.+P*3.).xyz*2.-1.);l.x*=abs(l.x)<.05?.5:1.;l.y*=abs(l.y)<.05?.5:1.;g.x*=abs(g.x)<.075?.25:1.;g.y*=(abs(g.y)<.075?.25:1.)*-1.;t.x*=abs(t.x)<.1?.5:1.;t.y*=abs(t.y)<.1?.5:1.;s=vec3(0,0,1);s=c(s,l);s=c(s,g);s=c(s,t);s=normalize(clamp(s,-1.,1.));N=u_NormalScale*u_NormalScale;o.ntex=normalize(s*vec3(N,N,1));o.n=normalize(mat3(r,y,x)*o.ntex);o.m=r;o.l=y;return o;}vec4 h(){vec4 v=vec4(1);v=u_BaseColorFactor;v=a(v);return u(e(v*e(),u_MetallicFactor));}MaterialInfo d(MaterialInfo v){v.metallic=u_MetallicFactor;v.perceptualRoughness=u_RoughnessFactor;v.c_diff=mix(v.baseColor.xyz,vec3(0),v.metallic);v.f0=mix(v.f0,v.baseColor.xyz,v.metallic);return v;}out vec4 g_finalColor;void main(){vec4 v=h();v.w=1.;vec3 u=normalize(u_Camera-v_Position),i,y,m,z,s;NormalInfo o=r(u);i=o.n;MaterialInfo l;l.baseColor=v.xyz;l.ior=1.5;l.f0=vec3(.04);l.specularWeight=1.;l=d(l);l.perceptualRoughness=clamp(l.perceptualRoughness,0.,1.);l.metallic=clamp(l.metallic,0.,1.);l.alphaRoughness=l.perceptualRoughness*l.perceptualRoughness;l.f90=vec3(1);y=vec3(0);m=vec3(0);y+=a(i,u,l.perceptualRoughness,l.f0,l.specularWeight,l.metallic);m+=c(i,u,l.perceptualRoughness,l.c_diff,l.f0,l.specularWeight);float e=u_EnableBlockingAO==1?a():1.;y*=e;m*=e;z=m+y;switch(u_Debug){case 1:s=f(v.xyz);break;default:s=p(z);}g_finalColor=vec4(s,v.w);}")),this.vertexPosition=this.lookupAttribLocationStrict("a_position"),this.vertexColor=this.lookupAttribLocationStrict("a_color_0"),this.vertexNormal=this.lookupAttribLocationStrict("a_normal")}setUniforms(t){this.setUniform("u_ViewProjectionMatrix",s.multiply(s.create(),t.projectionMatrix,t.viewMatrix)),this.setUniform("u_Camera",t.position),this.setUniform("u_Exposure",1)}}class Sr{clock=0;pointerEvents={activeId:-1,cache:[],prevDiff:-1};mouse0={x:0,y:0};mouse={x:0,y:0};materialsLoaded=!1;environmentLoaded=!1;moveCamera=!1;get ready(){return this.environmentLoaded&&this.materialsLoaded}constructor(t,e){this.gl=t,this.initGL(),this.camera=e,this.cubeShader=new Oe(t),this.environment=new wr(t,this),this.pbrShader=new Pr(t),this.activeShader=this.pbrShader,this.changeWatcher=this.initChangeWatcher(),this.initDOMInputs(),this.handleInputEvents(),this.cube=new kr(t,this)}initGL(){this.gl.enable(this.gl.DEPTH_TEST),this.gl.depthFunc(this.gl.LEQUAL),this.gl.cullFace(this.gl.BACK),this.gl.clearDepth(1)}resetCam(){this.moveCamera?this.camera.reset():this.cube.resetCam()}initDOMInputs(){xe("moveCamera",this.moveCamera,"onclick",be((t=>{this.moveCamera=t.checked,this.triggerRedraw()}))),Me("resetCam","onclick",(()=>this.resetCam()))}handleInputEvents(){const t=this.gl.canvas,e=t=>{if(this.pointerEvents.activeId==t.pointerId){if(1==this.pointerEvents.cache.length){const e=t=>Math.min(t,2),[n,o]=[e(t.clientX-this.mouse.x),e(t.clientY-this.mouse.y)];this.moveCamera?this.camera.mouseRotate(n,o):this.cube.mouseRotate(n,o)}this.mouse={x:t.clientX,y:t.clientY}}},n=t=>{this.pointerEvents.activeId==t.pointerId&&(window.removeEventListener("pointermove",e),window.removeEventListener("pointerup",n),window.removeEventListener("pointercancel",n))},o=t=>{if(this.pointerEvents.activeId!=t.pointerId)return;const{clientX:e,clientY:n}=t,{x:o,y:r}=this.mouse0;this.mouse={x:e,y:n},this.cube.handleMousemoveBlock(e,n,o,r)},r=t=>{this.pointerEvents.activeId==t.pointerId&&(this.cube.cleanupMousemoveBlock(),window.removeEventListener("pointermove",o),window.removeEventListener("pointerup",r),window.removeEventListener("pointercancel",r))},i=this.mousemoveZoomHandler.bind(this),a=()=>{window.removeEventListener("pointermove",i),window.removeEventListener("pointerup",a),window.removeEventListener("pointercancel",a)};t.addEventListener("pointerdown",(t=>{if(1==t.buttons)if(this.pointerEvents.cache.push(t),2!=this.pointerEvents.cache.length||this.cube.manualBlockMoving){if(1==this.pointerEvents.cache.length&&(this.pointerEvents.activeId=t.pointerId,1==t.buttons)){this.mouse0={x:t.clientX,y:t.clientY},this.mouse={x:t.clientX,y:t.clientY};this.cube.findClickedBlock(t.clientX,t.clientY)?this.cube.rotating||(window.addEventListener("pointermove",o),window.addEventListener("pointerup",r),window.addEventListener("pointercancel",r)):(window.addEventListener("pointermove",e),window.addEventListener("pointerup",n),window.addEventListener("pointercancel",n))}}else window.addEventListener("pointermove",i),window.addEventListener("pointerup",a),window.addEventListener("pointercancel",a)}));const s=t=>{for(let e=0;e<this.pointerEvents.cache.length;e++)if(this.pointerEvents.cache[e].pointerId==t.pointerId){this.pointerEvents.cache.splice(e,1);break}this.pointerEvents.cache.length<2&&(this.pointerEvents.prevDiff=-1)};window.addEventListener("pointerup",s),window.addEventListener("pointercancel",s)}mousemoveZoomHandler(t){const{cache:e,prevDiff:n}=this.pointerEvents;for(let n=0;n<e.length;n++)if(t.pointerId==e[n].pointerId){e[n]=t;break}if(2==e.length){let t=Math.hypot(e[0].clientX-e[1].clientX,e[0].clientY-e[1].clientY);n>0&&this.camera.handleZoom(.1*(n-t)),this.pointerEvents.prevDiff=t}}initChangeWatcher(){return[()=>0,()=>this.camera.watcher].map(((t,e)=>({val:e?t():1,get:t})))}triggerRedraw(){this.changeWatcher[0].val=1}changeWatch(){for(let t of this.changeWatcher)if(t.val!=t.get())return t.val=t.get(),!0;return!1}renderAll(){this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.cube.draw()}render(t){const e=t-this.clock;if(this.clock=t,!this.ready)return;this.cube.update(e);const n=this.changeWatch();_e(e,n),n&&(this.camera.update(),this.renderAll())}}window.onload=function(){const t=new a("glCanvas"),e=t.getGL();if(!e)return void console.error("no webgl2");const n=new Fe(e);window.addEventListener("resize",(()=>{t.onWindowResize(),n.resize()}));const o=new Sr(e,n),r=t=>{o.render(.001*t),requestAnimationFrame(r)};requestAnimationFrame(r)};
//# sourceMappingURL=index.5b2a2cc5.js.map
